<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Export Tool Pro v3.1 - √âvaluation des Capacit√©s Export</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: white;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            overflow: hidden;
        }

        .header {
    background: white;
    color: #228B22;
    padding: 15px 20px;
    text-align: center;
    border-bottom: 1px solid #e0e0e0;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: space-between;
    min-height: auto;
}

.header-help {
    position: absolute;
    right: 30px;
    top: 50%;
    transform: translateY(-50%);
}

        .header-logo {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            width: 80px;
            height: auto;
        }

        .header-content {
            flex: 1;
            text-align: center;
        }

        .header h1 {
            font-size: 1.8em;
            margin-bottom: 5px;
            color: #228B22;
            font-weight: bold;
        }

        .header p {
            font-size: 1em;
            color: #2E8B57;
            font-weight: 500;
            margin: 0;
        }

        .navigation {
            display: flex;
            justify-content: flex-start;
            gap: 0;
            margin-bottom: 15px;
            border-bottom: 1px solid #e0e0e0;
            background: white;
            border-radius: 0;
            padding: 0;
            overflow-x: auto;
        }

        .nav-btn {
            padding: 8px 15px;
            background: white;
            color: #666;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s ease;
            border-radius: 0;
            border-bottom: 2px solid transparent;
            margin-right: 0;
            position: relative;
            white-space: nowrap;
            min-width: 150px;
            text-align: center;
        }

        .nav-btn:hover {
            background: #e9ecef;
            color: #333;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .nav-btn.active {
            background: #2e7d32;
            color: white;
            border-bottom: 3px solid #1b5e20;
            transform: none;
            box-shadow: none;
            z-index: 10;
        }

        .nav-btn.reset-btn {
            background: linear-gradient(135deg, #ea4335, #ff6b6b);
            color: white;
            margin-left: auto;
            margin-right: 0;
            border-color: #ea4335;
        }

        .nav-btn:hover {
            background: #e9ecef;
            color: #333;
            transform: none;
            box-shadow: none;
            border-bottom: 3px solid #ddd;
        }

        .nav-btn.loading {
            pointer-events: none;
            opacity: 0.7;
            background: linear-gradient(135deg, #ff9900, #ffb74d);
            color: white;
            border-color: #ff9900;
        }

        /* Barre de chargement */
        .loading-container {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .loading-container.active {
            display: block;
            animation: fadeIn 0.5s ease-in;
        }

        .loading-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #1a73e8;
            margin-bottom: 20px;
        }

        .loading-subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .loading-bar-container {
            width: 100%;
            height: 12px;
            background: #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
            margin: 20px 0;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .loading-bar {
            height: 100%;
            background: linear-gradient(90deg, #1a73e8, #4285f4, #34a853, #ff9900);
            background-size: 300% 100%;
            border-radius: 6px;
            width: 0%;
            transition: width 0.3s ease;
            animation: gradientShift 2s ease-in-out infinite;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .loading-percentage {
            font-size: 1.5em;
            font-weight: bold;
            color: #1a73e8;
            margin-top: 15px;
        }

        .loading-steps {
            text-align: left;
            margin: 25px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .loading-step {
            display: flex;
            align-items: center;
            margin: 10px 0;
            padding: 8px;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .loading-step.completed {
            background: #e8f5e8;
            color: #2e7d32;
        }

        .loading-step.active {
            background: #e3f2fd;
            color: #1565c0;
            border-left: 4px solid #1a73e8;
        }

        .loading-step-icon {
            margin-right: 12px;
            font-size: 1.2em;
        }

        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 50%;
            border-top-color: #1a73e8;
            animation: spin 1s linear infinite;
            margin-right: 12px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .content {
            padding: 20px;
        }

        .section {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #1a73e8;
            box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #34a853, #4caf50);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 10px 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(52, 168, 83, 0.4);
        }

        .btn-primary {
            background: linear-gradient(135deg, #2e7d32, #388e3c);
        }

        .btn-primary:hover {
            box-shadow: 0 6px 16px rgba(46, 125, 50, 0.4);
        }

        .question-container {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 12px;
            border-left: 3px solid #1a73e8;
        }

        .question-title {
            font-size: 1em;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
            line-height: 1.4;
        }

        .score-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 8px;
            margin-top: 8px;
        }

        .score-btn {
            padding: 8px 12px;
            border: 1px solid #e0e0e0;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            font-size: 0.9em;
            text-align: left;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .score-btn:hover {
            border-color: #2e7d32;
            background: #f0f8f0;
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        .score-btn.selected {
            background: #2e7d32;
            color: white;
            border-color: #2e7d32;
            box-shadow: 0 2px 6px rgba(46, 125, 50, 0.2);
        }

        .dimension-header {
            background: linear-gradient(135deg, #ff9900, #ff6d01);
            color: white;
            padding: 10px 15px;
            border-radius: 4px;
            margin: 20px 0 15px 0;
            font-size: 1.1em;
            font-weight: 600;
        }

        .progress-container {
            background: #e0e0e0;
            height: 8px;
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, #34a853, #4caf50);
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            margin-top: 10px;
            font-weight: 600;
            color: #666;
        }

        .results-header {
            text-align: left;
            padding: 15px 20px;
            background: linear-gradient(135deg, #34a853, #4caf50);
            color: white;
            border-radius: 6px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .score-display {
            font-size: 2.2em;
            font-weight: bold;
            margin: 0;
        }

        .dimension-scores {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .dimension-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-left: 5px solid #1a73e8;
        }

        .dimension-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .dimension-score {
            font-size: 2em;
            font-weight: bold;
            color: #1a73e8;
        }

        .dimension-bar {
            background: #e0e0e0;
            height: 8px;
            border-radius: 4px;
            margin: 10px 0;
            overflow: hidden;
        }

        .dimension-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 5px solid;
        }

        .alert-success {
            background: #e8f5e8;
            border-color: #34a853;
            color: #2e7d32;
        }

        .alert-warning {
            background: #fff3e0;
            border-color: #ff9900;
            color: #ef6c00;
        }

        .alert-error {
            background: #ffebee;
            border-color: #ea4335;
            color: #c62828;
        }

        .history-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            border-left: 5px solid #1a73e8;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .detailed-diagnosis {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .diagnosis-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .multi-select {
            position: relative;
            width: 100%;
        }

        .multi-select-display {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            background: white;
            cursor: pointer;
            min-height: 48px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
        }

        .multi-select-display:focus,
        .multi-select-display.active {
            border-color: #228B22;
            box-shadow: 0 0 0 3px rgba(34, 139, 34, 0.1);
        }

        .multi-select-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #228B22;
            border-radius: 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .multi-select-dropdown.active {
            display: block;
        }

        .multi-select-option {
            padding: 10px 15px;
            cursor: pointer;
            transition: background 0.2s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .multi-select-option:hover {
            background: #f0f8f0;
        }

        .multi-select-option input[type="checkbox"] {
            width: auto;
            margin: 0;
        }

        .selected-countries {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            max-width: calc(100% - 30px);
        }

        .country-tag {
            background: #228B22;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .country-tag .remove {
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
        }

        .dropdown-arrow {
            transition: transform 0.3s ease;
        }

        .dropdown-arrow.rotated {
            transform: rotate(180deg);
        }

        .diagnosis-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                padding: 15px;
            }
            
            .header {
                flex-direction: column;
                text-align: center;
                padding: 20px;
            }
            
            .header-logo {
                position: static;
                transform: none;
                margin-bottom: 15px;
                align-self: center;
            }
            
            .header-logo img {
                width: 100px !important;
                max-height: 50px !important;
            }

.header-help {
    position: static;
    transform: none;
    margin-top: 15px;
    align-self: center;
}

.header-help button {
    padding: 10px 15px !important;
    font-size: 12px !important;
}            

            .header h1 {
                font-size: 1.8em;
            }
            
            .header p {
                font-size: 1em;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .navigation {
                overflow-x: auto;
                scrollbar-width: thin;
                scrollbar-color: #1a73e8 #f8f9fa;
            }
            
            .navigation::-webkit-scrollbar {
                height: 4px;
            }
            
            .navigation::-webkit-scrollbar-track {
                background: #f8f9fa;
            }
            
            .navigation::-webkit-scrollbar-thumb {
                background: #1a73e8;
                border-radius: 2px;
            }
            
            .nav-btn {
                min-width: 140px;
                padding: 12px 15px;
                font-size: 14px;
            }
            
            .nav-btn.reset-btn {
                margin-left: 10px;
            }
            
            .score-buttons {
                justify-content: center;
            }
            
            .dimension-scores {
                grid-template-columns: 1fr;
            }
            
            .loading-steps {
                padding: 15px;
            }
            
            .loading-step {
                font-size: 14px;
                padding: 6px;
            }
            
            .diagnosis-grid {
                grid-template-columns: 1fr !important;
            }
        }
/* Page d'authentification */
        .auth-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2e7d32, #388e3c);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .auth-box {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            width: 400px;
            max-width: 90%;
            text-align: center;
        }

        .auth-title {
            font-size: 2em;
            color: #2e7d32;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .auth-subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .auth-form {
            text-align: left;
        }

        .auth-input {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .auth-input:focus {
            outline: none;
            border-color: #2e7d32;
            box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.1);
        }

        .auth-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #2e7d32, #388e3c);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(46, 125, 50, 0.4);
        }

        .auth-error {
            color: #ea4335;
            margin-top: 15px;
            text-align: center;
            font-weight: 600;
        }
.auth-loading {
            display: none;
            margin-top: 20px;
        }

        .auth-loading.show {
            display: block;
        }

        .auth-loading-text {
            color: #2e7d32;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .auth-progress-container {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }

        .auth-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #2e7d32, #4caf50);
            width: 0%;
            transition: width 0.1s ease;
            border-radius: 4px;
        }

        .auth-percentage {
            text-align: center;
            margin-top: 10px;
            font-weight: bold;
            color: #2e7d32;
        }
/* Styles pour l'aide */
.help-btn:hover {
    background: linear-gradient(135deg, #1565c0, #1976d2) !important;
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(21, 101, 192, 0.3);
}

.help-modal {
    position: fixed;
    z-index: 10000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
    backdrop-filter: blur(5px);
}

.help-modal-content {
    background-color: white;
    margin: 5% auto;
    padding: 0;
    border-radius: 15px;
    width: 80%;
    max-width: 800px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.3);
    animation: slideIn 0.3s ease;
}

@keyframes slideIn {
    from { transform: translateY(-50px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}

.help-header {
    background: linear-gradient(135deg, #1a73e8, #4285f4);
    color: white;
    padding: 20px 30px;
    border-radius: 15px 15px 0 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.help-header h2 {
    margin: 0;
    font-size: 1.5em;
}

.help-close {
    color: white;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    padding: 5px 10px;
    border-radius: 50%;
    transition: background 0.3s;
}

.help-close:hover {
    background: rgba(255,255,255,0.2);
}

.help-menu {
    padding: 30px;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}

.help-menu-item {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    border-left: 5px solid #1a73e8;
}

.help-menu-item:hover {
    background: #e3f2fd;
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(26, 115, 232, 0.15);
}

.help-menu-item h3 {
    margin: 0 0 10px 0;
    color: #1a73e8;
    font-size: 1.2em;
}

.help-menu-item p {
    margin: 0;
    color: #666;
    font-size: 0.9em;
}

@media (max-width: 768px) {
    .help-modal-content {
        width: 95%;
        margin: 10% auto;
    }
    
    .help-menu {
        grid-template-columns: 1fr;
        padding: 20px;
    }
    
    .help-header {
        padding: 15px 20px;
    }
    
    .help-header h2 {
        font-size: 1.2em;
    }
}

/* Onglets secondaires pour navigation interne */
        .secondary-nav {
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
            margin: -20px -20px 20px -20px;
            padding: 0 20px;
            display: flex;
            gap: 0;
            overflow-x: auto;
            scrollbar-width: thin;
        }

        .secondary-nav-btn {
            padding: 8px 12px;
            background: transparent;
            color: #666;
            border: none;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s ease;
            border-bottom: 2px solid transparent;
            white-space: nowrap;
            min-width: auto;
        }

        .secondary-nav-btn:hover {
            color: #2e7d32;
            border-bottom: 2px solid #2e7d32;
        }

        .secondary-nav-btn.active {
            color: #2e7d32;
            border-bottom: 2px solid #2e7d32;
            font-weight: 600;
        }

        .anchor-section {
            scroll-margin-top: 100px;
            margin-bottom: 30px;
        }

        .anchor-title {
            border-left: 4px solid #2e7d32;
            padding-left: 15px;
            margin-bottom: 20px;
            color: #2e7d32;
        }
     </style>
    <!-- Librairie jsPDF pour export PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" onerror="console.error('Erreur chargement jsPDF')"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" onerror="console.error('Erreur chargement html2canvas')"></script>
</head>
<body>
 <div id="authContainer" class="auth-container">
        <div class="auth-box">
            <img src="https://cotedivoirexport.ci/wp-content/uploads/2024/03/LOGO-CI-EXPORT-1.png" alt="Logo" style="max-height: 60px; height: auto; margin-bottom: 20px; display: block; margin-left: auto; margin-right: auto;">
            <h1 class="auth-title">üîê Acc√®s S√©curis√©</h1>
            <p class="auth-subtitle">Outil de Diagnostic Export</p>
            
            <form class="auth-form" onsubmit="authenticate(event)">
                <label for="username">Nom d'utilisateur :</label>
                <input type="text" id="username" class="auth-input" required>
                
                <label for="password">Mot de passe :</label>
                <input type="password" id="password" class="auth-input" required>
                
                <button type="submit" class="auth-btn">Se connecter</button>
                
           <div id="authError" class="auth-error" style="display: none;"></div>
        </form>
        
        <div id="authLoading" class="auth-loading">
            <div class="auth-loading-text">üîì Connexion r√©ussie ! Chargement en cours...</div>
            <div class="auth-progress-container">
                <div id="authProgressBar" class="auth-progress-bar"></div>
            </div>
            <div id="authPercentage" class="auth-percentage">0%</div>
        </div>
        </div>
    </div>
    <div class="container">
        <div class="header">
    <div class="header-logo">
        <img src="https://cotedivoirexport.ci/wp-content/uploads/2024/03/LOGO-CI-EXPORT-1.png" 
             alt="C√¥te d'Ivoire Export" 
             style="width: 180px; height: auto; max-height: 120px; object-fit: contain;">
    </div>
    <div class="header-content">
        <h1>üîç Outil de Diagnostic Export</h1>
        <p>√âvaluation des Capacit√©s Export</p>
    </div>
    <div class="header-help">
        <button onclick="showHelpMenu()" style="
            background: linear-gradient(135deg, #1a73e8, #4285f4);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            box-shadow: 0 4px 12px rgba(26, 115, 232, 0.3);
            transition: all 0.3s ease;
        " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(26, 115, 232, 0.4)'" onmouseout="this.style.transform='translateY(0px)'; this.style.boxShadow='0 4px 12px rgba(26, 115, 232, 0.3)'">
            üìñ Guide d'utilisation
        </button>
    </div>
</div>

        <nav class="navigation">
            <button class="nav-btn active" onclick="showSection('company')">
                üè¢ Informations Entreprise
            </button>
            <button class="nav-btn" onclick="showSection('evaluation')">
                üìã √âvaluation (50 Questions)
            </button>
            <button class="nav-btn" onclick="showSectionWithLoading('results')" id="resultsTab">
                üìä R√©sultats & Analyse
            </button>
            <button class="nav-btn" onclick="showSectionWithLoading('detailed')" id="detailedTab">
                üîç Diagnostic D√©taill√©
            </button>
            <button class="nav-btn" onclick="showSection('history')">
                üìö Historique
            </button>
            <button class="nav-btn reset-btn" onclick="resetApplication()">
                üîÑ Nouveau diagnostic
            </button>
        </nav>

        <!-- Conteneur de chargement -->
        <div id="loadingContainer" class="loading-container">
            <div class="loading-title">üîç Analyse Approfondie en Cours</div>
            <div class="loading-subtitle">G√©n√©ration de votre rapport d√©taill√©...</div>
            
            <div class="loading-bar-container">
                <div class="loading-bar" id="loadingBar"></div>
            </div>
            <div class="loading-percentage" id="loadingPercentage">0%</div>
            
            <div class="loading-steps">
                <div class="loading-step" id="step1">
                    <span class="loading-step-icon">‚è≥</span>
                    <span id="step1-text">Calcul des scores pond√©r√©s par dimension</span>
                </div>
                <div class="loading-step" id="step2">
                    <span class="loading-step-icon">‚è≥</span>
                    <span id="step2-text">Analyse des interd√©pendances et goulots d'√©tranglement</span>
                </div>
                <div class="loading-step" id="step3">
                    <span class="loading-step-icon">‚è≥</span>
                    <span id="step3-text">G√©n√©ration des recommandations strat√©giques</span>
                </div>
                <div class="loading-step" id="step4">
                    <span class="loading-step-icon">‚è≥</span>
                    <span id="step4-text">√âlaboration du plan d'action personnalis√©</span>
                </div>
                <div class="loading-step" id="step5">
                    <span class="loading-step-icon">‚è≥</span>
                    <span id="step5-text">Finalisation du rapport d'analyse</span>
                </div>
            </div>
        </div>

        <div class="content">
            <!-- Section Informations Entreprise -->
            <div id="company" class="section active">
                <h2>üè¢ Informations de l'Entreprise</h2>
                <form id="companyForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="companyName">Nom de l'entreprise *</label>
                            <input type="text" id="companyName" name="companyName" required>
                        </div>
                        <div class="form-group">
                            <label for="sector">Secteur d'activit√© *</label>
                            <select id="sector" name="sector" required>
                                <option value="">S√©lectionnez votre secteur</option>
<option value="Agro-alimentaire">Agro-alimentaire</option>
<option value="Agriculture">Agriculture</option>
<option value="Agroforesterie">Agroforesterie</option>
<option value="Mines et M√©taux">Mines et M√©taux</option>
<option value="P√©trole et Gaz">P√©trole et Gaz</option>
<option value="Textile">Textile</option>
<option value="Confection">Confection</option>
<option value="Pharmaceutique">Pharmaceutique</option>
<option value="Cosm√©tiques">Cosm√©tiques</option>
<option value="Artisanat">Artisanat</option>
<option value="Bois et Ameublement">Bois et Ameublement</option>
<option value="Mat√©riaux de Construction">Mat√©riaux de Construction</option>
<option value="Chimie et Parachimie">Chimie et Parachimie</option>
<option value="√âlectronique">√âlectronique</option>
<option value="M√©canique">M√©canique</option>
<option value="Transport et Logistique">Transport et Logistique</option>
<option value="Services Financiers">Services Financiers</option>
<option value="Tourisme">Tourisme</option>
<option value="BTP">BTP</option>
<option value="√ânergie Renouvelable">√ânergie Renouvelable</option>
<option value="Autre">Autre</option>
</select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="employees">Nombre d'employ√©s</label>
                            <select id="employees" name="employees">
                                <option value="">S√©lectionnez</option>
                                <option value="1-9">1-9 employ√©s</option>
                                <option value="10-49">10-49 employ√©s</option>
                                <option value="50-249">50-249 employ√©s</option>
                                <option value="250+">250+ employ√©s</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="revenue">Chiffre d'affaires annuel (FCFA)</label>
                            <select id="revenue" name="revenue">
                                <option value="">S√©lectionnez</option>
                                <option value="< 10M">Moins de 10 millions FCFA</option>
<option value="10M-20M">10M - 20M FCFA</option>
<option value="20M-30M">20M - 30M FCFA</option>
<option value="30M-40M">30M - 40M FCFA</option>
<option value="40M-50M">40M - 50M FCFA</option>
<option value="50M-60M">50M - 60M FCFA</option>
<option value="60M-70M">60M - 70M FCFA</option>
<option value="70M-80M">70M - 80M FCFA</option>
<option value="80M-90M">80M - 90M FCFA</option>
<option value="90M-100M">90M - 100M FCFA</option>
<option value="100M-110M">100M - 110M FCFA</option>
<option value="110M-120M">110M - 120M FCFA</option>
<option value="120M-130M">120M - 130M FCFA</option>
<option value="130M-140M">130M - 140M FCFA</option>
<option value="140M-150M">140M - 150M FCFA</option>
<option value="150M-160M">150M - 160M FCFA</option>
<option value="160M-170M">160M - 170M FCFA</option>
<option value="170M-180M">170M - 180M FCFA</option>
<option value="180M-190M">180M - 190M FCFA</option>
<option value="190M-200M">190M - 200M FCFA</option>
<option value="200M+">Plus de 200 millions FCFA</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="country">Pays du si√®ge social</label>
                            <select id="country" name="country">
                                <option value="">S√©lectionnez</option>
                                <option value="C√¥te d'Ivoire">C√¥te d'Ivoire</option>
                                <option value="S√©n√©gal">S√©n√©gal</option>
                                <option value="Ghana">Ghana</option>
                                <option value="Mali">Mali</option>
                                <option value="Burkina Faso">Burkina Faso</option>
                                <option value="Niger">Niger</option>
                                <option value="Togo">Togo</option>
                                <option value="B√©nin">B√©nin</option>
                                <option value="Cameroun">Cameroun</option>
                                <option value="Autre">Autre</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="email">Email de contact</label>
                            <input type="email" id="email" name="email">
                        </div>
                    </div>

		    <div class="form-row">
    <div class="form-group">
        <label for="interviewer">Dossier suivi par *</label>
        <input type="text" id="interviewer" name="interviewer" required placeholder="Nom et pr√©nom de l'agent ACIEX">
    </div>
    <div class="form-group">
        <label for="leaderGender">Sexe du dirigeant *</label>
        <select id="leaderGender" name="leaderGender" required>
            <option value="">S√©lectionnez</option>
            <option value="Homme">Homme</option>
            <option value="Femme">Femme</option>
        </select>
    </div>
</div>

<div class="form-row">
    <div class="form-group">
        <label for="leaderAge">Tranche d'√¢ge du dirigeant</label>
        <select id="leaderAge" name="leaderAge">
            <option value="">S√©lectionnez (facultatif)</option>
            <option value="Moins de 25 ans">Moins de 25 ans</option>
            <option value="25-34 ans">25-34 ans</option>
            <option value="35-44 ans">35-44 ans</option>
            <option value="45-54 ans">45-54 ans</option>
            <option value="55-64 ans">55-64 ans</option>
            <option value="65 ans et plus">65 ans et plus</option>
        </select>
    </div>
    <div class="form-group">
        <!-- Espace vide pour l'alignement -->
    </div>
</div>


                    <div class="form-group">
                        <label for="currentMarkets">March√©s actuels *</label>
                        <div class="multi-select" id="currentMarketsSelect">
                            <div class="multi-select-display" onclick="toggleDropdown('currentMarkets')">
                                <div class="selected-countries" id="currentMarketsDisplay">
                                    <span style="color: #999;">S√©lectionnez vos march√©s actuels</span>
                                </div>
                                <span class="dropdown-arrow">‚ñº</span>
                            </div>
                            <div class="multi-select-dropdown" id="currentMarketsDropdown">
                                <!-- Options will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="targetMarket">March√© cible prioritaire pour l'export *</label>
                        <select id="targetMarket" name="targetMarket" required>
                            <option value="">S√©lectionnez votre march√© cible principal</option>
                            <!-- Options seront ajout√©es par JavaScript -->
                        </select>
                    </div>

                    <button type="button" class="btn btn-primary" onclick="nextCompanySection()">
                        Suivant ‚û°Ô∏è
                    </button>
                </form>
            </div>

            <!-- Section √âvaluation -->
            <div id="evaluation" class="section">
                <h2>üìã √âvaluation des Capacit√©s (50 Questions)</h2>
                
                <div class="progress-container">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText">0/50 questions compl√©t√©es</div>

                <div id="questionsContainer"></div>

                <div style="text-align: center; margin: 30px 0;">
                    <button class="btn btn-primary" onclick="calculateResults()">
                        üìä Calculer les R√©sultats
                    </button>
                </div>
            </div>

            <!-- Section R√©sultats -->
            <div id="results" class="section">
                <div id="resultsContainer">
                    <div class="alert alert-warning">
                        <strong>Aucun r√©sultat disponible.</strong><br>
                        Veuillez d'abord compl√©ter l'√©valuation dans l'onglet "√âvaluation".
                    </div>
                </div>
            </div>

            <!-- Section Diagnostic D√©taill√© -->
            <div id="detailed" class="section">
                <div id="detailedContainer">
                    <div class="alert alert-warning">
                        <strong>Aucun diagnostic d√©taill√© disponible.</strong><br>
                        Veuillez d'abord compl√©ter l'√©valuation et calculer les r√©sultats.
                    </div>
                </div>
            </div>

            <!-- Section Historique -->
            <div id="history" class="section">
                <h2>üìö Historique des √âvaluations</h2>
                <div id="historyContainer">
                    <div class="alert alert-warning">
                        <strong>Aucun historique disponible.</strong><br>
                        Vos √©valuations appara√Ætront ici une fois que vous aurez calcul√© vos premiers r√©sultats.
                    </div>
                </div>
            </div>
        </div>
    </div>

<!-- Modal d'aide -->
<div id="helpModal" class="help-modal" style="display: none;">
    <div class="help-modal-content">
        <div class="help-header">
            <h2>üìñ Guide d'utilisation - Outil Diagnostic Export</h2>
            <span class="help-close" onclick="closeHelpMenu()">&times;</span>
        </div>
        <div class="help-menu">
            <div class="help-menu-item" onclick="openHelpSection('prise-en-main')">
                <h3>üöÄ Prise en main</h3>
                <p>Comment renseigner les champs et obtenir vos r√©sultats</p>
            </div>
            <div class="help-menu-item" onclick="openHelpSection('lecture-resultats')">
                <h3>üìä Lecture des r√©sultats</h3>
                <p>Interpr√©ter vos scores et analyses d√©taill√©es</p>
            </div>
            <div class="help-menu-item" onclick="openHelpSection('enregistrement')">
                <h3>üíæ Enregistrement & Export</h3>
                <p>Sauvegarder et exporter vers PDF ou Google Sheets</p>
            </div>
            <div class="help-menu-item" onclick="openHelpSection('faq')">
                <h3>‚ùì FAQ</h3>
                <p>Questions fr√©quentes et r√©ponses d√©taill√©es</p>
            </div>
        </div>
    </div>
</div>

    <script>
        // Variables globales
        let currentData = {
    company: {},
    scores: {},
    results: null,
    certificationDetails: {}
};

        // Configuration Google Sheets API
        const GOOGLE_SHEETS_CONFIG = {
            apiKey: 'AIzaSyCx94tUUNfyMuBIdyxg821s9lP3fE2wlkA', // Remplace par ta cl√© API
            spreadsheetId: '13hS0qkGxA78MQQoALDog-H20MmfBdlkARkiE99UQnLc', // Remplace par l'ID de ton Google Sheet
            discoveryDoc: 'https://sheets.googleapis.com/$discovery/rest?version=v4',
            scope: 'https://www.googleapis.com/auth/spreadsheets'
        };

	// URL du Google Apps Script (remplace par ta vraie URL)
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxJoNgydFifhZY5xZfcHKNj_C2ES0ylg2ulz_4C6IRKGrj4Rd77SHlzaim_Bd8BH4h2KQ/exec';

        // Listes des pays
        const africaCountries = [
            'B√©nin', 'Burkina Faso', 'Cameroun', 'Cap-Vert', 'C√¥te d\'Ivoire', 'Gabon', 'Gambie', 
            'Ghana', 'Guin√©e', 'Guin√©e-Bissau', 'Guin√©e √âquatoriale', 'Liberia', 'Mali', 
            'Mauritanie', 'Niger', 'Nigeria', 'R√©publique Centrafricaine', 'R√©publique D√©mocratique du Congo',
            'R√©publique du Congo', 'S√©n√©gal', 'Sierra Leone', 'Tchad', 'Togo',
            'Afrique du Sud', 'Alg√©rie', 'Angola', 'Botswana', 'Burundi', 'Comores', 'Djibouti',
            '√âgypte', '√ârythr√©e', 'Eswatini', '√âthiopie', 'Kenya', 'Lesotho', 'Libye',
            'Madagascar', 'Malawi', 'Maroc', 'Maurice', 'Mozambique', 'Namibie', 'Ouganda',
            'Rwanda', 'S√£o Tom√©-et-Principe', 'Seychelles', 'Somalie', 'Soudan', 'Soudan du Sud',
            'Tanzanie', 'Tunisie', 'Zambie', 'Zimbabwe'
        ];

        const exportCountries = [
            // CEDEAO (15 pays) - Zone de libre-√©change
            'B√©nin', 'Burkina Faso', 'Cap-Vert', 'Gambie', 'Ghana', 'Guin√©e', 'Guin√©e-Bissau', 
            'Liberia', 'Mali', 'Niger', 'Nigeria', 'S√©n√©gal', 'Sierra Leone', 'Togo',
            
            // UEMOA (Zone Franc) - Union √©conomique
            'B√©nin', 'Burkina Faso', 'Mali', 'Niger', 'S√©n√©gal', 'Togo', 'Guin√©e-Bissau',
            
            // Union Europ√©enne - APE (Accord Partenariat √âconomique)
            'France', 'Allemagne', 'Pays-Bas', 'Belgique', 'Italie', 'Espagne', 'Portugal', 
            'Gr√®ce', 'Irlande', 'Luxembourg', 'Autriche', 'Finlande', 'Su√®de', 'Danemark',
            'Pologne', 'R√©publique Tch√®que', 'Hongrie', 'Slovaquie', 'Slov√©nie', 'Estonie',
            'Lettonie', 'Lituanie', 'Croatie', 'Bulgarie', 'Roumanie', 'Chypre', 'Malte',
            
            // Afrique du Nord - Relations bilat√©rales fortes
            'Maroc', 'Tunisie', 'Alg√©rie', '√âgypte', 'Libye',
            
            // Afrique Centrale - CEMAC et relations r√©gionales
            'Cameroun', 'Gabon', 'R√©publique Centrafricaine', 'R√©publique du Congo', 
            'R√©publique D√©mocratique du Congo', 'Tchad', 'Guin√©e √âquatoriale',
            
            // Afrique de l'Est - Relations commerciales √©tablies
            'Kenya', '√âthiopie', 'Tanzanie', 'Ouganda', 'Rwanda', 'Djibouti', 'Madagascar',
            
            // Afrique Australe - SADC et relations
            'Afrique du Sud', 'Angola', 'Namibie', 'Botswana', 'Zimbabwe', 'Zambie', 
            'Maurice', 'Mozambique', 'Malawi',
            
            // Am√©rique du Nord
            '√âtats-Unis', 'Canada',
            
            // Am√©rique Latine - Relations Sud-Sud
            'Br√©sil', 'Argentine', 'Mexique', 'Chili', 'Colombie', 'P√©rou', 'Venezuela',
            
            // Asie-Pacifique - Partenaires commerciaux majeurs
            'Chine', 'Inde', 'Japon', 'Cor√©e du Sud', 'Singapour', 'Malaisie', 'Tha√Ølande',
            'Indon√©sie', 'Vietnam', 'Philippines', 'Bangladesh', 'Pakistan', 'Sri Lanka',
            'Australie', 'Nouvelle-Z√©lande',
            
            // Moyen-Orient - Relations commerciales importantes
            '√âmirats Arabes Unis', 'Arabie Saoudite', 'Qatar', 'Kowe√Øt', 'Bahre√Øn', 'Oman',
            'Isra√´l', 'Turquie', 'Iran', 'Jordanie', 'Liban',
            
            // Autres partenaires importants
            'Suisse', 'Norv√®ge', 'Royaume-Uni', 'Russie'
        ];

        // Fonctions pour les multi-select et select
        function initializeMultiSelects() {
            populateDropdown('currentMarkets', africaCountries);
            populateCountrySelect('targetMarket', exportCountries);
        }

         function populateCountrySelect(selectId, countries) {
            const select = document.getElementById(selectId);
            
            // Supprimer les doublons et trier par ordre alphab√©tique
            const uniqueCountries = [...new Set(countries)].sort();
            
            uniqueCountries.forEach(country => {
                const option = document.createElement('option');
                option.value = country;
                option.textContent = country;
                select.appendChild(option);
            });
        }

function populateDropdown(selectId, countries) {
            const dropdown = document.getElementById(selectId + 'Dropdown');
            dropdown.innerHTML = '';
            
            countries.forEach(country => {
                const option = document.createElement('div');
                option.className = 'multi-select-option';
                
                // Cr√©er un ID s√ªr sans caract√®res sp√©ciaux
                const safeId = country.replace(/[^a-zA-Z0-9]/g, '_');
                
                // Cr√©er les √©l√©ments sans utiliser innerHTML pour √©viter les probl√®mes d'√©chappement
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = `${selectId}_${safeId}`;
                checkbox.value = country;
                
                const label = document.createElement('label');
                label.setAttribute('for', `${selectId}_${safeId}`);
                label.textContent = country;
                
                // Ajouter l'event listener directement
                checkbox.addEventListener('change', function() {
                    updateSelection(selectId, country);
                });
                
                option.appendChild(checkbox);
                option.appendChild(label);
                dropdown.appendChild(option);
            });
        }

        function toggleDropdown(selectId) {
            const dropdown = document.getElementById(selectId + 'Dropdown');
            const display = document.querySelector(`#${selectId}Select .multi-select-display`);
            const arrow = display.querySelector('.dropdown-arrow');
            
            // Fermer tous les autres dropdowns
            document.querySelectorAll('.multi-select-dropdown').forEach(dd => {
                if (dd.id !== selectId + 'Dropdown') {
                    dd.classList.remove('active');
                }
            });
            
            document.querySelectorAll('.multi-select-display').forEach(dd => {
                if (dd !== display) {
                    dd.classList.remove('active');
                    dd.querySelector('.dropdown-arrow').classList.remove('rotated');
                }
            });
            
            // Toggle current dropdown
            dropdown.classList.toggle('active');
            display.classList.toggle('active');
            arrow.classList.toggle('rotated');
        }

        function updateSelection(selectId, country) {
            console.log('üîÑ Mise √† jour s√©lection:', selectId, country);
            
            // Cr√©er un ID s√ªr pour trouver la checkbox
            const safeId = country.replace(/[^a-zA-Z0-9]/g, '_');
            const checkbox = document.getElementById(`${selectId}_${safeId}`);
            
            if (!checkbox) {
                console.error('‚ùå Checkbox non trouv√©e pour:', country, 'ID:', `${selectId}_${safeId}`);
                return;
            }
            
            const display = document.getElementById(selectId + 'Display');
            
            if (!currentData.company[selectId]) {
                currentData.company[selectId] = [];
            }
            
            if (checkbox.checked) {
                if (!currentData.company[selectId].includes(country)) {
                    currentData.company[selectId].push(country);
                    console.log('‚úÖ Pays ajout√©:', country);
                }
            } else {
                currentData.company[selectId] = currentData.company[selectId].filter(c => c !== country);
                console.log('‚ùå Pays retir√©:', country);
            }
            
            updateDisplaySelection(selectId);
            saveToStorage();
        }

        function updateDisplaySelection(selectId) {
            const display = document.getElementById(selectId + 'Display');
            const selected = currentData.company[selectId] || [];
            
            console.log('üîÑ Mise √† jour affichage pour:', selectId, 'Pays s√©lectionn√©s:', selected);
            
            if (selected.length === 0) {
                const placeholder = 'S√©lectionnez vos march√©s actuels';
                display.innerHTML = `<span style="color: #999;">${placeholder}</span>`;
            } else {
                // Cr√©er les tags sans utiliser onclick pour √©viter les probl√®mes d'√©chappement
                display.innerHTML = '';
                selected.forEach(country => {
                    const tag = document.createElement('span');
                    tag.className = 'country-tag';
                    tag.innerHTML = `${country} <span class="remove">√ó</span>`;
                    
                    // Ajouter l'event listener au bouton de suppression
                    const removeBtn = tag.querySelector('.remove');
                    removeBtn.addEventListener('click', function() {
                        removeCountry(selectId, country);
                    });
                    
                    display.appendChild(tag);
                });
            }
        }

        function removeCountry(selectId, country) {
            console.log('üóëÔ∏è Suppression pays:', country);
            
            // Cr√©er un ID s√ªr pour trouver la checkbox
            const safeId = country.replace(/[^a-zA-Z0-9]/g, '_');
            const checkbox = document.getElementById(`${selectId}_${safeId}`);
            
            if (checkbox) {
                checkbox.checked = false;
                console.log('‚úÖ Checkbox d√©coch√©e pour:', country);
            } else {
                console.error('‚ùå Checkbox non trouv√©e pour suppression:', country);
            }
            
            if (currentData.company[selectId]) {
                currentData.company[selectId] = currentData.company[selectId].filter(c => c !== country);
            }
            
            updateDisplaySelection(selectId);
            saveToStorage();
        }

        // Fermer les dropdowns en cliquant ailleurs
        document.addEventListener('click', function(event) {
            if (!event.target.closest('.multi-select')) {
                document.querySelectorAll('.multi-select-dropdown').forEach(dd => {
                    dd.classList.remove('active');
                });
                document.querySelectorAll('.multi-select-display').forEach(dd => {
                    dd.classList.remove('active');
                    dd.querySelector('.dropdown-arrow').classList.remove('rotated');
                });
            }
        });

        // Dimensions et questions
        const dimensions = [
    {
        title: "1. Produit et Positionnement",
        weight: 10,
        questions: [
            "Votre produit/service r√©pond-il √† un besoin sp√©cifique sur les march√©s export ?",
            "Avez-vous adapt√© votre offre aux go√ªts et pr√©f√©rences locales ?",
            "Votre marque et communication sont-elles attractives √† l'international ?",
            "Disposez-vous d'une protection intellectuelle de vos produits (brevets, marques) ?",
            "Vos produits ont-ils un avantage concurrentiel distinctif ?"
        ]
    },
    {
        title: "2. Capacit√© de Production et Logistique",
        weight: 12,
        questions: [
            "Votre entreprise dispose-t-elle d'une capacit√© de production suffisante pour r√©pondre √† une demande export suppl√©mentaire de 30% ?",
            "Avez-vous des √©quipements et infrastructures conformes aux standards internationaux ?",
            "Disposez-vous d'un syst√®me de gestion des stocks et de planification de production efficace ?",
            "Votre cha√Æne d'approvisionnement est-elle fiable et diversifi√©e ?",
            "Pouvez-vous garantir des d√©lais de livraison courts et respect√©s (moins de 30 jours) ?"
        ]
    },
    {
    title: "3. Qualit√© et Conformit√©",
    weight: 15, 
    questions: [
        "Disposez-vous d'un syst√®me de tra√ßabilit√© complet de vos produits ?",
        "Disposez-vous de certifications qualit√© reconnues dans vos march√©s cibles ?",
        "Avez-vous un syst√®me de contr√¥le qualit√© rigoureux √† toutes les √©tapes ?",
        "Vos emballages sont-ils adapt√©s au transport international et attractifs ?",
        "Effectuez-vous r√©guli√®rement des tests produits par des laboratoires agr√©√©s ?"
    ]
},
    {
        title: "4. Organisation et Processus Internes",
        weight: 9,
        questions: [
            "Vos processus internes sont-ils document√©s et optimis√©s ?",
            "Disposez-vous d'un syst√®me informatique performant (ERP, CRM) ?",
            "Votre service client peut-il g√©rer des demandes en plusieurs langues ?",
            "Avez-vous des proc√©dures claires pour traiter les commandes export ?",
            "Votre √©quipe est-elle form√©e aux sp√©cificit√©s du commerce international ?"
        ]
    },
    {
        title: "5. Situation Financi√®re",
        weight: 13,
        questions: [
            "Votre entreprise dispose-t-elle d'une situation financi√®re saine (ratios d'endettement < 70%) ?",
            "Avez-vous acc√®s √† des financements d√©di√©s √† l'export (cr√©dit export, affacturage) ?",
            "Pouvez-vous investir au moins 10% de votre CA dans le d√©veloppement export ?",
            "Disposez-vous d'une tr√©sorerie suffisante pour supporter 90 jours de d√©calage de paiement ?",
            "Tenez-vous une comptabilit√© r√©guli√®rement mise √† jour et valid√©e par un expert-comptable ou un commissaire aux comptes ?"
        ]
    },
    {
        title: "6. Ma√Ætrise des Prix et Techniques Commerciales Export",
        weight: 12,
        questions: [
            "Ma√Ætrisez-vous les Incoterms et leur impact sur vos prix ?",
            "Avez-vous une grille de prix adapt√©e √† chaque march√© cible ?",
            "Connaissez-vous les techniques de paiement international (cr√©dit documentaire, etc.) ?",
            "Disposez-vous d'outils de couverture contre le risque de change ?",
            "Vos prix sont-ils comp√©titifs par rapport √† la concurrence internationale ?"
        ]
    },
    {
        title: "7. Exp√©rience et Comp√©tences Export",
        weight: 11,
        questions: [
            "Votre √©quipe a-t-elle une exp√©rience du commerce international ?",
            "Disposez-vous d'un responsable export d√©di√© et form√© ?",
            "Connaissez-vous les r√©glementations douani√®res de vos march√©s cibles ?",
            "Avez-vous d√©j√† particip√© √† des salons internationaux ou missions commerciales ?",
            "Ma√Ætrisez-vous les langues de vos march√©s cibles (anglais, fran√ßais, etc.) ?"
        ]
    },
    {
        title: "8. Innovation et D√©veloppement",
        weight: 8,
        questions: [
            "Investissez-vous r√©guli√®rement dans la R&D (au moins 2% du CA) ?",
            "Votre entreprise d√©veloppe-t-elle de nouveaux produits/services annuellement ?",
            "Suivez-vous les tendances et innovations de votre secteur ?",
            "Collaborez-vous avec des centres de recherche ou universit√©s ?",
            "Vos innovations sont-elles prot√©g√©es et valoris√©es ?"
        ]
    },
    {
        title: "9. R√©seau et Partenariats",
        weight: 5,
        questions: [
            "Avez-vous des contacts ou partenaires dans vos march√©s cibles ?",
            "Participez-vous √† des r√©seaux professionnels internationaux ?",
            "Disposez-vous de distributeurs ou agents commerciaux fiables ?",
            "Entretenez-vous des relations avec les institutions d'appui √† l'export ?",
            "Votre r√©seau LinkedIn/professionnel est-il d√©velopp√© internationalement ?"
        ]
    },
    {
        title: "10. Planification et Strat√©gie Export",
        weight: 5,
        questions: [
            "Avez-vous un business plan export formalis√© sur 3 ans ?",
            "Vos objectifs export sont-ils chiffr√©s et suivis mensuellement ?",
            "Allouez-vous un budget sp√©cifique au d√©veloppement export ?",
            "Effectuez-vous une veille concurrentielle sur vos march√©s cibles ?",
            "Avez-vous d√©fini une strat√©gie de p√©n√©tration par march√© ?"
        ]
    }
];

// Base de donn√©es des recommandations sp√©cifiques par question
const questionRecommendations = {
    // DIMENSION 1 : Produit et Positionnement (ancien index 5)
    "0-0": {
        short: "Valider l'ad√©quation produit/march√© export",
        detailed: "√âtude de march√© approfondie pour confirmer la demande sur vos march√©s cibles. Tests consommateurs, analyse comportementale. √âtude march√© : 1-3M FCFA selon pays."
    },
    "0-1": {
        short: "Adapter votre offre aux pr√©f√©rences locales",
        detailed: "Recherche consommateurs locaux, adaptation produit aux go√ªts/habitudes. Tests march√©s pilotes recommand√©s. Budget adaptation produit : 2-5M FCFA selon complexit√©."
    },
    "0-2": {
        short: "D√©velopper une marque et communication internationale",
        detailed: "Cr√©ation identit√© visuelle export, supports multilingues, strat√©gie communication digitale. Agence communication internationale : 2-8M FCFA selon ambition."
    },
    "0-3": {
        short: "Prot√©ger votre propri√©t√© intellectuelle",
        detailed: "D√©p√¥t marques et brevets dans vos march√©s cibles prioritaires. Protection designs, savoir-faire. Cabinet PI international : 1-4M FCFA selon nombre pays."
    },
    "0-4": {
        short: "D√©velopper vos avantages concurrentiels",
        detailed: "Identifier et renforcer vos diff√©renciateurs uniques. Innovation produit, service, positionnement. R&D export recommand√©e : 5-15% CA selon secteur."
    },

    // DIMENSION 2 : Capacit√© de Production et Logistique (ancien index 0)
    "1-0": {
        short: "√âvaluer et renforcer votre capacit√© de production",
        detailed: "R√©alisez un audit de capacit√© imm√©diat pour identifier les goulots d'√©tranglement. Planifiez les investissements n√©cessaires (√©quipements, personnel) pour absorber une croissance export de 30%. Budget estim√© : 3-8M FCFA selon la taille."
    },
    "1-1": {
        short: "Mettre aux normes vos √©quipements et infrastructures",
        detailed: "Audit de conformit√© technique urgent avec un expert sectoriel. √âtablir un plan de mise aux normes internationales (ISO, CE, etc.) avec calendrier pr√©cis. Investissement prioritaire : 2-5M FCFA."
    },
    "1-2": {
        short: "Impl√©menter un syst√®me de gestion des stocks et de planification",
        detailed: "Installer un logiciel ERP adap√© √† l'export (gestion stocks, planification production, suivi commandes). Formation √©quipes requise. Solution recommand√©e : 500K-2M FCFA selon la complexit√©."
    },
    "1-3": {
        short: "Diversifier et s√©curiser votre cha√Æne d'approvisionnement",
        detailed: "Identifier et contractualiser avec au moins 2-3 fournisseurs alternatifs par mati√®re premi√®re critique. N√©gocier des accords-cadres avec clauses de garantie d'approvisionnement. Budget s√©curisation : 1-3M FCFA."
    },
    "1-4": {
        short: "Optimiser vos d√©lais de livraison pour l'export",
        detailed: "Revoir compl√®tement votre processus de production pour garantir des d√©lais < 30 jours. Identifier les √©tapes critiques, former les √©quipes aux urgences export. Consultant logistique recommand√© : 800K-1.5M FCFA."
    },

    // DIMENSION 3 : Qualit√© et Conformit√© (ancien index 1)
    "2-0": {
    short: "Mettre en place un syst√®me de tra√ßabilit√© complet",
    detailed: "√âtablir un syst√®me de tra√ßabilit√© permettant de suivre vos produits de la mati√®re premi√®re au client final. Essentiel pour les exigences export et rappels produits. Budget : 300K-1.5M FCFA selon complexit√©."
},
    "2-1": {
        short: "Acqu√©rir les certifications qualit√© reconnues sur vos march√©s",
        detailed: "Identifier pr√©cis√©ment les certifications exig√©es par votre march√© cible (FDA, CE, HACCP, etc.). Contacter organismes certificateurs agr√©√©s. Budget certifications : 800K-3M FCFA."
    },
    "2-2": {
        short: "√âtablir un syst√®me de contr√¥le qualit√© rigoureux",
        detailed: "Cr√©er un d√©partement qualit√© d√©di√© avec proc√©dures document√©es √† chaque √©tape. Former le personnel aux contr√¥les syst√©matiques. √âquipements de contr√¥le requis : 1-5M FCFA."
    },
    "2-3": {
        short: "Adapter vos emballages aux standards internationaux",
        detailed: "Revoir compl√®tement vos emballages : r√©sistance transport international, attractivit√© visuelle, conformit√© r√©glementaire. Designer packaging export recommand√© : 500K-2M FCFA."
    },
    "2-4": {
        short: "Mettre en place des tests produits par laboratoires agr√©√©s",
        detailed: "Contractualiser avec laboratoires certifi√©s pour tests r√©guliers de vos produits. √âtablir un calendrier de contr√¥les pr√©ventifs. Co√ªt tests annuels : 300K-1M FCFA selon le secteur."
    },

    // DIMENSION 4 : Organisation et Processus Internes (ancien index 6)
    "3-0": {
        short: "Documenter et optimiser vos processus",
        detailed: "Cartographie compl√®te processus, r√©daction proc√©dures export, optimisation flux. Consultant organisation : 800K-2M FCFA selon taille entreprise."
    },
    "3-1": {
        short: "Impl√©menter un syst√®me informatique performant",
        detailed: "Installation ERP/CRM int√©grant gestion export (commandes, stocks, comptabilit√©, relation client). Solution informatique : 1-5M FCFA selon besoins."
    },
    "3-2": {
        short: "Former votre service client au multilingue",
        detailed: "Formation √©quipes service client aux sp√©cificit√©s export. Support multilingue, gestion r√©clamations internationales. Formation service client : 400K-1M FCFA."
    },
    "3-3": {
        short: "Structurer vos proc√©dures de traitement commandes export",
        detailed: "Cr√©ation workflow commandes export depuis r√©ception jusqu'√† livraison. Formation √©quipes aux sp√©cificit√©s. Optimisation process : 500K-1.5M FCFA."
    },
    "3-4": {
        short: "Former votre √©quipe aux sp√©cificit√©s internationales",
        detailed: "Programme formation commerce international pour toutes les √©quipes concern√©es. Sensibilisation interculturelle. Formation √©quipes : 300K-800K FCFA/personne."
    },

    // DIMENSION 5 : Situation Financi√®re (ancien index 2)
    "4-0": {
        short: "Assainir votre situation financi√®re",
        detailed: "Audit financier complet et plan de redressement imm√©diat. R√©duire l'endettement sous 70% des fonds propres. Renforcement capital ou restructuration dette urgente. Expert-comptable export requis."
    },
    "4-1": {
        short: "S√©curiser des financements d√©di√©s √† l'export",
        detailed: "D√©marcher banques sp√©cialis√©es export (cr√©dit export, affacturage, garanties). Constituer dossiers BPIFRANCE, AFD. Pr√©voir 2-3 mois de d√©marches. Accompagnement conseil : 400K-800K FCFA."
    },
    "4-2": {
        short: "Pr√©voir un budget investissement export",
        detailed: "Allouer minimum 10% du CA √† l'investissement export (marketing, certifications, √©quipements). √âtablir budget pluriannuel avec ROI attendu. Plan de financement sur 2-3 ans."
    },
    "4-3": {
        short: "Renforcer votre tr√©sorerie pour les cycles export",
        detailed: "Constituer une r√©serve de tr√©sorerie √©quivalente √† 90 jours de charges pour absorber les d√©lais de paiement export. Solutions : d√©couvert export, affacturage, cr√©dit relais."
    },
    "4-4": {
        short: "Organiser une comptabilit√© r√©guli√®re avec suivi professionnel",
        detailed: "Mise en place d'une comptabilit√© tenue √† jour mensuellement et validation par expert-comptable agr√©√© ou commissaire aux comptes. Logiciel comptable adap√©, formation gestion, audit annuel obligatoire. Expert-comptable, commissaire aux comptes + logiciel : 800K-1.5M FCFA/an."
    },

    // DIMENSION 6 : Ma√Ætrise des Prix et Techniques Commerciales Export (ancien index 3)
    "5-0": {
        short: "Former votre √©quipe aux Incoterms",
        detailed: "Formation intensive Incoterms 2020 pour toute l'√©quipe commerciale. Comprendre les implications co√ªts/risques de chaque terme. Formation sp√©cialis√©e recommand√©e : 200K-500K FCFA."
    },
    "5-1": {
        short: "D√©velopper une grille de prix export par march√©",
        detailed: "Cr√©er des grilles tarifaires sp√©cifiques tenant compte des co√ªts export, taxes, marges distributeurs par pays. Outil pricing export recommand√©. Consultant tarification : 400K-1M FCFA."
    },
    "5-2": {
        short: "Ma√Ætriser les techniques de paiement international",
        detailed: "Formation approfondie cr√©dit documentaire, lettres de change, garanties bancaires. N√©gocier accords cadres avec banques. Formation commerce international : 300K-600K FCFA."
    },
    "5-3": {
        short: "Mettre en place une couverture contre le risque de change",
        detailed: "Souscrire contrats de couverture change avec votre banque. D√©finir politique de couverture selon exposition. Formation risque change requise. Co√ªt couverture : 0.5-2% du CA export."
    },
    "5-4": {
        short: "Analyser votre comp√©titivit√© prix internationale",
        detailed: "√âtude comparative prix concurrents sur vos march√©s cibles. Identifier sources d'optimisation co√ªts. Repositionnement tarifaire si n√©cessaire. √âtude concurrentielle : 500K-1.5M FCFA."
    },

    // DIMENSION 7 : Exp√©rience et Comp√©tences Export (ancien index 4)
    "6-0": {
        short: "Recruter ou former une expertise commerce international",
        detailed: "Embaucher un responsable export exp√©riment√© ou former intensivement votre √©quipe actuelle. Budget recrutement : 3-8M FCFA/an ou formation : 1-3M FCFA."
    },
    "6-1": {
        short: "D√©signer et former un responsable export d√©di√©",
        detailed: "Nommer officiellement un responsable export avec pouvoir d√©cisionnel. Formation compl√®te commerce international sur 3-6 mois. Certification export recommand√©e : 800K-2M FCFA."
    },
    "6-2": {
        short: "Vous former aux r√©glementations douani√®res",
        detailed: "Formation intensive proc√©dures douani√®res, classification tarifaire, origine pr√©f√©rentielle. Contact avec transitaires agr√©√©s. Formation douanes : 300K-800K FCFA."
    },
    "6-3": {
        short: "Participer √† des salons et missions commerciales",
        detailed: "Planifier participation √† 2-3 salons internationaux sectoriels par an. Rejoindre missions commerciales ACIEX. Budget salons : 2-5M FCFA/an selon destinations."
    },
    "6-4": {
        short: "Renforcer vos comp√©tences linguistiques",
        detailed: "Formation anglais commercial pour √©quipe dirigeante et commerciale. Ma√Ætrise fran√ßais commercial si n√©cessaire. Cours intensifs recommand√©s : 500K-1.5M FCFA/personne."
    },

    // DIMENSION 8 : Innovation et D√©veloppement (ancien index 7)
    "7-0": {
        short: "Investir dans la recherche et d√©veloppement",
        detailed: "Allouer minimum 2% du CA √† la R&D export. Innovations produits, process, services pour march√©s internationaux. Budget R&D : 2-5% CA selon secteur."
    },
    "7-1": {
        short: "D√©velopper r√©guli√®rement de nouveaux produits",
        detailed: "Plan innovation produit avec 1-2 nouveaut√©s/an adapt√©es aux march√©s export. Veille technologique, partenariats R&D. Innovation continue : 3-8M FCFA/an."
    },
    "7-2": {
        short: "Organiser votre veille concurrentielle et technologique",
        detailed: "Syst√®me de veille structur√© : tendances, technologies, concurrence par march√©. Abonnements bases donn√©es, participation √©v√©nements. Veille : 500K-2M FCFA/an."
    },
    "7-3": {
        short: "√âtablir des partenariats avec centres de recherche",
        detailed: "Conventions avec universit√©s/centres de recherche pour projets innovation export. Participation clusters, p√¥les comp√©titivit√©. Partenariats R&D : 1-5M FCFA/projet."
    },
    "7-4": {
        short: "Prot√©ger et valoriser vos innovations",
        detailed: "Protection industrielle : brevets, marques, designs. Valorisation innovations via licensing, partenariats. Protection innovations : 2-6M FCFA selon portefeuille."
    },

    // DIMENSION 9 : R√©seau et Partenariats (ancien index 8)
    "8-0": {
        short: "D√©velopper vos contacts dans les march√©s cibles",
        detailed: "Strat√©gie networking syst√©matique : salons, missions, chambres de commerce. Participation √©v√©nements sectoriels. D√©veloppement r√©seau : 1-3M FCFA/an."
    },
    "8-1": {
        short: "Rejoindre des r√©seaux professionnels internationaux",
        detailed: "Adh√©sion associations professionnelles internationales, clubs export, r√©seaux sectoriels. Participation active √©v√©nements. Cotisations r√©seaux : 200K-1M FCFA/an."
    },
    "8-2": {
        short: "Identifier et contractualiser avec des distributeurs fiables",
        detailed: "Prospection distributeurs agr√©√©s, due diligence, n√©gociation contrats exclusifs/non exclusifs. Accompagnement juridique : 800K-2M FCFA selon march√©s."
    },
    "8-3": {
        short: "Renforcer vos relations avec les institutions d'appui",
        detailed: "Collaboration r√©guli√®re ACIEX, chambres commerce, organismes sectoriels. Participation programmes accompagnement. Optimisation accompagnement institutionnel."
    },
    "8-4": {
        short: "D√©velopper votre r√©seau professionnel digital",
        detailed: "Strat√©gie LinkedIn export, pr√©sence r√©seaux sectoriels, content marketing B2B. Consultant marketing digital : 500K-1.5M FCFA pour strat√©gie compl√®te."
    },

    // DIMENSION 10 : Planification et Strat√©gie Export (ancien index 9)
    "9-0": {
        short: "Formaliser votre business plan export",
        detailed: "R√©daction business plan export d√©taill√© 3 ans : march√©s, investissements, pr√©visions. Consultant strat√©gie export recommand√© : 1-3M FCFA selon complexit√©."
    },
    "9-1": {
        short: "D√©finir et suivre vos objectifs export chiffr√©s",
        detailed: "KPIs export pr√©cis avec suivi mensuel : CA, marges, parts march√©, ROI. Tableau de bord export informatis√©. Outils pilotage : 300K-800K FCFA."
    },
    "9-2": {
        short: "Allouer un budget sp√©cifique au d√©veloppement export",
        detailed: "Budget export d√©di√© repr√©sentant 10-20% CA vis√© export. R√©partition marketing, certifications, d√©veloppement. Planification budg√©taire pluriannuelle."
    },
    "9-3": {
        short: "Organiser votre veille concurrentielle syst√©matique",
        detailed: "Syst√®me veille concurrentielle structur√© par march√© : prix, innovations, strat√©gies. Outils veille professionnels. Veille concurrentielle : 400K-1.2M FCFA/an."
    },
    "9-4": {
        short: "D√©finir votre strat√©gie de p√©n√©tration par march√©",
        detailed: "Strat√©gie sp√©cifique par pays : mode d'entr√©e, partenaires, investissements, timing. Plan d√©ploiement s√©quentiel. Conseil strat√©gique : 1.5-4M FCFA selon nombre pays."
    }
};

        // Base de donn√©es des profils pays
        const countryProfiles = {
            // ===== UNION EUROP√âENNE (27 pays) =====
            'France': {
                profile: {
                    gdp: '2 940 milliards USD (2023)', gdpPerCapita: '43 659 USD', growth: '0.9% (2023)',
                    currency: 'Euro (EUR)', population: '68.4 millions', doingBusiness: '32e/190',
                    mainSectors: ['Services (78.8%)', 'Industrie (19.5%)', 'Agriculture (1.7%)'],
                    inflation: '4.9% (2023)', importVolume: '625 milliards USD',
                    keyImports: ['Cacao et d√©riv√©s', 'Caf√©', 'Huile de palme', 'Caoutchouc', 'Coton']
                },
                agreements: {
                    bilateral: ['APE UE-Afrique Ouest (2014)', 'Zone Franc CFA', 'Coop√©ration France-CI'],
                    multilateral: ['OMC', 'Union Europ√©enne', 'ACP-UE'], preferential: ['APE - 0% droits', 'SPG+']
                },
                business: {
                    strengths: ['1er partenaire historique', 'Langue commune', 'Zone Franc'], challenges: ['Normes CE strictes'],
                    opportunities: ['March√© bio', 'Diaspora'], entry_strategy: ['Certification bio UE', 'Distributeurs sp√©cialis√©s']
                },
                sectors: { 'Agro-alimentaire': { potential: 'TR√àS √âLEV√â', details: '1er importateur cacao CI', requirements: 'Bio UE, HACCP', competition: 'Forte' }}
            },
            
            'Allemagne': {
                profile: {
                    gdp: '4 260 milliards USD (2023)', gdpPerCapita: '50 794 USD', growth: '-0.3% (2023)',
                    currency: 'Euro (EUR)', population: '83.2 millions', doingBusiness: '22e/190',
                    mainSectors: ['Services (69.3%)', 'Industrie (30.1%)', 'Agriculture (0.6%)'],
                    inflation: '6.1% (2023)', importVolume: '1 560 milliards USD',
                    keyImports: ['Cacao', 'Caf√©', 'Noix cajou', 'Caoutchouc', 'Bois tropicaux']
                },
                agreements: {
                    bilateral: ['APE UE-Afrique Ouest', 'Coop√©ration Allemagne-CI'], multilateral: ['UE', 'OMC', 'G7'],
                    preferential: ['APE - 0% droits', 'SPG+', 'EBA']
                },
                business: {
                    strengths: ['1√®re √©conomie UE', 'Tech avanc√©e', 'Stabilit√©'], challenges: ['Normes DIN strictes'],
                    opportunities: ['Transition verte', 'Industrie 4.0'], entry_strategy: ['Certification T√úV', 'Salons D√ºsseldorf']
                },
                sectors: { 'Agro-alimentaire': { potential: '√âLEV√â', details: '1er importateur cacao mondial', requirements: 'Bio-Siegel, IFS', competition: 'Intense' }}
            },

            'Pays-Bas': {
                profile: {
                    gdp: '1 013 milliards USD (2023)', gdpPerCapita: '57 534 USD', growth: '0.1% (2023)',
                    currency: 'Euro (EUR)', population: '17.6 millions', doingBusiness: '42e/190',
                    mainSectors: ['Services (70.2%)', 'Industrie (17.9%)', 'Agriculture (1.6%)'],
                    inflation: '4.0% (2023)', importVolume: '720 milliards USD',
                    keyImports: ['Cacao (Port Rotterdam)', 'Caf√©', 'Caoutchouc', 'Huiles v√©g√©tales']
                },
                agreements: {
                    bilateral: ['APE UE-Afrique Ouest', 'Programme Dutch Good Growth Fund'], multilateral: ['UE', 'OMC'],
                    preferential: ['APE - 0% droits', 'SPG+']
                },
                business: {
                    strengths: ['Port Rotterdam hub', 'Expertise agro', 'N√©goce international'], challenges: ['March√© limit√©'],
                    opportunities: ['Hub europ√©en', 'Technologies agro'], entry_strategy: ['Port Rotterdam', 'Trading houses']
                },
                sectors: { 'Agro-alimentaire': { potential: 'TR√àS √âLEV√â', details: 'Hub cacao europ√©en, port Rotterdam', requirements: 'UE standards', competition: 'Mod√©r√©e' }}
            },

            'Belgique': {
                profile: {
                    gdp: '594 milliards USD (2023)', gdpPerCapita: '51 284 USD', growth: '1.4% (2023)',
                    currency: 'Euro (EUR)', population: '11.6 millions', doingBusiness: '45e/190',
                    mainSectors: ['Services (69.1%)', 'Industrie (22.1%)', 'Agriculture (0.7%)'],
                    inflation: '2.3% (2023)', importVolume: '470 milliards USD',
                    keyImports: ['Cacao (transformation)', 'Caf√©', 'Produits tropicaux']
                },
                agreements: {
                    bilateral: ['APE UE-Afrique Ouest', 'Coop√©ration belge CI'], multilateral: ['UE', 'OMC'],
                    preferential: ['APE - 0% droits', 'SPG+']
                },
                business: {
                    strengths: ['Industrie chocolat', 'Port Anvers', 'Francophonie'], challenges: ['Petit march√©'],
                    opportunities: ['Chocolat premium', 'Hub Afrique'], entry_strategy: ['Industrie choco', 'Port Anvers']
                },
                sectors: { 'Agro-alimentaire': { potential: '√âLEV√â', details: 'Centre chocolat europ√©en', requirements: 'Standards UE', competition: 'Sp√©cialis√©e' }}
            },

            'Italie': {
                profile: {
                    gdp: '2 110 milliards USD (2023)', gdpPerCapita: '35 657 USD', growth: '0.9% (2023)',
                    currency: 'Euro (EUR)', population: '59.1 millions', doingBusiness: '58e/190',
                    mainSectors: ['Services (65.9%)', 'Industrie (23.9%)', 'Agriculture (2.0%)'],
                    inflation: '5.9% (2023)', importVolume: '625 milliards USD',
                    keyImports: ['Cacao', 'Caf√©', 'Coton', 'Produits tropicaux']
                },
                agreements: {
                    bilateral: ['APE UE-Afrique Ouest'], multilateral: ['UE', 'OMC', 'G7'],
                    preferential: ['APE - 0% droits', 'SPG+']
                },
                business: {
                    strengths: ['Industrie alimentaire', 'Mode/textile', 'Design'], challenges: ['Bureaucratie'],
                    opportunities: ['Caf√© espresso', 'Mode √©thique'], entry_strategy: ['Foires Milan', 'Distributeurs Nord']
                },
                sectors: { 'Agro-alimentaire': { potential: '√âLEV√â', details: 'March√© caf√©, produits premium', requirements: 'Standards UE', competition: 'Forte' }}
            },

            'Espagne': {
                profile: {
                    gdp: '1 398 milliards USD (2023)', gdpPerCapita: '29 350 USD', growth: '2.5% (2023)',
                    currency: 'Euro (EUR)', population: '47.6 millions', doingBusiness: '30e/190',
                    mainSectors: ['Services (67.8%)', 'Industrie (20.2%)', 'Agriculture (2.7%)'],
                    inflation: '3.5% (2023)', importVolume: '425 milliards USD',
                    keyImports: ['Cacao', 'Caf√©', 'Fruits tropicaux', 'Coton']
                },
                agreements: {
                    bilateral: ['APE UE-Afrique Ouest', 'Plan √Åfrica'], multilateral: ['UE', 'OMC'],
                    preferential: ['APE - 0% droits', 'SPG+']
                },
                business: {
                    strengths: ['Porte Afrique', 'Agro-industrie', 'Relations historiques'], challenges: ['Crise √©conomique'],
                    opportunities: ['Hub Afrique-UE', 'Bio'], entry_strategy: ['Madrid hub', 'Distributeurs Andalousie']
                },
                sectors: { 'Agro-alimentaire': { potential: '√âLEV√â', details: 'March√© cacao, fruits tropicaux', requirements: 'Standards UE', competition: 'Mod√©r√©e' }}
            },

            // ===== CEDEAO (15 pays) =====
            'Ghana': {
                profile: {
                    gdp: '76.6 milliards USD (2023)', gdpPerCapita: '2 445 USD', growth: '2.9% (2023)',
                    currency: 'Cedi ghan√©en (GHS)', population: '31.7 millions', doingBusiness: '118e/190',
                    mainSectors: ['Services (46.1%)', 'Agriculture (19.7%)', 'Industrie (34.2%)'],
                    inflation: '40.4% (2023)', importVolume: '15.8 milliards USD',
                    keyImports: ['Riz', 'Huiles v√©g√©tales', 'Sucre', 'Produits transform√©s']
                },
                agreements: {
                    bilateral: ['CEDEAO libre-√©change', 'Accord CI-Ghana (2021)'], multilateral: ['CEDEAO', 'ZLECAf', 'OMC'],
                    preferential: ['CEDEAO TEC 0%', 'ZLECAf 90% produits']
                },
                business: {
                    strengths: ['Fronti√®re commune', 'CEDEAO', 'Stabilit√©'], challenges: ['Inflation √©lev√©e'],
                    opportunities: ['Transit Nigeria', 'Compl√©mentarit√©'], entry_strategy: ['Transport routier', 'Distributeurs Accra']
                },
                sectors: { 'Agro-alimentaire': { potential: '√âLEV√â', details: 'D√©ficit alimentaire important', requirements: 'FDA Ghana, CEDEAO', competition: 'Forte' }}
            },

            'Nigeria': {
                profile: {
                    gdp: '472.6 milliards USD (2023)', gdpPerCapita: '2 184 USD', growth: '3.2% (2023)',
                    currency: 'Naira (NGN)', population: '218.5 millions', doingBusiness: '131e/190',
                    mainSectors: ['Services (52.7%)', 'Agriculture (22.4%)', 'Industrie (24.9%)'],
                    inflation: '24.1% (2023)', importVolume: '67.8 milliards USD',
                    keyImports: ['Riz', 'Bl√©', 'Sucre', 'Huile v√©g√©tale']
                },
                agreements: {
                    bilateral: ['CEDEAO', 'Accord-Cadre CI-Nigeria (2019)'], multilateral: ['CEDEAO', 'ZLECAf', 'OMC'],
                    preferential: ['CEDEAO TEC', 'ZLECAf']
                },
                business: {
                    strengths: ['Plus grand march√© africain', 'CEDEAO', 'P√©trole'], challenges: ['Ins√©curit√© Nord', 'Volatilit√©'],
                    opportunities: ['218M habitants', 'Substitution imports'], entry_strategy: ['Lagos focus', 'Distributeurs √©tablis']
                },
                sectors: { 'Agro-alimentaire': { potential: 'EXCEPTIONNEL', details: 'D√©ficits: riz 4M tonnes, sucre 1.7M tonnes', requirements: 'NAFDAC, halal', competition: 'Tr√®s forte' }}
            },

            'S√©n√©gal': {
                profile: {
                    gdp: '28.9 milliards USD (2023)', gdpPerCapita: '1 675 USD', growth: '4.1% (2023)',
                    currency: 'Franc CFA (XOF)', population: '17.2 millions', doingBusiness: '123e/190',
                    mainSectors: ['Services (54.4%)', 'Agriculture (16.4%)', 'Industrie (24.2%)'],
                    inflation: '9.7% (2023)', importVolume: '8.2 milliards USD',
                    keyImports: ['Riz', 'Huile', 'Sucre', 'Bl√©']
                },
                agreements: {
                    bilateral: ['UEMOA', 'CEDEAO', 'Zone Franc CFA'], multilateral: ['UEMOA', 'CEDEAO', 'OMC'],
                    preferential: ['UEMOA 0% droits', 'CEDEAO TEC']
                },
                business: {
                    strengths: ['Zone Franc', 'Port Dakar', 'Stabilit√©'], challenges: ['Pouvoir achat limit√©'],
                    opportunities: ['Hub r√©gional', 'D√©mographie'], entry_strategy: ['Port Dakar', 'Distribution terrestre']
                },
                sectors: { 'Agro-alimentaire': { potential: '√âLEV√â', details: 'D√©ficit riz 800K tonnes', requirements: 'Standards CEDEAO', competition: 'Mod√©r√©e' }}
            },

            'Mali': {
                profile: {
                    gdp: '19.1 milliards USD (2023)', gdpPerCapita: '875 USD', growth: '3.1% (2023)',
                    currency: 'Franc CFA (XOF)', population: '21.9 millions', doingBusiness: '148e/190',
                    mainSectors: ['Agriculture (38.5%)', 'Services (35.6%)', 'Industrie (19.9%)'],
                    inflation: '2.0% (2023)', importVolume: '4.2 milliards USD',
                    keyImports: ['Produits p√©troliers', 'Machines', 'Produits alimentaires']
                },
                agreements: {
                    bilateral: ['UEMOA', 'CEDEAO', 'Zone Franc CFA'], multilateral: ['UEMOA', 'CEDEAO', 'OMC'],
                    preferential: ['UEMOA 0%', 'CEDEAO TEC']
                },
                business: {
                    strengths: ['Zone Franc', 'UEMOA', 'Or'], challenges: ['Instabilit√© s√©curitaire', 'Enclavement'],
                    opportunities: ['Mines', 'Agriculture'], entry_strategy: ['Via S√©n√©gal/CI', 'Partenaires locaux']
                },
                sectors: { 'Agro-alimentaire': { potential: 'MOYEN', details: 'March√© limit√©, ins√©curit√©', requirements: 'UEMOA standards', competition: 'Faible' }}
            },

            'Burkina Faso': {
                profile: {
                    gdp: '18.9 milliards USD (2023)', gdpPerCapita: '845 USD', growth: '2.8% (2023)',
                    currency: 'Franc CFA (XOF)', population: '22.4 millions', doingBusiness: '151e/190',
                    mainSectors: ['Agriculture (31.2%)', 'Services (44.2%)', 'Industrie (23.9%)'],
                    inflation: '1.9% (2023)', importVolume: '3.8 milliards USD',
                    keyImports: ['Produits p√©troliers', 'Machines', 'Produits alimentaires']
                },
                agreements: {
                    bilateral: ['UEMOA', 'CEDEAO', 'Zone Franc CFA'], multilateral: ['UEMOA', 'CEDEAO', 'OMC'],
                    preferential: ['UEMOA 0%', 'CEDEAO TEC']
                },
                business: {
                    strengths: ['Zone Franc', 'UEMOA', 'Coton'], challenges: ['Enclavement', 'Instabilit√©'],
                    opportunities: ['Mines', 'Coton'], entry_strategy: ['Via CI', 'Transport routier']
                },
                sectors: { 'Agro-alimentaire': { potential: 'MOYEN', details: 'March√© agricole', requirements: 'UEMOA', competition: 'Faible' }}
            },

            // ===== AM√âRIQUE DU NORD =====
            '√âtats-Unis': {
                profile: {
                    gdp: '26 950 milliards USD (2023)', gdpPerCapita: '80 412 USD', growth: '2.5% (2023)',
                    currency: 'Dollar am√©ricain (USD)', population: '331.9 millions', doingBusiness: '6e/190',
                    mainSectors: ['Services (80.2%)', 'Industrie (19.1%)', 'Agriculture (0.7%)'],
                    inflation: '4.1% (2023)', importVolume: '3 176 milliards USD',
                    keyImports: ['Cacao', 'Caf√©', 'Noix cajou', 'Caoutchouc', 'Textiles']
                },
                agreements: {
                    bilateral: ['AGOA - African Growth Opportunity Act', 'Trait√© Investissement CI-USA (1998)'],
                    multilateral: ['OMC', 'Millennium Challenge Corporation'], preferential: ['AGOA - 0% droits 6400+ produits']
                },
                business: {
                    strengths: ['AGOA pr√©f√©rences', 'March√© √©norme', 'Diaspora'], challenges: ['FDA/USDA strict', 'Concurrence'],
                    opportunities: ['Produits authentiques', 'E-commerce'], entry_strategy: ['AGOA utilisation', 'Distributeurs ethniques']
                },
                sectors: { 'Agro-alimentaire': { potential: 'TR√àS √âLEV√â', details: 'AGOA facilite acc√®s, demande cacao/caf√©', requirements: 'FDA, USDA Organic', competition: 'Tr√®s forte' }}
            },

            'Canada': {
                profile: {
                    gdp: '2 140 milliards USD (2023)', gdpPerCapita: '54 966 USD', growth: '1.1% (2023)',
                    currency: 'Dollar canadien (CAD)', population: '38.9 millions', doingBusiness: '23e/190',
                    mainSectors: ['Services (70.2%)', 'Industrie (27.7%)', 'Agriculture (1.6%)'],
                    inflation: '3.9% (2023)', importVolume: '632 milliards USD',
                    keyImports: ['Cacao', 'Caf√©', 'Produits tropicaux']
                },
                agreements: {
                    bilateral: ['Programme Aide Canada-Afrique'], multilateral: ['OMC', 'Commonwealth', 'Francophonie'],
                    preferential: ['SPG Canada', 'Pr√©f√©rences LDC']
                },
                business: {
                    strengths: ['Commonwealth', 'Francophonie', 'Ouverture'], challenges: ['Distance', 'March√© limit√©'],
                    opportunities: ['Diaspora', 'Produits bio'], entry_strategy: ['Montr√©al hub', 'Certification bio Canada']
                },
                sectors: { 'Agro-alimentaire': { potential: 'MOYEN-√âLEV√â', details: 'March√© niche, bio valoris√©', requirements: 'CFIA, bio Canada', competition: 'Mod√©r√©e' }}
            },

            // ===== ASIE-PACIFIQUE =====
            'Chine': {
                profile: {
                    gdp: '17 734 milliards USD (2023)', gdpPerCapita: '12 541 USD', growth: '5.2% (2023)',
                    currency: 'Yuan (CNY)', population: '1.412 milliards', doingBusiness: '46e/190',
                    mainSectors: ['Services (52.8%)', 'Industrie (39.4%)', 'Agriculture (7.8%)'],
                    inflation: '0.2% (2023)', importVolume: '2 693 milliards USD',
                    keyImports: ['Cacao (CI 1er fournisseur)', 'Caoutchouc', 'Bois', 'Minerais']
                },
                agreements: {
                    bilateral: ['FOCAC - Forum Coop√©ration Chine-Afrique', 'Accord Commercial Pr√©f√©rentiel (2021)'],
                    multilateral: ['OMC', 'Initiative Ceinture-Route'], preferential: ['PMA - 97% produits 0%', 'FOCAC pr√©f√©rences']
                },
                business: {
                    strengths: ['1er acheteur cacao CI', 'Investissements massifs', 'BRI'], challenges: ['Normes complexes', 'Langue'],
                    opportunities: ['Classe moyenne', 'E-commerce'], entry_strategy: ['Certification CCC', 'Foires Canton']
                },
                sectors: { 'Agro-alimentaire': { potential: 'EXCEPTIONNEL', details: 'CI = 35% imports cacao chinois', requirements: 'AQSIQ, CIQ', competition: 'Mod√©r√©e - relations privil√©gi√©es' }}
            },

            'Inde': {
                profile: {
                    gdp: '3 736 milliards USD (2023)', gdpPerCapita: '2 612 USD', growth: '6.3% (2023)',
                    currency: 'Roupie (INR)', population: '1.428 milliards', doingBusiness: '63e/190',
                    mainSectors: ['Services (54.4%)', 'Industrie (26.2%)', 'Agriculture (19.4%)'],
                    inflation: '5.4% (2023)', importVolume: '760 milliards USD',
                    keyImports: ['Huiles v√©g√©tales', 'Or', 'Noix cajou', 'Cacao']
                },
                agreements: {
                    bilateral: ['India-Africa Partnership', 'Ligne Cr√©dit Inde-Afrique 12Mds USD'], multilateral: ['OMC', 'Commonwealth'],
                    preferential: ['GSTP', 'Pr√©f√©rences commerciales Inde-Afrique']
                },
                business: {
                    strengths: ['March√© √©norme', 'Croissance forte', 'Commonwealth'], challenges: ['Bureaucratie', 'Normes'],
                    opportunities: ['Classe moyenne 350M', 'Digitalisation'], entry_strategy: ['Mumbai/Delhi', 'E-commerce']
                },
                sectors: { 'Agro-alimentaire': { potential: 'TR√àS √âLEV√â', details: 'D√©ficit huiles 15M tonnes, demande noix cajou', requirements: 'FSSAI, Plant Quarantine', competition: 'Forte' }}
            },

            'Japon': {
                profile: {
                    gdp: '4 940 milliards USD (2023)', gdpPerCapita: '39 285 USD', growth: '1.9% (2023)',
                    currency: 'Yen (JPY)', population: '125.8 millions', doingBusiness: '29e/190',
                    mainSectors: ['Services (69.4%)', 'Industrie (29.1%)', 'Agriculture (1.1%)'],
                    inflation: '3.2% (2023)', importVolume: '720 milliards USD',
                    keyImports: ['Cacao', 'Caf√©', 'Caoutchouc', 'Bois tropicaux']
                },
                agreements: {
                    bilateral: ['TICAD - Conf√©rence Tokyo D√©veloppement Afrique'], multilateral: ['OMC', 'G7'],
                    preferential: ['SPG Japon', 'TICAD pr√©f√©rences commerciales']
                },
                business: {
                    strengths: ['Technologie avanc√©e', 'Qualit√© valoris√©e', 'TICAD'], challenges: ['Normes tr√®s strictes', 'March√© ferm√©'],
                    opportunities: ['Produits premium', 'Tech'], entry_strategy: ['Partenaires japonais', 'Certification JAS']
                },
                sectors: { 'Agro-alimentaire': { potential: 'MOYEN-√âLEV√â', details: 'March√© niche, qualit√© premium', requirements: 'JAS, HACCP, tra√ßabilit√©', competition: 'Forte' }}
            },

            // ===== MOYEN-ORIENT =====
            '√âmirats Arabes Unis': {
                profile: {
                    gdp: '507.5 milliards USD (2023)', gdpPerCapita: '51 475 USD', growth: '3.6% (2023)',
                    currency: 'Dirham (AED)', population: '9.9 millions', doingBusiness: '16e/190',
                    mainSectors: ['Services (51.4%)', 'Industrie (41.2%)', 'Agriculture (7.4%)'],
                    inflation: '4.8% (2023)', importVolume: '350 milliards USD',
                    keyImports: ['Produits alimentaires (85% imports)', 'Cacao', 'Caf√©', '√âpices']
                },
                agreements: {
                    bilateral: ['Partenariat Strat√©gique EAU-Afrique', 'Fonds D√©veloppement Abu Dhabi'], multilateral: ['OMC', 'CCG'],
                    preferential: ['Statut PMA pr√©f√©rences', 'Hub r√©exportation']
                },
                business: {
                    strengths: ['Hub Moyen-Orient/Afrique', 'Zone franche', 'Infrastructure'], challenges: ['Concurrence', 'Co√ªt vie'],
                    opportunities: ['R√©exportation r√©gionale', 'Halal'], entry_strategy: ['Zone franche Dubai', 'Certification halal']
                },
                sectors: { 'Agro-alimentaire': { potential: '√âLEV√â', details: 'Hub r√©exportation, march√© halal', requirements: 'ESMA, halal, HACCP', competition: 'Intense' }}
            },

            'Arabie Saoudite': {
                profile: {
                    gdp: '833 milliards USD (2023)', gdpPerCapita: '25 266 USD', growth: '0.8% (2023)',
                    currency: 'Riyal (SAR)', population: '35.0 millions', doingBusiness: '62e/190',
                    mainSectors: ['Services (46.7%)', 'Industrie (44.2%)', 'Agriculture (2.4%)'],
                    inflation: '2.3% (2023)', importVolume: '175 milliards USD',
                    keyImports: ['Produits alimentaires', 'Cacao', 'Caf√©', '√âpices']
                },
                agreements: {
                    bilateral: ['Fonds D√©veloppement Saoudien Afrique'], multilateral: ['OMC', 'CCG', 'OCI'],
                    preferential: ['Pr√©f√©rences commerciales CCG-Afrique']
                },
                business: {
                    strengths: ['March√© solvable', 'Vision 2030', 'P√©trole'], challenges: ['Normes halal strictes'],
                    opportunities: ['Diversification √©conomique', 'March√© halal'], entry_strategy: ['Certification halal', 'Distributeurs Riyad']
                },
                sectors: { 'Agro-alimentaire': { potential: '√âLEV√â', details: 'March√© halal, imports alimentaires', requirements: 'SFDA, halal obligatoire', competition: 'Forte' }}
            },

            // ===== AFRIQUE DU NORD =====
            'Maroc': {
                profile: {
                    gdp: '134.2 milliards USD (2023)', gdpPerCapita: '3 582 USD', growth: '3.1% (2023)',
                    currency: 'Dirham (MAD)', population: '37.5 millions', doingBusiness: '53e/190',
                    mainSectors: ['Services (55.2%)', 'Industrie (29.5%)', 'Agriculture (15.3%)'],
                    inflation: '6.1% (2023)', importVolume: '69.8 milliards USD',
                    keyImports: ['C√©r√©ales', 'Huiles', 'Sucre', 'Th√©', 'Caf√©']
                },
                agreements: {
                    bilateral: ['Accord Commercial Maroc-CEDEAO (n√©gociation)', 'Partenariat Sud-Sud'], multilateral: ['OMC', 'Union Africaine'],
                    preferential: ['N√©gociations ALE Maroc-CEDEAO']
                },
                business: {
                    strengths: ['Hub Afrique-Europe', 'Stabilit√©', 'Infrastructure'], challenges: ['Concurrence UE'],
                    opportunities: ['Industrialisation', 'Hub r√©gional'], entry_strategy: ['Casablanca hub', 'SIAM salon']
                },
                sectors: { 'Agro-alimentaire': { potential: 'TR√àS √âLEV√â', details: 'D√©ficits: c√©r√©ales, huiles, sucre', requirements: 'ONSSA, halal', competition: 'Forte' }}
            },

            'Tunisie': {
                profile: {
                    gdp: '48.3 milliards USD (2023)', gdpPerCapita: '4 024 USD', growth: '0.4% (2023)',
                    currency: 'Dinar tunisien (TND)', population: '12.0 millions', doingBusiness: '78e/190',
                    mainSectors: ['Services (61.6%)', 'Industrie (26.2%)', 'Agriculture (10.1%)'],
                    inflation: '9.3% (2023)', importVolume: '22.1 milliards USD',
                    keyImports: ['C√©r√©ales', 'Huiles v√©g√©tales', 'Sucre', 'Caf√©']
                },
                agreements: {
                    bilateral: ['Accord Commercial Tunisie-Afrique Ouest'], multilateral: ['OMC', 'Union Africaine'],
                    preferential: ['Pr√©f√©rences intra-africaines']
                },
                business: {
                    strengths: ['Proximit√© Europe', 'Main-≈ìuvre qualifi√©e'], challenges: ['Instabilit√© politique'],
                    opportunities: ['Hub M√©diterran√©e', 'Agro-industrie'], entry_strategy: ['Tunis hub', 'Partenaires industriels']
                },
                sectors: { 'Agro-alimentaire': { potential: 'MOYEN-√âLEV√â', details: 'Imports alimentaires, transformation', requirements: 'Standards tunisiens', competition: 'Mod√©r√©e' }}
            },

            '√âgypte': {
                profile: {
                    gdp: '469.1 milliards USD (2023)', gdpPerCapita: '4 295 USD', growth: '3.8% (2023)',
                    currency: 'Livre √©gyptienne (EGP)', population: '109.3 millions', doingBusiness: '114e/190',
                    mainSectors: ['Services (52.8%)', 'Industrie (32.8%)', 'Agriculture (11.3%)'],
                    inflation: '33.9% (2023)', importVolume: '89.7 milliards USD',
                    keyImports: ['C√©r√©ales', 'Huiles v√©g√©tales', 'Sucre', 'Th√©']
                },
                agreements: {
                    bilateral: ['Coop√©ration √âgypte-Afrique Ouest'], multilateral: ['OMC', 'Union Africaine', 'Ligue Arabe'],
                    preferential: ['COMESA pr√©f√©rences']
                },
                business: {
                    strengths: ['Plus grand march√© arabe', 'Canal Suez'], challenges: ['Inflation √©lev√©e', 'Bureaucratie'],
                    opportunities: ['100M+ habitants', 'Industrie'], entry_strategy: ['Le Caire hub', 'Distributeurs √©tablis']
                },
                sectors: { 'Agro-alimentaire': { potential: '√âLEV√â', details: '1er importateur mondial bl√©', requirements: 'Standards √©gyptiens', competition: 'Tr√®s forte' }}
            },

            // ===== AM√âRIQUE LATINE =====
            'Br√©sil': {
                profile: {
                    gdp: '2 127 milliards USD (2023)', gdpPerCapita: '10 083 USD', growth: '2.9% (2023)',
                    currency: 'Real (BRL)', population: '215.3 millions', doingBusiness: '124e/190',
                    mainSectors: ['Services (63.9%)', 'Industrie (20.7%)', 'Agriculture (15.4%)'],
                    inflation: '4.6% (2023)', importVolume: '287 milliards USD',
                    keyImports: ['Cacao (compl√©ment production)', 'Caf√© sp√©cialis√©', 'Produits tropicaux']
                },
                agreements: {
                    bilateral: ['Coop√©ration Sud-Sud Br√©sil-Afrique'], multilateral: ['OMC', 'MERCOSUL', 'BRICS'],
                    preferential: ['MERCOSUL-SADC en n√©gociation']
                },
                business: {
                    strengths: ['Plus grande √©conomie Am√©rique Sud', 'Lusophonie'], challenges: ['Volatilit√© √©conomique'],
                    opportunities: ['Coop√©ration Sud-Sud', 'Tech agro'], entry_strategy: ['S√£o Paulo hub', 'Coop√©ration technique']
                },
                sectors: { 'Agro-alimentaire': { potential: 'MOYEN', details: 'Niches sp√©cialis√©es, cacao fine', requirements: 'ANVISA, bio Br√©sil', competition: 'Locale forte' }}
            },

            'Argentine': {
                profile: {
                    gdp: '487.2 milliards USD (2023)', gdpPerCapita: '10 729 USD', growth: '-1.6% (2023)',
                    currency: 'Peso argentin (ARS)', population: '45.4 millions', doingBusiness: '126e/190',
                    mainSectors: ['Services (61.8%)', 'Industrie (23.1%)', 'Agriculture (6.8%)'],
                    inflation: '211.4% (2023)', importVolume: '76.4 milliards USD',
                    keyImports: ['Cacao', 'Caf√©', 'Th√©', '√âpices']
                },
                agreements: {
                    bilateral: ['Coop√©ration Sud-Sud'], multilateral: ['OMC', 'MERCOSUL', 'G20'],
                    preferential: ['MERCOSUL pr√©f√©rences']
                },
                business: {
                    strengths: ['March√© sophistiqu√©', 'Agriculture d√©velopp√©e'], challenges: ['Hyperinflation', 'Instabilit√©'],
                    opportunities: ['March√© premium', 'Agro-tech'], entry_strategy: ['Buenos Aires', 'Paiements adapt√©s']
                },
                sectors: { 'Agro-alimentaire': { potential: 'MOYEN', details: 'March√© niche, instabilit√© macro', requirements: 'SENASA', competition: 'Limit√©e' }}
            },

            // ===== AUTRES PARTENAIRES IMPORTANTS =====
            'Royaume-Uni': {
                profile: {
                    gdp: '3 131 milliards USD (2023)', gdpPerCapita: '46 125 USD', growth: '0.5% (2023)',
                    currency: 'Livre sterling (GBP)', population: '67.9 millions', doingBusiness: '8e/190',
                    mainSectors: ['Services (71.7%)', 'Industrie (18.2%)', 'Agriculture (0.6%)'],
                    inflation: '7.3% (2023)', importVolume: '775 milliards USD',
                    keyImports: ['Cacao', 'Caf√©', 'Th√©', '√âpices']
                },
                agreements: {
                    bilateral: ['EPA UK-Afrique Ouest (post-Brexit)', 'UK-Africa Investment Summit'], multilateral: ['OMC', 'Commonwealth'],
                    preferential: ['EPA UK - 0% droits', 'Commonwealth pr√©f√©rences']
                },
                business: {
                    strengths: ['Commonwealth', 'Place financi√®re', 'Anglais'], challenges: ['Post-Brexit ajustements'],
                    opportunities: ['Propre politique commerciale', 'Liens historiques'], entry_strategy: ['Londres hub', 'Commonwealth network']
                },
                sectors: { 'Agro-alimentaire': { potential: '√âLEV√â', details: 'Post-Brexit opportunit√©s', requirements: 'UK standards', competition: 'Forte' }}
            },

            'Suisse': {
                profile: {
                    gdp: '807 milliards USD (2023)', gdpPerCapita: '92 371 USD', growth: '0.9% (2023)',
                    currency: 'Franc suisse (CHF)', population: '8.7 millions', doingBusiness: '36e/190',
                    mainSectors: ['Services (73.7%)', 'Industrie (25.6%)', 'Agriculture (0.7%)'],
                    inflation: '2.1% (2023)', importVolume: '385 milliards USD',
                    keyImports: ['Cacao (n√©goce)', 'Caf√©', 'Or', 'Mati√®res premi√®res']
                },
                agreements: {
                    bilateral: ['SECO - Coop√©ration √©conomique Suisse-Afrique'], multilateral: ['OMC', 'AELE'],
                    preferential: ['SPG Suisse', 'SECO pr√©f√©rences']
                },
                business: {
                    strengths: ['Centre n√©goce mati√®res premi√®res', 'Technologie', 'Qualit√©'], challenges: ['March√© petit', 'Co√ªts √©lev√©s'],
                    opportunities: ['Trading houses', 'Tech/innovation'], entry_strategy: ['Gen√®ve trading', 'Innovation partnerships']
                },
                sectors: { 'Agro-alimentaire': { potential: 'MOYEN-√âLEV√â', details: 'Hub n√©goce, chocolat premium', requirements: 'Standards suisses stricts', competition: 'Sp√©cialis√©e' }}
            },

            'Turquie': {
                profile: {
                    gdp: '819 milliards USD (2023)', gdpPerCapita: '9 661 USD', growth: '4.5% (2023)',
                    currency: 'Livre turque (TRY)', population: '84.8 millions', doingBusiness: '33e/190',
                    mainSectors: ['Services (54.2%)', 'Industrie (32.0%)', 'Agriculture (6.1%)'],
                    inflation: '64.3% (2023)', importVolume: '364 milliards USD',
                    keyImports: ['Cacao', 'Caf√©', 'Th√©', '√âpices', 'Coton']
                },
                agreements: {
                    bilateral: ['Partenariat Turquie-Afrique'], multilateral: ['OMC', 'OCI'],
                    preferential: ['SPG Turquie', 'OCI pr√©f√©rences']
                },
                business: {
                    strengths: ['Pont Europe-Asie-Afrique', 'Industrie d√©velopp√©e'], challenges: ['Inflation tr√®s forte'],
                    opportunities: ['Hub r√©gional', 'Industrie textile'], entry_strategy: ['Istanbul hub', 'Partenaires industriels']
                },
                sectors: { 'Agro-alimentaire': { potential: '√âLEV√â', details: 'Industrie alimentaire d√©velopp√©e', requirements: 'Standards turcs', competition: 'Forte' }}
            },

'Afrique du Sud': {
    profile: {
        gdp: '420 milliards USD (2023)', gdpPerCapita: '7 055 USD', growth: '0.6% (2023)',
        currency: 'Rand sud-africain (ZAR)', population: '59.3 millions', doingBusiness: '84e/190',
        mainSectors: ['Services (61.4%)', 'Industrie (29.7%)', 'Agriculture (2.8%)'],
        inflation: '6.0% (2023)', importVolume: '108 milliards USD',
        keyImports: ['Machines', 'Produits chimiques', 'Produits alimentaires', 'Textiles']
    },
    agreements: {
        bilateral: ['SADC', 'Accord Tripartite COMESA-EAC-SADC'], multilateral: ['OMC', 'Union Africaine', 'BRICS'],
        preferential: ['SADC libre-√©change', 'ZLECAf', 'SPG+']
    },
    business: {
        strengths: ['1√®re √©conomie africaine', 'Infrastructure d√©velopp√©e', 'Secteur financier avanc√©'], 
        challenges: ['Lourdeurs administratives', 'Criminalit√©'],
        opportunities: ['Hub r√©gional Afrique australe', 'March√© sophistiqu√©'], 
        entry_strategy: ['Johannesburg/Le Cap hub', 'Partenaires locaux exp√©riment√©s']
    },
    sectors: { 'Agro-alimentaire': { potential: '√âLEV√â', details: 'March√© sophistiqu√©, demande produits premium', requirements: 'SABS, HACCP', competition: 'Forte' }}
}
        };

// Fonction helper pour trouver l'ID d'une question
function findQuestionId(questionText) {
    let foundQuestionId = null;
    dimensions.forEach((dimension, dimIndex) => {
        dimension.questions.forEach((question, qIndex) => {
            if (question === questionText) {
                foundQuestionId = `${dimIndex}-${qIndex}`;
            }
        });
    });
    return foundQuestionId;
}

// Fonction helper pour trouver l'ID d'une question
function findQuestionId(questionText) {
    let foundQuestionId = null;
    dimensions.forEach((dimension, dimIndex) => {
        dimension.questions.forEach((question, qIndex) => {
            if (question === questionText) {
                foundQuestionId = `${dimIndex}-${qIndex}`;
            }
        });
    });
    return foundQuestionId;
}

// Transformer les questions en constats n√©gatifs
function transformQuestionToStatement(question) {
    // Pour les certifications avec score 4, ne pas transformer en n√©gatif
    const questionId = findQuestionId(question);
    if (question.includes('certifications qualit√©') && questionId && currentData.scores[questionId] === 4) {
        return `L'entreprise dispose de certifications qualit√© reconnues dans ses march√©s cibles`;
    }
    
    const transformations = {
                // Production et Logistique
        "Votre entreprise dispose-t-elle d'une capacit√© de production suffisante pour r√©pondre √† une demande export suppl√©mentaire de 30% ?": "L'entreprise ne dispose pas d'une capacit√© de production suffisante pour r√©pondre √† une demande export suppl√©mentaire de 30%",
        "Avez-vous des √©quipements et infrastructures conformes aux standards internationaux ?": "L'entreprise n'a pas d'√©quipements et infrastructures conformes aux standards internationaux",
        "Disposez-vous d'un syst√®me de gestion des stocks et de planification de production efficace ?": "L'entreprise ne dispose pas d'un syst√®me de gestion des stocks et de planification de production efficace",
        "Votre cha√Æne d'approvisionnement est-elle fiable et diversifi√©e ?": "La cha√Æne d'approvisionnement n'est pas fiable et diversifi√©e",
        "Pouvez-vous garantir des d√©lais de livraison courts et respect√©s (moins de 30 jours) ?": "L'entreprise ne peut pas garantir des d√©lais de livraison courts et respect√©s (moins de 30 jours)",

        // Qualit√© et Conformit√©
        "Disposez-vous d'un syst√®me de tra√ßabilit√© complet de vos produits ?": "L'entreprise ne dispose pas d'un syst√®me de tra√ßabilit√© complet de ses produits",
        "Disposez-vous de certifications qualit√© reconnues dans vos march√©s cibles ?": "L'entreprise ne dispose pas de certifications qualit√© reconnues dans ses march√©s cibles",
        "Avez-vous un syst√®me de contr√¥le qualit√© rigoureux √† toutes les √©tapes ?": "L'entreprise n'a pas de syst√®me de contr√¥le qualit√© rigoureux √† toutes les √©tapes",
        "Vos emballages sont-ils adapt√©s au transport international et attractifs ?": "Les emballages ne sont pas adapt√©s au transport international et attractifs",
        "Effectuez-vous r√©guli√®rement des tests produits par des laboratoires agr√©√©s ?": "L'entreprise n'effectue pas r√©guli√®rement des tests produits par des laboratoires agr√©√©s",

        // Situation Financi√®re
        "Votre entreprise dispose-t-elle d'une situation financi√®re saine (ratios d'endettement < 70%) ?": "L'entreprise ne dispose pas d'une situation financi√®re saine (ratios d'endettement > 70%)",
        "Avez-vous acc√®s √† des financements d√©di√©s √† l'export (cr√©dit export, affacturage) ?": "L'entreprise n'a pas acc√®s √† des financements d√©di√©s √† l'export (cr√©dit export, affacturage)",
        "Pouvez-vous investir au moins 10% de votre CA dans le d√©veloppement export ?": "L'entreprise ne peut pas investir au moins 10% de son CA dans le d√©veloppement export",
        "Disposez-vous d'une tr√©sorerie suffisante pour supporter 90 jours de d√©calage de paiement ?": "L'entreprise ne dispose pas d'une tr√©sorerie suffisante pour supporter 90 jours de d√©calage de paiement",
        "Votre comptabilit√© est-elle aux normes internationales (IFRS/OHADA) ?": "La comptabilit√© n'est pas aux normes internationales (IFRS/OHADA)",

        // Prix et Techniques Commerciales
        "Ma√Ætrisez-vous les Incoterms et leur impact sur vos prix ?": "L'entreprise ne ma√Ætrise pas les Incoterms et leur impact sur les prix",
        "Avez-vous une grille de prix adapt√©e √† chaque march√© cible ?": "L'entreprise n'a pas de grille de prix adapt√©e √† chaque march√© cible",
        "Connaissez-vous les techniques de paiement international (cr√©dit documentaire, etc.) ?": "L'entreprise ne conna√Æt pas les techniques de paiement international (cr√©dit documentaire, etc.)",
        "Disposez-vous d'outils de couverture contre le risque de change ?": "L'entreprise ne dispose pas d'outils de couverture contre le risque de change",
        "Vos prix sont-ils comp√©titifs par rapport √† la concurrence internationale ?": "Les prix ne sont pas comp√©titifs par rapport √† la concurrence internationale",

        // Exp√©rience et Comp√©tences
        "Votre √©quipe a-t-elle une exp√©rience du commerce international ?": "L'√©quipe n'a pas d'exp√©rience du commerce international",
        "Disposez-vous d'un responsable export d√©di√© et form√© ?": "L'entreprise ne dispose pas d'un responsable export d√©di√© et form√©",
        "Connaissez-vous les r√©glementations douani√®res de vos march√©s cibles ?": "L'entreprise ne conna√Æt pas les r√©glementations douani√®res de ses march√©s cibles",
        "Avez-vous d√©j√† particip√© √† des salons internationaux ou missions commerciales ?": "L'entreprise n'a jamais particip√© √† des salons internationaux ou missions commerciales",
        "Ma√Ætrisez-vous les langues de vos march√©s cibles (anglais, fran√ßais, etc.) ?": "L'entreprise ne ma√Ætrise pas les langues de ses march√©s cibles (anglais, fran√ßais, etc.)",

        // Produit et Positionnement
        "Votre produit/service r√©pond-il √† un besoin sp√©cifique sur les march√©s export ?": "Le produit/service ne r√©pond pas √† un besoin sp√©cifique sur les march√©s export",
        "Avez-vous adapt√© votre offre aux go√ªts et pr√©f√©rences locales ?": "L'entreprise n'a pas adapt√© son offre aux go√ªts et pr√©f√©rences locales",
        "Votre marque et communication sont-elles attractives √† l'international ?": "La marque et communication ne sont pas attractives √† l'international",
        "Disposez-vous d'une protection intellectuelle de vos produits (brevets, marques) ?": "L'entreprise ne dispose pas d'une protection intellectuelle de ses produits (brevets, marques)",
        "Vos produits ont-ils un avantage concurrentiel distinctif ?": "Les produits n'ont pas d'avantage concurrentiel distinctif",

        // Organisation et Processus
        "Vos processus internes sont-ils document√©s et optimis√©s ?": "Les processus internes ne sont pas document√©s et optimis√©s",
        "Disposez-vous d'un syst√®me informatique performant (ERP, CRM) ?": "L'entreprise ne dispose pas d'un syst√®me informatique performant (ERP, CRM)",
        "Votre service client peut-il g√©rer des demandes en plusieurs langues ?": "Le service client ne peut pas g√©rer des demandes en plusieurs langues",
        "Avez-vous des proc√©dures claires pour traiter les commandes export ?": "L'entreprise n'a pas de proc√©dures claires pour traiter les commandes export",
        "Votre √©quipe est-elle form√©e aux sp√©cificit√©s du commerce international ?": "L'√©quipe n'est pas form√©e aux sp√©cificit√©s du commerce international",

        // Innovation et D√©veloppement
        "Investissez-vous r√©guli√®rement dans la R&D (au moins 2% du CA) ?": "L'entreprise n'investit pas r√©guli√®rement dans la R&D (moins de 2% du CA)",
        "Votre entreprise d√©veloppe-t-elle de nouveaux produits/services annuellement ?": "L'entreprise ne d√©veloppe pas de nouveaux produits/services annuellement",
        "Suivez-vous les tendances et innovations de votre secteur ?": "L'entreprise ne suit pas les tendances et innovations de son secteur",
        "Collaborez-vous avec des centres de recherche ou universit√©s ?": "L'entreprise ne collabore pas avec des centres de recherche ou universit√©s",
        "Vos innovations sont-elles prot√©g√©es et valoris√©es ?": "Les innovations ne sont pas prot√©g√©es et valoris√©es",

        // R√©seau et Partenariats
        "Avez-vous des contacts ou partenaires dans vos march√©s cibles ?": "L'entreprise n'a pas de contacts ou partenaires dans ses march√©s cibles",
        "Participez-vous √† des r√©seaux professionnels internationaux ?": "L'entreprise ne participe pas √† des r√©seaux professionnels internationaux",
        "Disposez-vous de distributeurs ou agents commerciaux fiables ?": "L'entreprise ne dispose pas de distributeurs ou agents commerciaux fiables",
        "Entretenez-vous des relations avec les institutions d'appui √† l'export ?": "L'entreprise n'entretient pas de relations avec les institutions d'appui √† l'export",
        "Votre r√©seau LinkedIn/professionnel est-il d√©velopp√© internationalement ?": "Le r√©seau LinkedIn/professionnel n'est pas d√©velopp√© internationalement",

        // Planification et Strat√©gie
        "Avez-vous un business plan export formalis√© sur 3 ans ?": "L'entreprise n'a pas de business plan export formalis√© sur 3 ans",
        "Vos objectifs export sont-ils chiffr√©s et suivis mensuellement ?": "Les objectifs export ne sont pas chiffr√©s et suivis mensuellement",
        "Allouez-vous un budget sp√©cifique au d√©veloppement export ?": "L'entreprise n'alloue pas de budget sp√©cifique au d√©veloppement export",
        "Effectuez-vous une veille concurrentielle sur vos march√©s cibles ?": "L'entreprise n'effectue pas de veille concurrentielle sur ses march√©s cibles",
        "Avez-vous d√©fini une strat√©gie de p√©n√©tration par march√© ?": "L'entreprise n'a pas d√©fini de strat√©gie de p√©n√©tration par march√©"
    };

    return transformations[question] || question;
}

// G√©n√©rer le diagnostic d√©taill√©
        function generateDetailedDiagnosis() {
            const container = document.getElementById('detailedContainer');
            const results = currentData.results;
            const company = currentData.company;
            const targetCountry = company.targetMarket;
            
            if (!results || !targetCountry) {
                container.innerHTML = `
                    <div class="alert alert-warning">
                        <strong>Diagnostic d√©taill√© indisponible.</strong><br>
                        Veuillez compl√©ter l'√©valuation et s√©lectionner un march√© cible.
                    </div>
                `;
                return;
            }
            
            const countryData = countryProfiles[targetCountry];
            // ‚úÖ CORRECTION BUG : Ne plus arr√™ter si pas de donn√©es pays

// G√©n√©ration du rapport complet avec navigation secondaire
let html = createSecondaryNav(detailedNavItems);

html += `<div id="profil-entreprise" class="anchor-section">`;
html += `<h3 class="anchor-title">üè¢ PROFIL ENTREPRISE</h3>`;
html += generateCompanyDiagnosis(company, results, countryData);
html += `</div>`;

// AJOUTER L'ANALYSE DES D√âFAILLANCES CRITIQUES
html += `<div id="defaillances-critiques" class="anchor-section">`;
html += `<h3 class="anchor-title">üö® D√âFAILLANCES CRITIQUES</h3>`;
html += generateCriticalAnalysisForDetailed(currentData.scores);
html += `</div>`;

// AJOUTER LE PLAN D'ACTION EN DEUXI√àME
const detailedRecommendations = generateSpecificRecommendations(currentData.scores, 'detailed');

if (detailedRecommendations.length > 0) {
    html += `
        <div id="plan-action" class="anchor-section">
            <h3 class="anchor-title">üìã PLAN D'ACTION D√âTAILL√â</h3>
            <div class="detailed-diagnosis">
            
            <div style="background: #e8f5e8; padding: 20px; border-radius: 15px; margin: 20px 0;">
                <h3>üìã RECOMMANDATIONS SP√âCIFIQUES</h3>
                <p style="color: #2e7d32; margin-bottom: 20px;">
                    Bas√© sur vos ${detailedRecommendations.length} r√©ponses n√©cessitant une am√©lioration imm√©diate :
                </p>
    `;
    
    detailedRecommendations.forEach((rec, index) => {
        const priorityColor = rec.priority === 'CRITIQUE' ? '#ea4335' : '#ff9900';
        const priorityBg = rec.priority === 'CRITIQUE' ? '#ffebee' : '#fff3e0';
        
        html += `
            <div style="background: ${priorityBg}; padding: 20px; border-radius: 12px; margin: 15px 0; border-left: 5px solid ${priorityColor};">
                <div style="display: flex; align-items: flex-start; margin-bottom: 10px;">
                    <span style="background: ${priorityColor}; color: white; padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: bold; margin-right: 15px; min-width: 80px; text-align: center;">
                        ${rec.priority}
                    </span>
                    <div style="flex: 1;">
                        <h5 style="color: ${priorityColor}; margin: 0 0 5px 0;">${rec.dimension}</h5>
                        <p style="color: #666; font-size: 13px; margin: 0; font-style: italic;">"${rec.question}"</p>
                    </div>
                </div>
                
                <div style="background: white; padding: 15px; border-radius: 8px; margin-top: 10px;">
                    <h6 style="color: #333; margin-bottom: 10px;">üí° ACTION RECOMMAND√âE :</h6>
                    <p style="margin: 0; color: #444; line-height: 1.5;">${rec.text}</p>
                </div>
            </div>
        `;
    });
    
    html += `
            </div>
        </div>
    `;
}

// Afficher les certifications d√©taill√©es si disponibles
if (currentData.certificationDetails) {
    let certificationsInfo = '';
    Object.entries(currentData.certificationDetails).forEach(([questionId, details]) => {
        if (details && details.trim()) {
            certificationsInfo = `
                <div class="detailed-diagnosis">
                    <h3>üìã CERTIFICATIONS QUALIT√â ACTUELLES</h3>
                    <div style="background: #e8f5e8; padding: 20px; border-radius: 12px; border-left: 5px solid #34a853;">
                        <h4 style="color: #2e7d32; margin-bottom: 10px;">‚úÖ Certifications poss√©d√©es par l'entreprise :</h4>
                        <div style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #c8e6c9;">
                            <p style="margin: 0; font-weight: 500; line-height: 1.6;">${details}</p>
                        </div>
                        <p style="margin: 15px 0 0 0; font-size: 0.9em; color: #2e7d32; font-style: italic;">
                            üí° Ces certifications repr√©sentent un atout majeur pour l'export
                        </p>
                    </div>
                </div>
            `;
        }
    });
    if (certificationsInfo) {
        html += certificationsInfo;
    }
}

html += `<div id="plan-strategique-detaille" class="anchor-section">`;
html += generateStrategicPlan(company, results, countryData, targetCountry);
html += `</div>`;

// ‚úÖ CORRECTION : Afficher l'analyse pays seulement si donn√©es disponibles
html += `<div id="marche-cible" class="anchor-section">`;
html += `<h3 class="anchor-title">üåç MARCH√â CIBLE</h3>`;
if (countryData) {
    html += generateCountryProfileAnalysis(targetCountry, countryData, company, results);
} else {
    // Message informatif mais diagnostic continue
    html += `
        <div class="detailed-diagnosis">
            <h2>üåç ANALYSE DU MARCH√â ${targetCountry.toUpperCase()}</h2>
            <div class="alert alert-warning" style="background: #fff3e0; border-left: 5px solid #ff9900; padding: 20px; border-radius: 8px;">
                <h4 style="color: #ef6c00;">üìä Donn√©es √©conomiques en cours de mise √† jour</h4>
                <p>Les informations d√©taill√©es pour <strong>${targetCountry}</strong> ne sont pas encore disponibles dans notre base de donn√©es.</p>
                <p><strong>üìû Solution :</strong> Contactez ACIEX pour obtenir une analyse personnalis√©e de ce march√©.</p>
                <p><strong>üí° Conseil :</strong> En attendant, concentrez-vous sur le renforcement de vos capacit√©s internes identifi√©es ci-dessus.</p>
            </div>
        </div>
    `;
}
                        

// Ajouter les services ACIEX RECOMMAND√âS 
html += `<div id="services-aciex" class="anchor-section">`;
html += `<h3 class="anchor-title">üéØ SERVICES ACIEX RECOMMAND√âS</h3>`;
html += generateAciexServicesRecommendations(targetCountry, countryData, company, results);
html += `</div>`;
            
            // SECTION IMPORTATEURS IA en DERNI√àRE POSITION            
            container.innerHTML = html;
            
            // Lancer la recherche d'importateurs en arri√®re-plan
        }

// Analyse du profil pays (SANS les services ACIEX)
        function generateCountryProfileAnalysis(country, countryData, company, results) {
            return `
                <div class="detailed-diagnosis">
                    <h2>üåç ANALYSE DU MARCH√â ${country.toUpperCase()}</h2>
                    
                    <div class="country-overview" style="background: linear-gradient(135deg, #1a73e8, #4285f4); color: white; padding: 25px; border-radius: 15px; margin: 20px 0;">
                        <h3>üìä PROFIL √âCONOMIQUE DU PAYS</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 15px;">
                            <div>
                                <h5>üí∞ Donn√©es √âconomiques</h5>
                                <ul style="list-style: none; padding: 0;">
                                    <li><strong>PIB:</strong> ${countryData.profile.gdp}</li>
                                    <li><strong>PIB/hab:</strong> ${countryData.profile.gdpPerCapita}</li>
                                    <li><strong>Croissance:</strong> ${countryData.profile.growth}</li>
                                    <li><strong>Population:</strong> ${countryData.profile.population}</li>
                                </ul>
                            </div>
                            <div>
                                <h5>üìà Indicateurs Business</h5>
                                <ul style="list-style: none; padding: 0;">
                                    <li><strong>Doing Business:</strong> ${countryData.profile.doingBusiness}</li>
                                    <li><strong>Inflation:</strong> ${countryData.profile.inflation}</li>
                                    <li><strong>Imports:</strong> ${countryData.profile.importVolume}</li>
                                    <li><strong>Monnaie:</strong> ${countryData.profile.currency}</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 25px; border-radius: 15px; margin: 20px 0;">
                        <h3>ü§ù ACCORDS COMMERCIAUX ET AVANTAGES</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                            <div style="background: white; padding: 20px; border-radius: 12px; border-left: 5px solid #34a853;">
                                <h4 style="color: #2e7d32;">‚úÖ Accords Bilat√©raux</h4>
                                <ul>
                                    ${countryData.agreements.bilateral.map(accord => `<li>${accord}</li>`).join('')}
                                </ul>
                            </div>
                            <div style="background: white; padding: 20px; border-radius: 12px; border-left: 5px solid #1a73e8;">
                                <h4 style="color: #1565c0;">üåç Accords Multilat√©raux</h4>
                                <ul>
                                    ${countryData.agreements.multilateral.map(accord => `<li>${accord}</li>`).join('')}
                                </ul>
                            </div>
                            <div style="background: white; padding: 20px; border-radius: 12px; border-left: 5px solid #ff9900;">
                                <h4 style="color: #ef6c00;">‚≠ê Pr√©f√©rences Tarifaires</h4>
                                <ul>
                                    ${countryData.agreements.preferential.map(pref => `<li>${pref}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: #e8f5e8; padding: 25px; border-radius: 15px; margin: 20px 0;">
                        <h3>üéØ POTENTIEL SECTORIEL POUR ${company.sector.toUpperCase()}</h3>
                        ${countryData.sectors[company.sector] ? `
                            <div style="background: white; padding: 20px; border-radius: 12px; border-left: 5px solid #4caf50;">
                                <h4>üìä √âvaluation Sectorielle</h4>
                                <p><strong>Potentiel:</strong> <span style="color: #2e7d32; font-weight: bold;">${countryData.sectors[company.sector].potential}</span></p>
                                <p><strong>D√©tails:</strong> ${countryData.sectors[company.sector].details}</p>
                                <p><strong>Exigences:</strong> ${countryData.sectors[company.sector].requirements}</p>
                                <p><strong>Concurrence:</strong> ${countryData.sectors[company.sector].competition}</p>
                            </div>
                        ` : `
                            <div style="background: white; padding: 20px; border-radius: 12px; border-left: 5px solid #ff9900;">
                                <h4>‚ö†Ô∏è Secteur non analys√©</h4>
                                <p>Les donn√©es sectorielles pour <strong>${company.sector}</strong> ne sont pas disponibles dans notre base pour ce pays.</p>
                                <p>Contactez ACIEX pour une analyse sectorielle personnalis√©e.</p>
                            </div>
                        `}
                    </div>
                    
                    <div style="background: white; padding: 25px; border-radius: 15px; margin: 20px 0; border: 2px solid #1a73e8;">
                        <h3>üíº STRAT√âGIE D'ENTR√âE RECOMMAND√âE</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div>
                                <h4 style="color: #2e7d32;">üí™ Points Forts du March√©</h4>
                                <ul>
                                    ${countryData.business.strengths.map(strength => `<li>${strength}</li>`).join('')}
                                </ul>
                                
                                <h4 style="color: #1a73e8;">üöÄ Opportunit√©s</h4>
                                <ul>
                                    ${countryData.business.opportunities.map(opp => `<li>${opp}</li>`).join('')}
                                </ul>
                            </div>
                            <div>
                                <h4 style="color: #ff6d01;">‚ö†Ô∏è D√©fis √† Relever</h4>
                                <ul>
                                    ${countryData.business.challenges.map(challenge => `<li>${challenge}</li>`).join('')}
                                </ul>
                                
                                <h4 style="color: #34a853;">üéØ Strat√©gie d'Entr√©e</h4>
                                <ul>
                                    ${countryData.business.entry_strategy.map(strategy => `<li>${strategy}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

// G√©n√©rer l'analyse des d√©faillances critiques pour le diagnostic d√©taill√©
function generateCriticalAnalysisForDetailed(scores) {
    const criticalAnalysis = analyzeCriticalQuestions();
    const hasCriticalQuestions = criticalAnalysis.critical.length > 0 || criticalAnalysis.warning.length > 0;

    if (hasCriticalQuestions) {
        let html = `
            <div class="detailed-diagnosis">
                <h2 style="color: #ea4335;">üö® ALERTE - D√âFAILLANCES CRITIQUES D√âTECT√âES</h2>
                
                <div style="background: #ffebee; padding: 20px; border-radius: 8px; margin: 15px 0; border: 2px solid #ea4335;">
                    <h4 style="color: #ea4335;">üö® D√âFAILLANCES MAJEURES IDENTIFI√âES</h4>
                    <p style="color: #c62828; font-weight: bold;">Malgr√© un score global satisfaisant, des faiblesses majeures ont √©t√© identifi√©es sur des questions sp√©cifiques :</p>
        `;

        // D√âFAILLANCES CRITIQUES (Score 1/4)
        if (criticalAnalysis.critical.length > 0) {
            html += `
                <div style="background: #ffcdd2; padding: 15px; border-radius: 6px; margin: 10px 0;">
                    <h5 style="color: #b71c1c;">‚õî D√âFAILLANCES CRITIQUES (Score 1/4) :</h5>
                    <ul style="margin: 10px 0;">
            `;
            
            criticalAnalysis.critical.forEach(item => {
    // Ne pas afficher les certifications si elles sont pr√©sentes (score 4)
    const questionId = findQuestionId(item.question);
    if (item.question.includes('certifications qualit√©') && questionId && currentData.scores[questionId] === 4) {
        return; // Skip cette certification
    }
    
    const statement = transformQuestionToStatement(item.question);
    const dimName = item.dimension.replace(/^\d+\.\s*/, '');
    html += `
        <li style="margin: 8px 0;"><strong>${dimName} :</strong> ${statement}</li>
    `;
});
            
            html += `
                    </ul>
                    <p style="color: #d32f2f; font-weight: bold;">‚ö†Ô∏è URGENCE ABSOLUE : Ces √©l√©ments doivent √™tre corrig√©s avant tout lancement export !</p>
                </div>
            `;
        }

        // FAIBLESSES IMPORTANTES (Score 2/4)
        if (criticalAnalysis.warning.length > 0) {
            html += `
                <div style="background: #ffe0b2; padding: 15px; border-radius: 6px; margin: 10px 0;">
                    <h5 style="color: #e65100;">‚ö†Ô∏è FAIBLESSES IMPORTANTES (Score 2/4) :</h5>
                    <ul style="margin: 10px 0;">
            `;
            
            criticalAnalysis.warning.forEach(item => {
    // Ne pas afficher les certifications si elles sont pr√©sentes (score 4)
    const questionId = findQuestionId(item.question);
    if (item.question.includes('certifications qualit√©') && questionId && currentData.scores[questionId] === 4) {
        return; // Skip cette certification
    }
    
    const statement = transformQuestionToStatement(item.question);
    const dimName = item.dimension.replace(/^\d+\.\s*/, '');
    html += `
        <li style="margin: 8px 0;"><strong>${dimName} :</strong> ${statement}</li>
    `;
});
            
            html += `
                    </ul>
                    <p style="color: #f57c00; font-weight: bold;">üìã PRIORIT√â HAUTE : Am√©lioration obligatoire avant export.</p>
                </div>
            `;
        }

        html += `
                </div>
            </div>
        `;
        
        return html;
    } else {
        return `
            <div class="detailed-diagnosis">
                <h2>‚úÖ ANALYSE DES R√âPONSES</h2>
                <div style="background: #e8f5e8; padding: 20px; border-radius: 8px; margin: 15px 0; border-left: 5px solid #34a853;">
                    <p style="color: #2e7d32;">Aucune d√©faillance critique identifi√©e dans vos r√©ponses. Votre profil pr√©sente une coh√©rence satisfaisante pour le d√©veloppement export.</p>
                </div>
            </div>
        `;
    }
}

        // Analyse d√©taill√©e du pays cible
    // Analyse des services ACIEX recommand√©s selon votre mapping
        function generateAciexServicesRecommendations(country, countryData, company, results) {
            const weakDimensions = results.dimensionScores.filter(d => d.percentage < 70);
            
            // Votre mapping exact des dimensions vers services ACIEX
            const servicesMapping = {
    'Produit': {  // Chang√© de 'Production' √† 'Produit'
        icon: 'üü°',
        title: 'Produit et Positionnement',
        description: 'Activit√©s qui am√©liorent ou adaptent l\'offre exportable aux march√©s √©trangers.',
        services: [
            'Appui √† la d√©finition d\'une offre export adapt√©e (produit, packaging, normes)',
            '√âtudes de march√© cibl√©es (tendance, demande, concurrence)',
            'Cr√©ation de visuels et argumentaires produits multilingues',
            'R√©f√©rencement sur plateformes internationales',
            'Accompagnement √† la digitalisation de l\'offre (boutique en ligne)'
        ]
    },
    'Production': {  // Maintenu pour Capacit√© de Production
        icon: 'üîµ',
        title: 'Capacit√© de Production et Logistique',
        description: 'Activit√©s qui permettent √† l\'entreprise d\'exporter physiquement ses produits dans de bonnes conditions.',
        services: [
            'Soutien √† la s√©lection de prestataires logistiques (transporteurs, transitaires)',
            'Accompagnement √† la constitution des documents d\'exportation',
            'Formation sur les Incoterms et leur application',
            'Mise √† disposition d\'un guide des proc√©dures douani√®res par pays',
            'Conseil sur la gestion des risques li√©s au transport international',
            'Suivi des commandes export',
            'Coordination des flux logistiques',
            'Int√©gration d\'un ERP adapt√© √† la gestion export',
            'Cr√©ation d\'une boutique en ligne adapt√©e √† l\'export',
            'Conseils sur les solutions de livraison transfrontali√®re'
        ]
    },
    'Qualit√©': {
        icon: 'üü£',
        title: 'Qualit√© et Conformit√©',
        description: 'Activit√©s qui garantissent le respect des normes, standards, proc√©dures √† l\'international.',
        services: [
            'V√©rification de la conformit√© des documents juridiques aux normes du commerce international',
            'Appui √† la r√©daction de contrats de vente internationaux',
            'Conseil sur la propri√©t√© intellectuelle et la protection des marques',
            'Aide √† la constitution des documents export (factures, certificats d\'origine, etc.)',
            'Formation sur les techniques du commerce international',
            'Cr√©ation de guides pratiques sectoriels et pays',
            'Sensibilisation aux risques juridiques pays par pays',
            'Aide √† la s√©lection de solutions e-commerce conformes (paiement, RGPD, etc.)'
        ]
    },
    'Organisation': {
        icon: 'üü§',
        title: 'Organisation et Processus Internes',
        description: 'Activit√©s qui renforcent la structure interne de l\'entreprise pour soutenir l\'activit√© export.',
        services: [
            '√âlaboration d\'un plan d\'actions export personnalis√©',
            'Mise en place d\'outils ERP adapt√©s',
            'Appui au suivi des commandes et des flux',
            'Structuration d\'une cellule export ou d\'un service d√©di√©',
            'Int√©gration de la gestion documentaire export',
            'Coaching en organisation interne pour internationalisation',
            'Accompagnement dans le choix des march√©s cibles (process de d√©cision)'
        ]
    },
    'Financi√®re': {
        icon: 'üü¢',
        title: 'Situation Financi√®re',
        description: 'Activit√©s qui soutiennent l\'acc√®s aux financements, la s√©curit√© des paiements et la viabilit√© financi√®re de l\'export.',
        services: [
            'Mise en relation avec les institutions de financement export',
            'Assistance au montage de dossiers de financement ou d\'assurance-cr√©dit',
            'Appui pour l\'acc√®s √† des subventions ou garanties √† l\'export',
            'Conseil sur les modalit√©s de paiement s√©curis√©es (cr√©dit documentaire, etc.)',
            'Simulation de plan de tr√©sorerie export',
            'Appui au recouvrement des cr√©ances √† l\'international',
            'Aide √† l\'int√©gration d\'outils ERP de gestion financi√®re export'
        ]
    },
    'Prix': {
        icon: 'üî¥',
        title: 'Ma√Ætrise des Prix et Techniques Commerciales Export',
        description: 'Activit√©s qui renforcent la capacit√© de l\'entreprise √† vendre efficacement √† l\'√©tranger, au bon prix.',
        services: [
            'Coaching en strat√©gie de p√©n√©tration de march√©',
            'Appui √† la d√©finition d\'une offre export adapt√©e (packaging, normes, prix)',
            'Cr√©ation de visuels marketing adapt√©s aux march√©s cibles',
            'R√©f√©rencement sur les plateformes internationales de vente B2B/B2C',
            'Formation au marketing digital et au SEO international',
            'Conseils sur les techniques de n√©gociation export',
            'Publication de catalogues produits sur plateformes partenaires',
            'Simulation de politique de prix export'
        ]
    },
    'Exp√©rience': {
        icon: 'üü†',
        title: 'Exp√©rience et Comp√©tences Export',
        description: 'Activit√©s qui d√©veloppent ou mobilisent les comp√©tences sp√©cifiques √† l\'export.',
        services: [
            'R√©alisation d\'un questionnaire de diagnostic export',
            'Organisation de formations techniques export',
            'Coaching personnalis√© pour dirigeants exportateurs',
            'Modules e-learning sur les bonnes pratiques export',
            'Ateliers ou s√©minaires de formation sectoriels',
            'Assistance √† la r√©daction de contrats',
            'Appui √† la lecture des incoterms et des sch√©mas logistiques'
        ]
    },
    'Innovation': {
        icon: '‚ö™',
        title: 'Innovation et D√©veloppement',
        description: 'Activit√©s qui encouragent l\'innovation, la transformation digitale ou le d√©veloppement de nouveaux produits/processus.',
        services: [
            'Cr√©ation d\'une boutique e-commerce adapt√©e aux march√©s internationaux',
            'Formation au marketing digital et √† la strat√©gie e-commerce',
            'Aide √† la digitalisation de l\'offre commerciale',
            'D√©veloppement d\'une strat√©gie omnicanale √† l\'international',
            'Mise √† niveau technologique ou packaging pour march√©s porteurs',
            'Sensibilisation √† l\'innovation produit ou service export'
        ]
    },
    'R√©seau': {
        icon: 'üî∂',
        title: 'R√©seau et Partenariats',
        description: 'Activit√©s qui facilitent les connexions strat√©giques pour l\'internationalisation.',
        services: [
            'Organisation de missions commerciales et rencontres B2B',
            'Participation √† des foires et salons internationaux',
            'Mise en relation avec des partenaires √©trangers (distributeurs, agents, acheteurs)',
            'Appui √† l\'implantation √† l\'√©tranger (repr√©sentation, bureau local)',
            'Promotion des produits ivoiriens via campagnes et √©v√©nements',
            'Connexion avec r√©seaux d\'affaires ou diasporas √©conomiques'
        ]
    },
    'Planification': {
        icon: 'üü´',
        title: 'Planification et Strat√©gie Export',
        description: 'Activit√©s orient√©es vers la vision √† long terme, la structuration de la strat√©gie export.',
        services: [
            'Diagnostic export avec analyse SWOT',
            'D√©finition d\'un plan d\'actions export personnalis√©',
            'Coaching en strat√©gie de p√©n√©tration de march√©',
            '√âtudes de march√© pour d√©finir la strat√©gie pays',
            'Aide √† la planification de la cha√Æne logistique export',
            'Planification de la mont√©e en gamme ou diversification √† l\'export'
        ]
    }
};
            
            // Utiliser les questions critiques d√©j√† identifi√©es (scores 1 ou 2)
            const criticalAnalysis = analyzeCriticalQuestions();
            const criticalDimensions = new Set();

            // Identifier les dimensions qui ont des questions critiques
            criticalAnalysis.critical.forEach(item => {
                criticalDimensions.add(item.dimension);
            });
            criticalAnalysis.warning.forEach(item => {
                criticalDimensions.add(item.dimension);
            });

            // Mapper ces dimensions critiques aux services ACIEX
const recommendedServices = [];
criticalDimensions.forEach(dimensionName => {
    // Nettoyer le nom de dimension (enlever le num√©ro et les points)
    const cleanDimensionName = dimensionName.replace(/^\d+\.\s*/, '');
    
    // Mapping explicite des dimensions vers les services
    let dimKey = null;
    
    if (cleanDimensionName.includes('Produit')) {
        dimKey = 'Produit';
    } else if (cleanDimensionName.includes('Production') || cleanDimensionName.includes('Logistique')) {
        dimKey = 'Production';
    } else if (cleanDimensionName.includes('Qualit√©')) {
        dimKey = 'Qualit√©';
    } else if (cleanDimensionName.includes('Organisation') || cleanDimensionName.includes('Processus')) {
        dimKey = 'Organisation';
    } else if (cleanDimensionName.includes('Financi√®re') || cleanDimensionName.includes('Situation Financi√®re')) {
        dimKey = 'Financi√®re';
    } else if (cleanDimensionName.includes('Prix') || cleanDimensionName.includes('Techniques Commerciales')) {
        dimKey = 'Prix';
    } else if (cleanDimensionName.includes('Exp√©rience') || cleanDimensionName.includes('Comp√©tences')) {
        dimKey = 'Exp√©rience';
    } else if (cleanDimensionName.includes('Innovation')) {
        dimKey = 'Innovation';
    } else if (cleanDimensionName.includes('R√©seau') || cleanDimensionName.includes('Partenariats')) {
        dimKey = 'R√©seau';
    } else if (cleanDimensionName.includes('Planification') || cleanDimensionName.includes('Strat√©gie')) {
        dimKey = 'Planification';
    }
    
    if (dimKey && servicesMapping[dimKey]) {
        const dimensionScore = results.dimensionScores.find(d => d.name === dimensionName);
        
        // V√©rifier que dimensionScore existe avant de l'ajouter
        if (dimensionScore) {
            recommendedServices.push({
                dimension: dimensionScore,
                service: servicesMapping[dimKey]
            });
        } else {
            console.warn('Dimension non trouv√©e:', dimensionName);
        }
    } else {
        console.warn('Service mapping non trouv√© pour:', cleanDimensionName);
    }
});
            
            // Si aucune faiblesse majeure, proposer services de d√©veloppement
            if (recommendedServices.length === 0) {
                recommendedServices.push({
                    dimension: { name: 'D√©veloppement', percentage: 85 },
                    service: servicesMapping['R√©seau']
                });
            }
            
            return `
                <div class="detailed-diagnosis">
                    <h2>üéØ SERVICES ACIEX RECOMMAND√âS - MARCH√â ${country.toUpperCase()}</h2>
                    
                    <div class="services-overview" style="background: linear-gradient(135deg, #2e7d32, #388e3c); color: white; padding: 25px; border-radius: 15px; margin: 20px 0;">
                        <h3>üèÜ ACCOMPAGNEMENT PERSONNALIS√â SELON VOS BESOINS</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 15px;">
                            <div>
                                <h5>üìä Votre Profil Export</h5>
                                <ul style="list-style: none; padding: 0;">
                                    <li>üè¢ <strong>Entreprise:</strong> ${company.companyName}</li>
                                    <li>üè≠ <strong>Secteur:</strong> ${company.sector}</li>
                                    <li>üéØ <strong>March√© cible:</strong> ${country}</li>
                                    <li>üìà <strong>Score global:</strong> ${results.adjustedScore}%</li>
                                </ul>
                            </div>
                            <div>
                                <h5>üéØ Services Adapt√©s</h5>
                                <ul style="list-style: none; padding: 0;">
                                    <li>üìã <strong>Dimensions √† renforcer:</strong> ${weakDimensions.length}/10</li>
                                    <li>‚úÖ <strong>Services recommand√©s:</strong> ${recommendedServices.length}</li>
                                    <li>üéØ <strong>Niveau actuel:</strong> ${results.level}</li>
                                    <li>üöÄ <strong>Accompagnement:</strong> Sur-mesure</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    ${recommendedServices.map(item => `
                        <div style="background: white; padding: 25px; border-radius: 12px; margin: 20px 0; border-left: 6px solid #2e7d32; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                            <div style="display: flex; align-items: center; margin-bottom: 15px;">
                                <span style="font-size: 2em; margin-right: 15px;">${item.service.icon}</span>
                                <div>
                                    <h4 style="color: #2e7d32; margin: 0;">${item.service.title}</h4>
                                    <p style="color: #666; margin: 5px 0 0 0; font-style: italic;">${item.service.description}</p>
                                </div>
                            </div>
                            
                            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0;">
                                <h5 style="color: #1b5e20; margin-bottom: 15px;">üéØ Nos services pour renforcer cette dimension :</h5>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 10px;">
                                    ${item.service.services.map(service => `
                                        <div style="background: white; padding: 10px; border-radius: 6px; border-left: 3px solid #4caf50;">
                                            <span style="color: #2e7d32;">‚úì ${service}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; text-align: center;">
                                <p style="color: #2e7d32; margin-bottom: 15px;"><strong>Score actuel: ${item.dimension.percentage}% - Potentiel d'am√©lioration identifi√©</strong></p>
                            </div>
                        </div>
                    `).join('')}
                    
                </div>
            `;
        }

// G√©n√©ration de la section importateurs (placeholder initial)
        function generateImportersSection(company) {
            const targetCountries = company.currentMarkets && company.currentMarkets.length > 0 
                ? company.currentMarkets 
                : company.targetMarket ? [company.targetMarket] : [];

            if (targetCountries.length === 0) {
                return `
                    <div id="importersSection" class="detailed-diagnosis" style="margin-top: 40px;">
                        <h2>üåç IMPORTATEURS POTENTIELS</h2>
                        <div class="alert alert-warning">
                            <strong>Aucun march√© cible sp√©cifi√©.</strong><br>
                            Veuillez renseigner vos march√©s actuels ou votre march√© cible pour obtenir une liste d'importateurs potentiels.
                        </div>
                    </div>
                `;
            }

            return `
                <div id="importersSection" class="detailed-diagnosis" style="margin-top: 40px;">
                    <h2>üåç IMPORTATEURS POTENTIELS - ${company.sector.toUpperCase()}</h2>
                    
                    <div style="background: linear-gradient(135deg, #ff6b35, #ff8c42); color: white; padding: 25px; border-radius: 15px; margin: 20px 0;">
                        <h3>ü§ñ RECHERCHE IA EN COURS...</h3>
                        <div style="display: flex; align-items: center; gap: 15px; margin-top: 15px;">
                            <div class="spinner" style="border: 3px solid rgba(255,255,255,0.3); border-top: 3px solid white; width: 30px; height: 30px;"></div>
                            <div>
                                <p style="margin: 0; font-size: 1.1em;">Analyse des importateurs dans vos march√©s cibles...</p>
                                <small>Secteur: ${company.sector} | Pays: ${targetCountries.slice(0, 3).join(', ')}</small>
                            </div>
                        </div>
                    </div>
                    
                    <div id="importersResults" style="min-height: 100px;">
                        <!-- Les r√©sultats appara√Ætront ici -->
                    </div>
                </div>
            `;
        }

        // Lancer la recherche d'importateurs
        async function generateImportersList(company) {
            const targetCountries = company.currentMarkets && company.currentMarkets.length > 0 
                ? company.currentMarkets 
                : company.targetMarket ? [company.targetMarket] : [];

            if (targetCountries.length === 0) return;

            try {
                console.log('üöÄ Lancement recherche importateurs...');
                
                // Simuler un d√©lai de recherche
                setTimeout(async () => {
                    const importersList = await importersAI.generateImportersList(company, targetCountries);
                    displayImportersResults(importersList);
                }, 3000); // 3 secondes de "recherche"

            } catch (error) {
                console.error('‚ùå Erreur recherche importateurs:', error);
                displayImportersError();
            }
        }

        // Afficher les r√©sultats d'importateurs
        function displayImportersResults(importersList) {
            const resultsContainer = document.getElementById('importersResults');
            if (!resultsContainer || !importersList) return;

            // Cacher le loader
            const loadingSection = resultsContainer.previousElementSibling;
            if (loadingSection) {
                loadingSection.style.display = 'none';
            }

            let html = `
                <div style="background: #e8f5e8; padding: 20px; border-radius: 12px; margin: 20px 0; border-left: 5px solid #4caf50;">
                    <h4 style="color: #2e7d32; margin-bottom: 15px;">‚úÖ RECHERCHE TERMIN√âE</h4>
                    <p><strong>Secteur analys√©:</strong> ${importersList.sector}</p>
                    <p><strong>Pays √©tudi√©s:</strong> ${importersList.countries.join(', ')}</p>
                    <p><strong>Entreprises identifi√©es:</strong> ${importersList.companies.length}</p>
                    <p><strong>Date de recherche:</strong> ${importersList.generatedAt}</p>
                </div>

                <div style="background: #fff3e0; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #ff9900;">
                    <p style="color: #ef6c00; margin: 0;"><strong>‚ö†Ô∏è Avertissement:</strong> ${importersList.disclaimer}</p>
                </div>
            `;

            if (importersList.companies.length > 0) {
                html += `
                    <div style="background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin: 20px 0;">
                        <div style="background: linear-gradient(135deg, #1a73e8, #4285f4); color: white; padding: 20px;">
                            <h4 style="margin: 0;">üìä LISTE DES IMPORTATEURS IDENTIFI√âS</h4>
                        </div>
                        <div style="overflow-x: auto;">
                            <table style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr style="background: #f8f9fa;">
                                        <th style="padding: 12px; border-bottom: 2px solid #e0e0e0; text-align: left; font-weight: bold;">üè¢ Entreprise</th>
                                        <th style="padding: 12px; border-bottom: 2px solid #e0e0e0; text-align: left; font-weight: bold;">üåç Pays</th>
                                        <th style="padding: 12px; border-bottom: 2px solid #e0e0e0; text-align: left; font-weight: bold;">üìû Contact</th>
                                        <th style="padding: 12px; border-bottom: 2px solid #e0e0e0; text-align: left; font-weight: bold;">üè≠ Secteur</th>
                                        <th style="padding: 12px; border-bottom: 2px solid #e0e0e0; text-align: left; font-weight: bold;">üìè Taille</th>
                                    </tr>
                                </thead>
                                <tbody>
                `;

                importersList.companies.forEach((company, index) => {
                    const rowColor = index % 2 === 0 ? '#ffffff' : '#f8f9fa';
                    html += `
                        <tr style="background: ${rowColor};">
                            <td style="padding: 12px; border-bottom: 1px solid #e0e0e0; font-weight: 600;">${company.name}</td>
                            <td style="padding: 12px; border-bottom: 1px solid #e0e0e0;">${company.country}</td>
                            <td style="padding: 12px; border-bottom: 1px solid #e0e0e0; color: #1a73e8;">${company.contact}</td>
                            <td style="padding: 12px; border-bottom: 1px solid #e0e0e0;">${company.sector}</td>
                            <td style="padding: 12px; border-bottom: 1px solid #e0e0e0;">${company.size}</td>
                        </tr>
                    `;
                });

                html += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            }

            // Actions recommand√©es
            html += `
                <div style="background: linear-gradient(135deg, #4caf50, #66bb6a); color: white; padding: 25px; border-radius: 15px; margin: 20px 0; text-align: center;">
                    <h4>üéØ √âTAPES SUIVANTES RECOMMAND√âES</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px;">
                        <button style="background: white; color: #4caf50; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-weight: bold;">
                            üìã Valider les contacts
                        </button>
                        <button style="background: rgba(255,255,255,0.2); color: white; border: 2px solid white; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-weight: bold;">
                            üìß Pr√©parer approche
                        </button>
                        <button style="background: rgba(255,255,255,0.2); color: white; border: 2px solid white; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-weight: bold;">
                            ü§ù Accompagnement ACIEX
                        </button>
                    </div>
                    <p style="margin-top: 15px; font-size: 0.9em; opacity: 0.9;">
                        üí° ACIEX peut vous accompagner dans la validation de ces contacts et la pr√©paration de votre approche commerciale
                    </p>
                </div>
            `;

            resultsContainer.innerHTML = html;
        }

        // Afficher une erreur si la recherche √©choue
        function displayImportersError() {
            const resultsContainer = document.getElementById('importersResults');
            if (!resultsContainer) return;

            const loadingSection = resultsContainer.previousElementSibling;
            if (loadingSection) {
                loadingSection.style.display = 'none';
            }

            resultsContainer.innerHTML = `
                <div class="alert alert-error" style="background: #ffebee; border-left: 5px solid #ea4335; padding: 20px; border-radius: 8px;">
                    <h4 style="color: #c62828; margin-bottom: 10px;">‚ùå Recherche temporairement indisponible</h4>
                    <p>Le service de recherche d'importateurs IA n'est pas disponible actuellement.</p>
                    <p><strong>Solution:</strong> Contactez directement ACIEX pour obtenir une liste personnalis√©e d'importateurs potentiels dans vos march√©s cibles.</p>
                    <button style="background: #ea4335; color: white; border: none; padding: 12px 25px; border-radius: 6px; cursor: pointer; font-weight: bold; margin-top: 15px;">
                        üìû Contacter ACIEX
                    </button>
                </div>
            `;
        }

        // Diagnostic sp√©cifique de l'entreprise
        function generateCompanyDiagnosis(company, results, countryData) {
            const criticalDimensions = results.dimensionScores.filter(d => d.percentage < 30);
            const readinessFactor = calculateMarketReadiness(results, countryData, company.sector);
            const riskProfile = assessExportRisks(results, countryData, company);
            
            return `
                <div class="company-specific-diagnosis" style="background: #f8f9fa; padding: 25px; border-radius: 15px; margin: 20px 0;">
                    <h3>üè¢ DIAGNOSTIC SP√âCIFIQUE - ${company.companyName.toUpperCase()}</h3>
                    
                    <div class="readiness-assessment" style="background: white; padding: 20px; border-radius: 12px; margin: 15px 0; border: 2px solid ${readinessFactor.color};">
                        <h4 style="color: ${readinessFactor.color};">üéØ NIVEAU DE PR√âPARATION EXPORT</h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 20px; margin: 15px 0;">
                            <div style="text-align: center;">
                                <div style="font-size: 3em; font-weight: bold; color: ${readinessFactor.color};">${readinessFactor.score}%</div>
                                <div style="font-size: 1.2em; font-weight: bold; color: ${readinessFactor.color};">${readinessFactor.level}</div>
                                <div style="margin-top: 10px;">D√©lai estim√©: <strong>${readinessFactor.timeline}</strong></div>
                            </div>
                            <div>
                                <p><strong>√âvaluation:</strong> ${readinessFactor.assessment}</p>
                                <p><strong>Facteurs limitants:</strong> ${readinessFactor.limitingFactors.join(', ')}</p>
                                
                            </div>
                        </div>
                    </div>
                    
                    <div class="risk-matrix" style="background: white; padding: 20px; border-radius: 12px; margin: 15px 0;">
                        <h4>‚ö†Ô∏è MATRICE DES RISQUES EXPORT</h4>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; margin: 15px 0;">
                            ${riskProfile.map(risk => `
                                <div style="background: ${risk.severity === '√âLEV√â' ? '#ffebee' : risk.severity === 'MOYEN' ? '#fff3e0' : '#e8f5e8'}; 
                                          padding: 15px; border-radius: 8px; border-left: 4px solid ${risk.severity === '√âLEV√â' ? '#ea4335' : risk.severity === 'MOYEN' ? '#ff9900' : '#34a853'};">
                                    <h5 style="color: ${risk.severity === '√âLEV√â' ? '#ea4335' : risk.severity === 'MOYEN' ? '#ff9900' : '#34a853'};">
                                        ${risk.category} - ${risk.severity}
                                    </h5>
                                    <p><strong>Description:</strong> ${risk.description}</p>
                                    <p><strong>Impact:</strong> ${risk.impact}</p>
                                    <p><strong>Mitigation:</strong> ${risk.mitigation}</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
<div class="improvement-opportunities" style="background: white; padding: 20px; border-radius: 12px; margin: 15px 0;">
                        <h4 style="color: #ff9900;">‚ö° POTENTIEL D'AM√âLIORATION</h4>
                        ${generateImprovementPlan(results, countryData, company)}
                    </div>
                </div>
            `;
        }

// Fonction pour expliquer l'ajustement sectoriel
function getAdjustmentExplanation(sector, rawScore, adjustedScore) {
    const difference = adjustedScore - rawScore;
    const isPositive = difference > 0;
    const absDifference = Math.abs(difference);
    
    // Coefficients sectoriels pour r√©f√©rence
    const sectorAdvantages = {
        'Agriculture': { advantage: true, reason: 'avantages naturels de la C√¥te d\'Ivoire' },
        'Agroforesterie': { advantage: true, reason: 'expertise reconnue en agroforesterie' },
        'Mines et M√©taux': { advantage: true, reason: 'richesses mini√®res du pays' },
        'P√©trole et Gaz': { advantage: true, reason: 'secteur √©nerg√©tique d√©velopp√©' },
        'Agro-alimentaire': { advantage: false, reason: 'secteur neutre' },
        'Pharmaceutique': { advantage: true, reason: 'd√©veloppement du secteur pharmaceutique ivoirien' },
        'Cosm√©tiques': { advantage: true, reason: 'mati√®res premi√®res naturelles disponibles' },
        'Textile': { advantage: false, reason: 'concurrence internationale forte' },
        'Confection': { advantage: false, reason: 'd√©fis de comp√©titivit√© face √† l\'Asie' },
        'Artisanat': { advantage: false, reason: 'march√© de niche' },
        'Bois et Ameublement': { advantage: true, reason: 'ressources foresti√®res' },
        'Mat√©riaux de Construction': { advantage: false, reason: 'march√© local principalement' },
        'Chimie et Parachimie': { advantage: false, reason: 'secteur n√©cessitant des investissements lourds' },
        '√âlectronique': { advantage: false, reason: 'concurrence technologique intense' },
        'M√©canique': { advantage: false, reason: 'secteur n√©cessitant une expertise technique avanc√©e' },
        'Transport et Logistique': { advantage: true, reason: 'position g√©ographique strat√©gique' },
        'Services Financiers': { advantage: false, reason: 'march√© en d√©veloppement' },
        'Tourisme': { advantage: false, reason: 'potentiel mais infrastructure √† d√©velopper' },
        'BTP': { advantage: false, reason: 'march√© principalement domestique' },
        '√ânergie Renouvelable': { advantage: true, reason: 'potentiel solaire et √©olien important' }
    };
    
    const sectorInfo = sectorAdvantages[sector] || { advantage: false, reason: 'secteur non √©valu√© sp√©cifiquement' };
    
    if (isPositive) {
        return `Votre score a √©t√© bonifi√© de +${absDifference} points gr√¢ce aux ${sectorInfo.reason}. 
                Le secteur "${sector}" b√©n√©ficie d'avantages comparatifs qui facilitent l'export depuis la C√¥te d'Ivoire.`;
    } else {
        return `Votre score a √©t√© ajust√© de ${difference} points car le secteur "${sector}" fait face √† ${sectorInfo.reason}. 
                Cet ajustement refl√®te les d√©fis sp√©cifiques de votre secteur sur les march√©s internationaux.`;
    }
}

        // Plan strat√©gique d√©taill√©
        function generateStrategicPlan(company, results, countryData, targetCountry) {
            const timeline = generateDetailedTimeline(results, countryData, company);
            const investment = calculateDetailedInvestment(results, countryData, company);
            const kpis = defineKPIs(results, countryData, company);
            
            return `
                <div class="strategic-plan" style="background: linear-gradient(135deg, #2e7d32, #4caf50); color: white; padding: 25px; border-radius: 15px; margin: 20px 0;">
                    <h3>üìã PLAN STRAT√âGIQUE D√âTAILL√â - EXPORT VERS ${targetCountry.toUpperCase()}</h3>
                    
                    <div class="timeline-section" style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 12px; margin: 15px 0;">
                        <h4>‚è∞ FEUILLE DE ROUTE STRAT√âGIQUE</h4>
                        ${timeline}
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                        <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 12px;">
                            <h4>üí∞ PLAN D'INVESTISSEMENT</h4>
                            ${investment}
                        </div>
                        
                        <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 12px;">
                            <h4>üìä INDICATEURS DE PERFORMANCE</h4>
                            ${kpis}
                        </div>
                    </div>
                    
                    <div class="success-factors" style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 12px; margin: 15px 0;">
                        <h4>üéØ FACTEURS CL√âS DE SUCC√àS</h4>
                        ${generateSuccessFactors(results, countryData, company)}
                    </div>
                </div>
            `;
        }

        // Fonctions utilitaires pour le diagnostic d√©taill√©
        
        function calculateMarketReadiness(results, countryData, sector) {
            const baseScore = results.adjustedScore;
            const sectorInfo = countryData?.sectors?.[sector];

            
            // Ajustement selon le potentiel sectoriel
            let sectorAdjustment = 0;
            if (sectorInfo) {
                switch(sectorInfo.potential) {
                    case 'EXCEPTIONNEL': sectorAdjustment = 10; break;
                    case 'TR√àS √âLEV√â': sectorAdjustment = 7; break;
                    case '√âLEV√â': sectorAdjustment = 5; break;
                    case 'MOYEN-√âLEV√â': sectorAdjustment = 2; break;
                    case 'MOYEN': sectorAdjustment = 0; break;
                    case 'FAIBLE': sectorAdjustment = -5; break;
                }
            }
            
            const adjustedScore = Math.min(100, Math.max(0, baseScore + sectorAdjustment));
            
            let level, color, timeline, assessment, limitingFactors = [], advantages = [];
            
            // Identifier les facteurs limitants et avantages
            results.dimensionScores.forEach(dim => {
                if (dim.percentage < 40) {
                    limitingFactors.push(dim.name.split(' ')[0]);
                } else if (dim.percentage >= 80) {
                    advantages.push(dim.name.split(' ')[0]);
                }
            });
            
            if (adjustedScore >= 85) {
                level = 'EXCELLENT - PR√äT IMM√âDIAT';
                color = '#34a853';
                timeline = '0-3 mois';
                assessment = 'Entreprise parfaitement pr√©par√©e avec tous les pr√©requis ma√Ætris√©s. Lancement export imm√©diat possible.';
            } else if (adjustedScore >= 70) {
                level = 'BON - PR√äT SOUS CONDITIONS';
                color = '#1a73e8';
                timeline = '3-6 mois';
                assessment = 'Solides fondations avec quelques ajustements n√©cessaires avant le lancement.';
            } else if (adjustedScore >= 55) {
                level = 'MOYEN - PR√âPARATION REQUISE';
                color = '#ff9900';
                timeline = '6-12 mois';
                assessment = 'Potentiel identifi√© mais d√©veloppement structur√© indispensable avant export.';
            } else if (adjustedScore >= 40) {
                level = 'FAIBLE - CONSOLIDATION URGENTE';
                color = '#ff5722';
                timeline = '12-18 mois';
                assessment = 'Bases insuffisantes. Programme de renforcement majeur requis.';
            } else {
                level = 'CRITIQUE - RESTRUCTURATION';
                color = '#ea4335';
                timeline = '18-24 mois';
                assessment = 'D√©faillances structurelles majeures. Refonte compl√®te des capacit√©s n√©cessaire.';
            }
            
            return {
                score: adjustedScore,
                level,
                color,
                timeline,
                assessment,
                limitingFactors: limitingFactors.length > 0 ? limitingFactors : ['Aucun facteur critique'],
                advantages: advantages.length > 0 ? advantages : ['D√©veloppement √©quilibr√©']
            };
        }
        
        function assessExportRisks(results, countryData, company) {
            const risks = [];
            
            // Risque capacit√© de production
            const productionDim = results.dimensionScores.find(d => d.name.includes('Production'));
            if (productionDim && productionDim.percentage < 50) {
                risks.push({
                    category: 'CAPACIT√â PRODUCTION',
                    severity: productionDim.percentage < 30 ? '√âLEV√â' : 'MOYEN',
                    description: 'Capacit√© insuffisante pour honorer commandes export importantes',
                    impact: 'Ruptures de stock, p√©nalit√©s, perte clients',
                    mitigation: 'Audit capacit√©, plan investissement, partenariat co-production'
                });
            }
            
            // Risque qualit√©/conformit√©
            const qualityDim = results.dimensionScores.find(d => d.name.includes('Qualit√©'));
            if (qualityDim && qualityDim.percentage < 60) {
                risks.push({
                    category: 'CONFORMIT√â QUALIT√â',
                    severity: qualityDim.percentage < 40 ? '√âLEV√â' : 'MOYEN',
                    description: 'Non-conformit√© aux standards du march√© cible',
                    impact: 'Rejet produits, amendes, exclusion march√©',
                    mitigation: 'Certification urgente, audit qualit√© externe, formation √©quipes'
                });
            }
            
            // Risque financier
            const financeDim = results.dimensionScores.find(d => d.name.includes('Financi√®re'));
            if (financeDim && financeDim.percentage < 55) {
                risks.push({
                    category: 'SOLIDIT√â FINANCI√àRE',
                    severity: financeDim.percentage < 35 ? '√âLEV√â' : 'MOYEN',
                    description: 'Insuffisance fonds de roulement pour cycles export',
                    impact: 'Incapacit√© honorer commandes, cessation activit√©',
                    mitigation: 'Renforcement capitaux, cr√©dit export, affacturage'
                });
            }
            
            // Risque exp√©rience
            const experienceDim = results.dimensionScores.find(d => d.name.includes('Exp√©rience'));
            if (experienceDim && experienceDim.percentage < 50) {
                risks.push({
                    category: 'INEXP√âRIENCE EXPORT',
                    severity: 'MOYEN',
                    description: 'Manque d\'expertise commerce international',
                    impact: 'Erreurs co√ªteuses, √©checs commerciaux, litiges',
                    mitigation: 'Recrutement expert, formation, conseil sp√©cialis√©'
                });
            }
            
            // Risque pays (bas√© sur les donn√©es du pays)
            if (countryData?.business?.challenges?.some(c => c.includes('instabilit√©') || c.includes('corruption'))) {
                risks.push({
                    category: 'RISQUE PAYS',
                    severity: 'MOYEN',
                    description: 'Instabilit√© politique/√©conomique du march√© cible',
                    impact: 'Pertes commerciales, difficult√©s recouvrement',
                    mitigation: 'Assurance-cr√©dit export, paiement s√©curis√©, diversification'
                });
            }
            
            return risks.length > 0 ? risks : [{
                category: 'PROFIL √âQUILIBR√â',
                severity: 'FAIBLE',
                description: 'Aucun risque majeur identifi√©',
                impact: 'D√©veloppement export dans conditions favorables',
                mitigation: 'Maintenir vigilance et am√©lioration continue'
            }];
        }
        
        function getCriticalActionPlan(dimensionName, countryData, sector) {
            const plans = {
                'Qualit√©': {
                    impact: 'Rejet syst√©matique produits, exclusion march√©, amendes r√©glementaires',
                    actions: ['Audit qualit√© externe imm√©diat', 'Certification ISO 9001/secteur', 'Formation √©quipes QA', '√âquipements contr√¥le'],
                    budget: '800K-3M FCFA',
                    timeline: '3-6 mois'
                },
                'Prix': {
                    impact: 'Erreurs pricing fatales, litiges paiement, pertes change massives',
                    actions: ['Formation Incoterms intensive', 'D√©veloppement grilles prix', 'Couverture risque change', 'Processus paiement s√©curis√©'],
                    budget: '300K-1M FCFA',
                    timeline: '1-3 mois'
                },
                'Financi√®re': {
                    impact: 'Rupture tr√©sorerie, incapacit√© honorer commandes, faillite',
                    actions: ['Renforcement capitaux urgents', 'N√©gociation cr√©dit export', 'Mise en place affacturage', 'Contr√¥le gestion renforc√©'],
                    budget: '2-10M FCFA',
                    timeline: '2-4 mois'
                },
                'Production': {
                    impact: 'Ruptures stock chroniques, p√©nalit√©s retard, perte clients majeurs',
                    actions: ['Audit capacit√© imm√©diat', 'Plan investissement √©quipements', 'Optimisation processus', 'Formation productivit√©'],
                    budget: '5-20M FCFA',
                    timeline: '4-8 mois'
                },
                'Exp√©rience': {
                    impact: '√âchecs commerciaux co√ªteux, non-conformit√©s, litiges internationaux',
                    actions: ['Recrutement responsable export', 'Formation direction CI', 'Conseil expert externe', 'Missions terrain'],
                    budget: '2-8M FCFA/an',
                    timeline: '1-6 mois'
                }
            };
            
            const key = Object.keys(plans).find(k => dimensionName.includes(k)) || 'Qualit√©';
            return plans[key];
        }
        
        function generateImprovementPlan(results, countryData, company) {
            const improvements = [];
            const moderateDimensions = results.dimensionScores.filter(d => d.percentage >= 30 && d.percentage < 70);
            
            moderateDimensions.slice(0, 3).forEach(dim => {
                const improvement = {
                    dimension: dim.name.replace(/^\d+\.\s*/, ''),
                    current: dim.percentage,
                    target: Math.min(85, dim.percentage + 20),
                    priority: dim.percentage < 50 ? 'HAUTE' : 'MOYENNE',
                    timeline: dim.percentage < 50 ? '3-6 mois' : '6-12 mois'
                };
                
                improvements.push(`
                    <div style="background: white; padding: 12px; border-radius: 6px; margin: 8px 0; border-left: 3px solid ${improvement.priority === 'HAUTE' ? '#ff9900' : '#1a73e8'};">
                        <strong>${improvement.dimension}</strong> (${improvement.current}% ‚Üí ${improvement.target}%)
                        <br><small>Priorit√©: ${improvement.priority} | D√©lai: ${improvement.timeline}</small>
                    </div>
                `);
            });
            
            return improvements.join('');
        }
        
        function generateDetailedTimeline(results, countryData, company) {
            const score = results.adjustedScore;
            let phases = [];
            
            if (score >= 70) {
                phases = [
                    { phase: 'PHASE 1', period: 'Mois 1-2', title: 'Finalisation Pr√©paratifs', tasks: ['Documentation commerciale', 'Certifications finales', '√âchantillonnage'] },
                    { phase: 'PHASE 2', period: 'Mois 2-4', title: 'Prospection Active', tasks: ['Participation salons', 'Missions commerciales', 'N√©gociations distributeurs'] },
                    { phase: 'PHASE 3', period: 'Mois 4-6', title: 'Premiers Contrats', tasks: ['Signature accords', 'Livraisons pilotes', 'Ajustements op√©rationnels'] },
                    { phase: 'PHASE 4', period: 'Mois 6+', title: 'Mont√©e en Puissance', tasks: ['D√©veloppement volumes', 'Extension gamme', 'Consolidation partenariats'] }
                ];
            } else if (score >= 50) {
                phases = [
                    { phase: 'PHASE 1', period: 'Mois 1-4', title: 'Renforcement Capacit√©s', tasks: ['Formation √©quipes', 'Mise aux normes', 'Processus qualit√©'] },
                    { phase: 'PHASE 2', period: 'Mois 4-8', title: 'Pr√©paration March√©', tasks: ['√âtude march√© approfondie', 'Adaptation produits', 'Strat√©gie prix'] },
                    { phase: 'PHASE 3', period: 'Mois 8-12', title: 'Tests March√©', tasks: ['√âchantillonnage', 'Prospection s√©lective', 'Validation concept'] },
                    { phase: 'PHASE 4', period: 'Mois 12+', title: 'Lancement Commercial', tasks: ['Entr√©e march√©', 'Premiers clients', 'Optimisation continue'] }
                ];
            } else {
                phases = [
                    { phase: 'PHASE 1', period: 'Mois 1-6', title: 'Consolidation Interne', tasks: ['Audit complet', 'Plan redressement', 'Investissements prioritaires'] },
                    { phase: 'PHASE 2', period: 'Mois 6-12', title: 'D√©veloppement Capacit√©s', tasks: ['Formation intensive', 'Certifications', 'Syst√®mes qualit√©'] },
                    { phase: 'PHASE 3', period: 'Mois 12-18', title: 'Pr√©paration Export', tasks: ['Veille concurrentielle', 'Adaptation offre', 'Partenariats strat√©giques'] },
                    { phase: 'PHASE 4', period: 'Mois 18+', title: 'D√©marrage Export', tasks: ['Prospection pilote', 'Tests march√©', 'Premiers contrats'] }
                ];
            }
            
            return phases.map(phase => `
                <div style="background: rgba(255,255,255,0.1); padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 4px solid white;">
                    <h5 style="margin-bottom: 5px;">${phase.phase} - ${phase.title} (${phase.period})</h5>
                    <ul style="margin: 0; padding-left: 20px;">
                        ${phase.tasks.map(task => `<li>${task}</li>`).join('')}
                    </ul>
                </div>
            `).join('');
        }
        
        function calculateDetailedInvestment(results, countryData, company) {
            const score = results.adjustedScore;
            const sector = company.sector;
            
            const baseBudgets = {
                preparation: score < 50 ? 3000000 : score < 70 ? 1500000 : 800000,
                marketing: score < 50 ? 2000000 : score < 70 ? 1200000 : 800000,
                operations: score < 50 ? 5000000 : score < 70 ? 3000000 : 1500000,
                certification: score < 50 ? 2500000 : score < 70 ? 1800000 : 1000000
            };
            
            // ‚úÖ MULTIPLICATEURS D'INVESTISSEMENT
// Refl√®tent les co√ªts relatifs de d√©veloppement par secteur  
// > 1.0 = Secteur co√ªteux (√©quipements, formations, certifications)
// < 1.0 = Secteur accessible (investissements limit√©s)
const investmentMultipliers = {
                'Technologie': 1.3,
                'Pharmaceutique': 1.5,
                'Agro-alimentaire': 1.2,
                'Textile': 1.0,
                'Artisanat': 0.8
            };
            
            const multiplier = investmentMultipliers[sector] || 1.0;
            
            return `
                <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px;">
                    <h5>üí∞ R√©partition Budg√©taire</h5>
                    <ul style="list-style: none; padding: 0;">
                        <li>üîß Pr√©paration/Formation: ${Math.round(baseBudgets.preparation * multiplier / 1000)}K FCFA</li>
                        <li>üì¢ Marketing/Commercial: ${Math.round(baseBudgets.marketing * multiplier / 1000)}K FCFA</li>
                        <li>‚öôÔ∏è Op√©rations/Logistique: ${Math.round(baseBudgets.operations * multiplier / 1000)}K FCFA</li>
                        <li>üìã Certifications/Conformit√©: ${Math.round(baseBudgets.certification * multiplier / 1000)}K FCFA</li>
                    </ul>
                    <hr style="border-color: rgba(255,255,255,0.3); margin: 15px 0;">
                    <h5>üíØ Total Investissement: ${Math.round((baseBudgets.preparation + baseBudgets.marketing + baseBudgets.operations + baseBudgets.certification) * multiplier / 1000000)}M FCFA</h5>
                    <p><small>ROI attendu: 200-400% sur 2-3 ans</small></p>
                </div>
            `;
        }
        
        function defineKPIs(results, countryData, company) {
            const score = results.adjustedScore;
            
            const kpis = {
                preparation: {
                    '6 mois': score >= 70 ? '95%' : score >= 50 ? '85%' : '70%',
                    '12 mois': '98%'
                },
                commercial: {
    'Prospects qualifi√©s': score >= 70 ? '10-15' : score >= 50 ? '8-12' : '5-8',
    'Premiers contrats': score >= 70 ? '6-12 mois' : score >= 50 ? '12-18 mois' : '18-24 mois'
},
                financial: {
                    'CA export Y1': score >= 70 ? '15-25%' : score >= 50 ? '10-20%' : '5-15%',
                    'CA export Y3': score >= 70 ? '35-50%' : score >= 50 ? '25-40%' : '15-30%'
                }
            };
            
            return `
                <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px;">
                    <h5>üìä Objectifs Pr√©paration</h5>
                    <ul style="list-style: none; padding: 0;">
                        <li>6 mois: ${kpis.preparation['6 mois']} capacit√©s op√©rationnelles</li>
                        <li>12 mois: ${kpis.preparation['12 mois']} pr√™t export</li>
                    </ul>
                    
                    <h5>üéØ Objectifs Commerciaux</h5>
                    <ul style="list-style: none; padding: 0;">
                        <li>Prospects: ${kpis.commercial['Prospects qualifi√©s']}/an</li>
                        <li>Premiers contrats: ${kpis.commercial['Premiers contrats']}</li>
                    </ul>
                    
                    <h5>üí∞ Objectifs Financiers</h5>
                    <ul style="list-style: none; padding: 0;">
                        <li>CA export Ann√©e 1: ${kpis.financial['CA export Y1']}</li>
                        <li>CA export Ann√©e 3: ${kpis.financial['CA export Y3']}</li>
                    </ul>
                </div>
            `;
        }
        
        function generateSuccessFactors(results, countryData, company) {
            const factors = [
                'Excellence qualit√© produits et respect strict standards cible',
                'Adaptation culturelle et linguistique de l\'approche commerciale',
                'Partenariats locaux strat√©giques (distributeurs, prescripteurs)',
                'Pricing comp√©titif avec marges pr√©serv√©es',
                'Service client r√©actif et support technique',
                'Conformit√© r√©glementaire anticip√©e et maintenue',
                'Innovation continue et veille concurrentielle',
                'Flexibilit√© op√©rationnelle et capacit√© d\'adaptation'
            ];
            
            return `
                <ul style="list-style: none; padding: 0; columns: 2; column-gap: 30px;">
                    ${factors.map((factor, index) => `
                        <li style="break-inside: avoid; margin-bottom: 8px;">
                            <span style="background: rgba(255,255,255,0.2); padding: 4px 8px; border-radius: 12px; font-size: 0.8em; margin-right: 8px;">
                                ${index + 1}
                            </span>
                            ${factor}
                        </li>
                    `).join('')}
                </ul>
            `;
        }

// G√©n√©rer les recommandations sp√©cifiques selon les scores
function generateSpecificRecommendations(scores, type = 'short') {
    const recommendations = [];
    
    Object.entries(scores).forEach(([questionId, score]) => {
    // Logique sp√©ciale pour la question certifications (binaire)
    const [dimIndex, qIndex] = questionId.split('-').map(Number);
    const dimension = dimensions[dimIndex];
    const question = dimension.questions[qIndex];
    
    let shouldRecommend = false;
    
    if (question.includes('certifications qualit√©')) {
        // Pour les certifications : recommander seulement si score = 1 (pas de certif)
        shouldRecommend = (score === 1);
    } else {
        // Pour les autres questions : logique normale
        shouldRecommend = (score <= 2);
    }
    
    if (shouldRecommend) {
        const recommendation = questionRecommendations[questionId];
            if (recommendation) {
                const [dimIndex, qIndex] = questionId.split('-').map(Number);
                const dimension = dimensions[dimIndex];
                const question = dimension.questions[qIndex];
                
                recommendations.push({
                    questionId,
                    dimension: dimension.title.replace(/^\d+\.\s*/, ''),
                    question: question,
                    score: score,
                    priority: score === 1 ? 'CRITIQUE' : '√âLEV√âE',
                    text: type === 'short' ? recommendation.short : recommendation.detailed
                });
            }
        }
    });
    
    return recommendations.sort((a, b) => a.score - b.score);
}

        // Charger les donn√©es sauvegard√©es
        function loadFromStorage() {
            const savedData = localStorage.getItem('exportToolData');
            if (savedData) {
                currentData = JSON.parse(savedData);
                
                // Remplir le formulaire entreprise
                Object.keys(currentData.company).forEach(key => {
                    const element = document.getElementById(key);
                    if (element && typeof currentData.company[key] === 'string') {
                        element.value = currentData.company[key];
                    }
                });
                
                // Restaurer les s√©lections de pays actuels
                if (currentData.company.currentMarkets) {
                    currentData.company.currentMarkets.forEach(country => {
                        const checkbox = document.getElementById(`currentMarkets_${country}`);
                        if (checkbox) checkbox.checked = true;
                    });
                    updateDisplaySelection('currentMarkets');
                }
                
                // Remplir les questions si elles existent
if (Object.keys(currentData.scores).length > 0) {
    generateQuestions();
    updateProgress();
    
    // Restaurer les d√©tails de certifications
    setTimeout(() => {
        if (currentData.certificationDetails) {
            Object.entries(currentData.certificationDetails).forEach(([questionId, details]) => {
                const textarea = document.getElementById(`certifications-list-${questionId}`);
                if (textarea) {
                    textarea.value = details;
                    // Afficher le champ si score = 4
                    const detailsDiv = document.getElementById(`certifications-details-${questionId}`);
                    if (detailsDiv && currentData.scores[questionId] === 4) {
                        detailsDiv.style.display = 'block';
                    }
                }
            });
        }
    }, 500);
}

                

                // Afficher les r√©sultats si ils existent
                if (currentData.results) {
                    displayResults();
                }
            }
            
            loadHistory();
        }

        // Sauvegarder les donn√©es
        function saveToStorage() {
            localStorage.setItem('exportToolData', JSON.stringify(currentData));
        }

        // Navigation entre sections avec effet de chargement
        function showSection(sectionName) {
            // Cacher toutes les sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Cacher le conteneur de chargement
            document.getElementById('loadingContainer').classList.remove('active');
            
            // Retirer la classe active de tous les boutons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.classList.remove('loading');
            });
            
            // Afficher la section demand√©e
            document.getElementById(sectionName).classList.add('active');
            
            // Activer le bouton correspondant
            event.target.classList.add('active');
        }

      // Navigation avec effet de chargement pour les r√©sultats et diagnostic
        function showSectionWithLoading(sectionName) {
            if (sectionName === 'results') {
                // V√©rifier s'il y a des r√©sultats √† afficher
                if (!currentData.results) {
                    showAlert('Veuillez d\'abord compl√©ter l\'√©valuation et calculer les r√©sultats.', 'warning');
                    return;
                }
                
                // D√©marrer l'animation de chargement pour les r√©sultats uniquement
                startLoadingAnimation(sectionName);
                
                // Simuler le traitement pendant 10 secondes
                setTimeout(() => {
                    completeLoading(sectionName);
                }, 10000);
                
            } else if (sectionName === 'detailed') {
                // V√©rifier s'il y a des r√©sultats √† afficher
                if (!currentData.results) {
                    showAlert('Veuillez d\'abord compl√©ter l\'√©valuation et calculer les r√©sultats.', 'warning');
                    return;
                }
                
                // V√©rification suppl√©mentaire pour le diagnostic d√©taill√©
                if (!currentData.company.targetMarket) {
                    showAlert('Veuillez s√©lectionner un march√© cible dans les informations entreprise pour acc√©der au diagnostic d√©taill√©.', 'warning');
                    return;
                }
                
                // Affichage direct sans animation de chargement
                generateDetailedDiagnosis();
                showSection(sectionName);
                document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
                document.getElementById('detailedTab').classList.add('active');
                
            } else {
                showSection(sectionName);
            }
        }

        function startLoadingAnimation(sectionName) {
            // Masquer toutes les sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Retirer la classe active de tous les boutons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Adapter les textes selon le type d'analyse
            if (sectionName === 'detailed') {
                document.getElementById('step1-text').textContent = 'Analyse du profil √©conomique du march√© cible';
                document.getElementById('step2-text').textContent = '√âvaluation des accords commerciaux et r√©glementations';
                document.getElementById('step3-text').textContent = 'Calcul de la pr√©paration export et matrice des risques';
                document.getElementById('step4-text').textContent = 'G√©n√©ration du plan strat√©gique d√©taill√©';
                document.getElementById('step5-text').textContent = 'Finalisation du diagnostic expert';
                
                document.querySelector('.loading-title').textContent = 'üîç Diagnostic D√©taill√© en Cours';
                document.querySelector('.loading-subtitle').textContent = 'Analyse experte approfondie de votre pr√©paration export...';
            } else {
                document.getElementById('step1-text').textContent = 'Calcul des scores pond√©r√©s par dimension';
                document.getElementById('step2-text').textContent = 'Analyse des interd√©pendances et goulots d\'√©tranglement';
                document.getElementById('step3-text').textContent = 'G√©n√©ration des recommandations strat√©giques';
                document.getElementById('step4-text').textContent = '√âlaboration du plan d\'action personnalis√©';
                document.getElementById('step5-text').textContent = 'Finalisation du rapport d\'analyse';
                
                document.querySelector('.loading-title').textContent = 'üîç Analyse Approfondie en Cours';
                document.querySelector('.loading-subtitle').textContent = 'G√©n√©ration de votre rapport d√©taill√©...';
            }
            
            // Marquer l'onglet appropri√© comme en chargement
            const targetTab = sectionName === 'results' ? 'resultsTab' : 'detailedTab';
            const tab = document.getElementById(targetTab);
            tab.classList.add('loading');
            
            if (sectionName === 'results') {
                tab.innerHTML = '‚è≥ Analyse en cours...';
            } else {
                tab.innerHTML = '‚è≥ Diagnostic en cours...';
            }
            
            // Afficher le conteneur de chargement
            document.getElementById('loadingContainer').classList.add('active');
            
            // R√©initialiser les √©tapes
            document.querySelectorAll('.loading-step').forEach(step => {
                step.classList.remove('completed', 'active');
                step.querySelector('.loading-step-icon').innerHTML = '‚è≥';
            });
            
            // D√©marrer l'animation de la barre et des √©tapes
            animateLoadingProgress();
        }

        function animateLoadingProgress() {
            const loadingBar = document.getElementById('loadingBar');
            const loadingPercentage = document.getElementById('loadingPercentage');
            const steps = ['step1', 'step2', 'step3', 'step4', 'step5'];
            
            let progress = 0;
            let currentStep = 0;
            
            const interval = setInterval(() => {
                progress += 1;
                
                // Mettre √† jour la barre de progression
                loadingBar.style.width = progress + '%';
                loadingPercentage.textContent = progress + '%';
                
                // Activer les √©tapes progressivement
                const stepThresholds = [15, 35, 55, 75, 95];
                
                for (let i = 0; i < stepThresholds.length; i++) {
                    const stepElement = document.getElementById(steps[i]);
                    
                    if (progress >= stepThresholds[i] && !stepElement.classList.contains('completed')) {
                        // Marquer l'√©tape pr√©c√©dente comme compl√©t√©e
                        if (i > 0) {
                            const prevStep = document.getElementById(steps[i-1]);
                            prevStep.classList.remove('active');
                            prevStep.classList.add('completed');
                            prevStep.querySelector('.loading-step-icon').innerHTML = '‚úÖ';
                        }
                        
                        // Activer l'√©tape actuelle
                        stepElement.classList.add('active');
                        stepElement.querySelector('.loading-step-icon').innerHTML = '<div class="spinner"></div>';
                    }
                }
                
                // Arr√™ter √† 100%
                if (progress >= 100) {
                    clearInterval(interval);
                    
                    // Marquer la derni√®re √©tape comme compl√©t√©e
                    const lastStep = document.getElementById(steps[steps.length - 1]);
                    lastStep.classList.remove('active');
                    lastStep.classList.add('completed');
                    lastStep.querySelector('.loading-step-icon').innerHTML = '‚úÖ';
                }
            }, 100); // Mise √† jour toutes les 100ms pour 10 secondes total
        }

        function completeLoading(sectionName) {
            // Masquer le conteneur de chargement
            document.getElementById('loadingContainer').classList.remove('active');
            
            // Restaurer l'onglet appropri√©
            if (sectionName === 'results') {
                const resultsTab = document.getElementById('resultsTab');
                resultsTab.classList.remove('loading');
                resultsTab.classList.add('active');
                resultsTab.innerHTML = 'üìä R√©sultats & Analyse';
            } else {
                const detailedTab = document.getElementById('detailedTab');
                detailedTab.classList.remove('loading');
                detailedTab.classList.add('active');
                detailedTab.innerHTML = 'üîç Diagnostic D√©taill√©';
                
                // G√©n√©rer le diagnostic d√©taill√©
                generateDetailedDiagnosis();
            }
            
            // Afficher la section appropri√©e
            document.getElementById(sectionName).classList.add('active');
            
            // Effet de succ√®s
            const message = sectionName === 'results' ? 
                '‚úÖ Analyse termin√©e ! Votre rapport d√©taill√© est maintenant disponible.' :
                '‚úÖ Diagnostic d√©taill√© termin√© ! Votre analyse approfondie est maintenant disponible.';
            showAlert(message, 'success');
            
            // Scroll vers le haut pour voir les r√©sultats
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        // Passer √† la section √©valuation
        function nextCompanySection() {
            // R√©cup√©rer les donn√©es du formulaire
            const formData = new FormData(document.getElementById('companyForm'));
            const companyData = {};
            
            for (let [key, value] of formData.entries()) {
                companyData[key] = value;
            }
            
            // Ajouter les pays s√©lectionn√©s
            companyData.currentMarkets = currentData.company.currentMarkets || [];
            
            // üî• VALIDATION COMPL√àTE - TOUS LES CHAMPS OBLIGATOIRES
            const champsManquants = [];
            
            // V√©rifier chaque champ obligatoire
            if (!companyData.companyName || companyData.companyName.trim() === '') {
                champsManquants.push('Nom de l\'entreprise');
            }
            if (!companyData.sector || companyData.sector === '') {
                champsManquants.push('Secteur d\'activit√©');
            }
            if (!companyData.employees || companyData.employees === '') {
                champsManquants.push('Nombre d\'employ√©s');
            }
            if (!companyData.revenue || companyData.revenue === '') {
                champsManquants.push('Chiffre d\'affaires annuel');
            }
            if (!companyData.country || companyData.country === '') {
                champsManquants.push('Pays du si√®ge social');
            }
            if (!companyData.email || companyData.email.trim() === '') {
                champsManquants.push('Email de contact');
            }
            if (!companyData.interviewer || companyData.interviewer.trim() === '') {
                champsManquants.push('Dossier suivi par (Agent ACIEX)');
            }
            if (!companyData.leaderGender || companyData.leaderGender === '') {
                champsManquants.push('Sexe du dirigeant');
            }
            if (!companyData.leaderAge || companyData.leaderAge === '') {
                champsManquants.push('Tranche d\'√¢ge du dirigeant');
            }
            
            // V√©rifier les march√©s actuels
            if (companyData.currentMarkets.length === 0) {
                champsManquants.push('March√©s actuels (au moins un)');
            }
            
            // V√©rifier le march√© cible
            if (!companyData.targetMarket || companyData.targetMarket === '') {
                champsManquants.push('March√© cible prioritaire');
            }
            
            // üö® AFFICHER L'ERREUR SI DES CHAMPS MANQUENT
            if (champsManquants.length > 0) {
                let message = 'üö® <strong>CHAMPS OBLIGATOIRES MANQUANTS</strong><br><br>';
                message += '‚ùå Veuillez compl√©ter les champs suivants :<br><br>';
                
                champsManquants.forEach(champ => {
                    message += `‚Ä¢ <strong>${champ}</strong><br>`;
                });
                
                message += '<br>üí° <em>Tous les champs sont obligatoires pour obtenir un diagnostic pr√©cis.</em>';
                
                showAlert(message, 'warning');
                
                // Faire d√©filer vers le haut pour voir le premier champ manquant
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
                
                return; // Arr√™ter ici, ne pas passer √† l'√©tape suivante
            }
            
            // ‚úÖ TOUS LES CHAMPS SONT REMPLIS - CONTINUER
            // Sauvegarder les donn√©es
            currentData.company = companyData;
            saveToStorage();
            
            // G√©n√©rer les questions
            generateQuestions();
            
            // Passer √† la section √©valuation
            showSection('evaluation');
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector('[onclick="showSection(\'evaluation\')"]').classList.add('active');
            
            // Message de confirmation
            showAlert('‚úÖ Informations entreprise compl√®tes ! Vous pouvez maintenant commencer l\'√©valuation.', 'success');
        }

        // R√©ponses personnalis√©es pour chaque question
const customResponses = {
    // DIMENSION 1: Produit et Positionnement
    '0-0': ['‚ùå Pas de besoin identifi√©', '‚ö†Ô∏è Besoin flou/incertain', '‚úì Besoin partiellement identifi√©', '‚úÖ Besoin clairement identifi√©'],
    '0-1': ['‚ùå Aucune adaptation', '‚ö†Ô∏è Adaptation mineure', '‚úì Adaptation partielle', '‚úÖ Adaptation compl√®te'],
    '0-2': ['‚ùå Pas du tout attractive', '‚ö†Ô∏è Peu attractive', '‚úì Moyennement attractive', '‚úÖ Tr√®s attractive'],
    '0-3': ['‚ùå Aucune protection', '‚ö†Ô∏è Protection limit√©e', '‚úì Protection partielle', '‚úÖ Protection compl√®te'],
    '0-4': ['‚ùå Aucun avantage', '‚ö†Ô∏è Avantage faible', '‚úì Avantage mod√©r√©', '‚úÖ Avantage distinctif fort'],

    // DIMENSION 2: Capacit√© de Production et Logistique
    '1-0': ['‚ùå Capacit√© insuffisante', '‚ö†Ô∏è Capacit√© limit√©e (+10%)', '‚úì Capacit√© correcte (+20%)', '‚úÖ Capacit√© excellente (+30%+)'],
    '1-1': ['‚ùå Non conformes', '‚ö†Ô∏è Partiellement conformes', '‚úì Majoritairement conformes', '‚úÖ Totalement conformes'],
    '1-2': ['‚ùå Aucun syst√®me', '‚ö†Ô∏è Syst√®me basique', '‚úì Syst√®me correct', '‚úÖ Syst√®me performant'],
    '1-3': ['‚ùå Pas fiable/pas diversifi√©e', '‚ö†Ô∏è Peu fiable/peu diversifi√©e', '‚úì Assez fiable et diversifi√©e', '‚úÖ Tr√®s fiable et diversifi√©e'],
    '1-4': ['‚ùå D√©lais > 60 jours', '‚ö†Ô∏è D√©lais 30-60 jours', '‚úì D√©lais 15-30 jours', '‚úÖ D√©lais < 15 jours'],

    // DIMENSION 3: Qualit√© et Conformit√©
    '2-0': ['‚ùå Aucune tra√ßabilit√©', '‚ö†Ô∏è Tra√ßabilit√© partielle', '‚úì Tra√ßabilit√© correcte', '‚úÖ Tra√ßabilit√© compl√®te'],
    '2-1': ['‚ùå Aucune certification', '‚ö†Ô∏è Certifications locales', '‚úì Quelques certifications internationales', '‚úÖ Certifications internationales reconnues'],
    '2-2': ['‚ùå Aucun contr√¥le', '‚ö†Ô∏è Contr√¥les occasionnels', '‚úì Contr√¥les r√©guliers', '‚úÖ Contr√¥les rigoureux syst√©matiques'],
    '2-3': ['‚ùå Inadapt√©s', '‚ö†Ô∏è Partiellement adapt√©s', '‚úì Correctement adapt√©s', '‚úÖ Parfaitement adapt√©s'],
    '2-4': ['‚ùå Jamais', '‚ö†Ô∏è Rarement', '‚úì Parfois', '‚úÖ R√©guli√®rement'],

    // DIMENSION 4: Organisation et Processus Internes
    '3-0': ['‚ùå Pas document√©s', '‚ö†Ô∏è Partiellement document√©s', '‚úì Document√©s mais non optimis√©s', '‚úÖ Document√©s et optimis√©s'],
    '3-1': ['‚ùå Aucun syst√®me', '‚ö†Ô∏è Syst√®me basique', '‚úì Syst√®me correct', '‚úÖ Syst√®me performant (ERP/CRM)'],
    '3-2': ['‚ùå Monolingue uniquement', '‚ö†Ô∏è 2 langues', '‚úì 3 langues', '‚úÖ Multilingue (4+ langues)'],
    '3-3': ['‚ùå Aucune proc√©dure', '‚ö†Ô∏è Proc√©dures floues', '‚úì Proc√©dures partielles', '‚úÖ Proc√©dures claires compl√®tes'],
    '3-4': ['‚ùå Aucune formation', '‚ö†Ô∏è Formation basique', '‚úì Formation partielle', '‚úÖ Formation compl√®te sp√©cialis√©e'],

    // DIMENSION 5: Situation Financi√®re
    '4-0': ['‚ùå Endettement > 70%', '‚ö†Ô∏è Endettement 50-70%', '‚úì Endettement 30-50%', '‚úÖ Endettement < 30%'],
    '4-1': ['‚ùå Aucun acc√®s', '‚ö†Ô∏è Acc√®s limit√©', '‚úì Acc√®s partiel', '‚úÖ Acc√®s complet s√©curis√©'],
    '4-2': ['‚ùå Budget < 5%', '‚ö†Ô∏è Budget 5-7%', '‚úì Budget 7-10%', '‚úÖ Budget > 10%'],
    '4-3': ['‚ùå Tr√©sorerie < 30 jours', '‚ö†Ô∏è Tr√©sorerie 30-60 jours', '‚úì Tr√©sorerie 60-90 jours', '‚úÖ Tr√©sorerie > 90 jours'],
    '4-4': ['‚ùå Aucun suivi comptable', '‚ö†Ô∏è Retard de plus de 3 mois', '‚úì Tenue √† jour sans expert', '‚úÖ √Ä jour + expert-comptable'],

    // DIMENSION 6: Ma√Ætrise des Prix et Techniques Commerciales Export
    '5-0': ['‚ùå Aucune ma√Ætrise', '‚ö†Ô∏è Notions de base', '‚úì Bonne ma√Ætrise', '‚úÖ Ma√Ætrise experte'],
    '5-1': ['‚ùå Grille unique', '‚ö†Ô∏è 2-3 march√©s', '‚úì Plusieurs march√©s', '‚úÖ Grille sp√©cifique par march√©'],
    '5-2': ['‚ùå Aucune connaissance', '‚ö†Ô∏è Connaissances de base', '‚úì Bonnes connaissances', '‚úÖ Ma√Ætrise experte'],
    '5-3': ['‚ùå Aucune couverture', '‚ö†Ô∏è Couverture occasionnelle', '‚úì Couverture partielle', '‚úÖ Couverture syst√©matique'],
    '5-4': ['‚ùå Prix non comp√©titifs', '‚ö†Ô∏è Prix peu comp√©titifs', '‚úì Prix comp√©titifs', '‚úÖ Prix tr√®s comp√©titifs'],

    // DIMENSION 7: Exp√©rience et Comp√©tences Export
    '6-0': ['‚ùå Aucune exp√©rience', '‚ö†Ô∏è Exp√©rience limit√©e', '‚úì Exp√©rience mod√©r√©e', '‚úÖ Exp√©rience confirm√©e'],
    '6-1': ['‚ùå Aucun responsable', '‚ö†Ô∏è Responsable non form√©', '‚úì Responsable partiellement form√©', '‚úÖ Responsable expert form√©'],
    '6-2': ['‚ùå Aucune connaissance', '‚ö†Ô∏è Connaissances de base', '‚úì Bonnes connaissances', '‚úÖ Ma√Ætrise experte'],
    '6-3': ['‚ùå Jamais particip√©', '‚ö†Ô∏è 1-2 participations', '‚úì Participations r√©guli√®res', '‚úÖ Participations actives fr√©quentes'],
    '6-4': ['‚ùå Langues locales uniquement', '‚ö†Ô∏è Fran√ßais + bases anglais', '‚úì Fran√ßais + bon anglais', '‚úÖ Multilingue expert'],

    // DIMENSION 8: Innovation et D√©veloppement
    '7-0': ['‚ùå Pas d\'investissement R&D', '‚ö†Ô∏è < 1% du CA', '‚úì 1-2% du CA', '‚úÖ > 2% du CA'],
    '7-1': ['‚ùå Aucun d√©veloppement', '‚ö†Ô∏è D√©veloppement occasionnel', '‚úì 1 nouveaut√©/2 ans', '‚úÖ 1+ nouveaut√©/an'],
    '7-2': ['‚ùå Aucune veille', '‚ö†Ô∏è Veille occasionnelle', '‚úì Veille r√©guli√®re', '‚úÖ Veille syst√©matique active'],
    '7-3': ['‚ùå Aucune collaboration', '‚ö†Ô∏è Collaborations ponctuelles', '‚úì Quelques partenariats', '‚úÖ Partenariats actifs multiples'],
    '7-4': ['‚ùå Pas prot√©g√©es', '‚ö†Ô∏è Protection partielle', '‚úì Bien prot√©g√©es', '‚úÖ Prot√©g√©es et valoris√©es'],

    // DIMENSION 9: R√©seau et Partenariats
    '8-0': ['‚ùå Aucun contact', '‚ö†Ô∏è Quelques contacts', '‚úì R√©seau mod√©r√©', '‚úÖ R√©seau solide √©tabli'],
    '8-1': ['‚ùå Aucune participation', '‚ö†Ô∏è Participation occasionnelle', '‚úì Participation r√©guli√®re', '‚úÖ Participation active leadership'],
    '8-2': ['‚ùå Aucun distributeur', '‚ö†Ô∏è 1-2 distributeurs', '‚úì Quelques distributeurs', '‚úÖ R√©seau distributeurs fiables'],
    '8-3': ['‚ùå Aucune relation', '‚ö†Ô∏è Relations ponctuelles', '‚úì Relations r√©guli√®res', '‚úÖ Relations privil√©gi√©es actives'],
    '8-4': ['‚ùå Pas de pr√©sence', '‚ö†Ô∏è Pr√©sence limit√©e', '‚úì Bonne pr√©sence', '‚úÖ Forte pr√©sence internationale'],

    // DIMENSION 10: Planification et Strat√©gie Export
    '9-0': ['‚ùå Aucun plan', '‚ö†Ô∏è Plan informel', '‚úì Plan partiel', '‚úÖ Business plan complet 3 ans'],
    '9-1': ['‚ùå Pas d\'objectifs', '‚ö†Ô∏è Objectifs flous', '‚úì Objectifs d√©finis', '‚úÖ Objectifs chiffr√©s suivis'],
    '9-2': ['‚ùå Aucun budget', '‚ö†Ô∏è Budget informel', '‚úì Budget partiel', '‚úÖ Budget d√©di√© formalis√©'],
    '9-3': ['‚ùå Aucune veille', '‚ö†Ô∏è Veille occasionnelle', '‚úì Veille r√©guli√®re', '‚úÖ Veille syst√©matique active'],
    '9-4': ['‚ùå Aucune strat√©gie', '‚ö†Ô∏è Approche g√©n√©rale', '‚úì Strat√©gie partielle', '‚úÖ Strat√©gie sp√©cifique par march√©']
};

        // G√©n√©rer les questions avec r√©ponses personnalis√©es
        function generateQuestions() {
            const container = document.getElementById('questionsContainer');
            container.innerHTML = '';
            
            dimensions.forEach((dimension, dimIndex) => {
                // En-t√™te de dimension
                const header = document.createElement('div');
                header.className = 'dimension-header';
                header.innerHTML = dimension.title;
                container.appendChild(header);
                
                // Questions de la dimension
                dimension.questions.forEach((question, qIndex) => {
                    const questionContainer = document.createElement('div');
                    questionContainer.className = 'question-container';
                    
                    const questionId = `${dimIndex}-${qIndex}`;
                    
                    let questionHtml = '';

                    // Question sp√©ciale pour les certifications (binaire)
                    if (question.includes('certifications qualit√©')) {
                        questionHtml = `
                            <div class="question-title">${question}</div>
                            <div class="score-buttons">
                                <button class="score-btn" onclick="selectScore('${questionId}', 1)" data-score="1">‚ùå Non, aucune certification</button>
                                <button class="score-btn" onclick="selectScore('${questionId}', 4)" data-score="4">‚úÖ Oui, nous avons des certifications</button>
                            </div>
                            <div id="certifications-details-${questionId}" style="display: none; margin-top: 15px; background: #e8f5e8; padding: 15px; border-radius: 8px; border-left: 5px solid #34a853;">
                                <label for="certifications-list-${questionId}" style="color: #2e7d32; font-weight: bold;">
                                    üìã Lesquelles ? (pr√©cisez vos certifications) :
                                </label>
                                <textarea 
                                    id="certifications-list-${questionId}" 
                                    placeholder="Ex: ISO 9001:2015, HACCP, Certification Bio UE, Label Fairtrade, CE, FDA, etc."
                                    style="width: 100%; height: 80px; margin-top: 8px; padding: 10px; border: 2px solid #34a853; border-radius: 6px; font-family: inherit; resize: vertical;"
                                    onchange="saveCertificationDetails('${questionId}', this.value)"
                                ></textarea>
                                <small style="color: #2e7d32; font-style: italic;">üí° Plus vous √™tes pr√©cis, plus le diagnostic sera pertinent</small>
                            </div>
                        `;
                    } else {
                        // Questions normales avec r√©ponses personnalis√©es
                        const responses = customResponses[questionId] || ['1 - Pas du tout', '2 - Peu', '3 - Moyennement', '4 - Enti√®rement'];
                        
                        questionHtml = `
                            <div class="question-title">${question}</div>
                            <div class="score-buttons">
                                <button class="score-btn" onclick="selectScore('${questionId}', 1)" data-score="1">${responses[0]}</button>
                                <button class="score-btn" onclick="selectScore('${questionId}', 2)" data-score="2">${responses[1]}</button>
                                <button class="score-btn" onclick="selectScore('${questionId}', 3)" data-score="3">${responses[2]}</button>
                                <button class="score-btn" onclick="selectScore('${questionId}', 4)" data-score="4">${responses[3]}</button>
                            </div>
                        `;
                    }

                    questionContainer.innerHTML = questionHtml;
                    
                    container.appendChild(questionContainer);
                    
                    // Restaurer la s√©lection si elle existe
                    if (currentData.scores[questionId]) {
                        setTimeout(() => {
                            const selectedBtn = questionContainer.querySelector(`[data-score="${currentData.scores[questionId]}"]`);
                            if (selectedBtn) selectedBtn.classList.add('selected');
                        }, 100);
                    }
                });
            });
            
            updateProgress();
        }

        // S√©lectionner un score
function selectScore(questionId, score) {
    // Sauvegarder le score
    currentData.scores[questionId] = score;
    saveToStorage();
    
    // Mettre √† jour l'interface
    const questionContainer = event.target.closest('.question-container');
    questionContainer.querySelectorAll('.score-btn').forEach(btn => {
        btn.classList.remove('selected');
    });
    event.target.classList.add('selected');
    
    // Mettre √† jour la progression
    updateProgress();

    // G√©rer l'affichage du champ certifications pour la question sp√©ciale
    const questionTitle = questionContainer.querySelector('.question-title').textContent;

    if (questionTitle.includes('certifications qualit√©')) {
        const detailsDiv = document.getElementById(`certifications-details-${questionId}`);
        if (score === 4) {
            // Si "Oui", afficher le champ
            detailsDiv.style.display = 'block';
            // Restaurer la valeur si elle existe
            const textarea = document.getElementById(`certifications-list-${questionId}`);
            if (currentData.certificationDetails && currentData.certificationDetails[questionId]) {
                textarea.value = currentData.certificationDetails[questionId];
            }
            // Focus sur le textarea pour encourager la saisie
            setTimeout(() => textarea.focus(), 200);
        } else {
            // Si "Non", masquer le champ et vider les donn√©es
            detailsDiv.style.display = 'none';
            if (currentData.certificationDetails) {
                delete currentData.certificationDetails[questionId];
                saveToStorage();
            }
        }
    }
}

// Sauvegarder les d√©tails des certifications
function saveCertificationDetails(questionId, details) {
    if (!currentData.certificationDetails) {
        currentData.certificationDetails = {};
    }
    currentData.certificationDetails[questionId] = details;
    saveToStorage();
}

// Fonction de debug - √† supprimer apr√®s test
function debugCertifications() {
    console.log('=== DEBUG CERTIFICATIONS ===');
    console.log('Scores actuels:', currentData.scores);
    console.log('D√©tails certifications:', currentData.certificationDetails);
    
    // Trouver la question certification
    dimensions.forEach((dimension, dimIndex) => {
        dimension.questions.forEach((question, qIndex) => {
            if (question.includes('certifications qualit√©')) {
                const questionId = `${dimIndex}-${qIndex}`;
                console.log(`Question certification ID: ${questionId}`);
                console.log(`Score pour cette question: ${currentData.scores[questionId]}`);
            }
        });
    });
}
        // Mettre √† jour la progression
        function updateProgress() {
            const totalQuestions = dimensions.reduce((total, dim) => total + dim.questions.length, 0);
            const answeredQuestions = Object.keys(currentData.scores).length;
            const percentage = (answeredQuestions / totalQuestions) * 100;
            
            document.getElementById('progressFill').style.width = percentage + '%';
            document.getElementById('progressText').textContent = `${answeredQuestions}/${totalQuestions} questions compl√©t√©es`;
        }

// Coefficients sectoriels
function getSectorCoefficient(sector) {
    // Coefficients de maturit√© export
    const exportReadinessCoefficients = {
        // SECTEURS PRIMAIRES - Avantages naturels CI
        'Agriculture': 1.1,
        'Agroforesterie': 1.15,
        'Mines et M√©taux': 1.2,
        'P√©trole et Gaz': 1.25,
        
        // TRANSFORMATION AGROALIMENTAIRE
        'Agro-alimentaire': 1.0,
        
        // SECTEURS MANUFACTURIERS
        'Textile': 0.95,
        'Confection': 0.85,
        'Pharmaceutique': 1.15,
        'Cosm√©tiques': 1.1,
        'Artisanat': 0.9,
        'Bois et Ameublement': 1.05,
        'Mat√©riaux de Construction': 0.9,
        'Chimie et Parachimie': 0.8,
        '√âlectronique': 0.7,
        'M√©canique': 0.75,
        
        // SECTEURS SERVICES
        'Transport et Logistique': 1.05,
        'Services Financiers': 0.95,
        'Tourisme': 1.0,
        'BTP': 0.9,
        '√ânergie Renouvelable': 1.15,
        
        // D√âFAUT
        'Autre': 1.0
    };
    
    return exportReadinessCoefficients[sector] || 1.0;
}

        // Calculer les r√©sultats avec effet de chargement
        function calculateResults() {
            // üî• VALIDATION COMPL√àTE - TOUTES LES 50 QUESTIONS OBLIGATOIRES
            const questionsManquantes = [];
            
            // V√©rifier chaque question par dimension
            dimensions.forEach((dimension, dimIndex) => {
                dimension.questions.forEach((question, qIndex) => {
                    const questionId = `${dimIndex}-${qIndex}`;
                    if (!currentData.scores[questionId]) {
                        questionsManquantes.push({
                            dimension: dimension.title.replace(/^\d+\.\s*/, ''),
                            question: question,
                            numero: questionsManquantes.length + 1
                        });
                    }
                });
            });
            
            // üö® AFFICHER L'ERREUR SI DES QUESTIONS MANQUENT
            if (questionsManquantes.length > 0) {
                let message = 'üö® <strong>QUESTIONS OBLIGATOIRES NON R√âPONDUES</strong><br><br>';
                message += `‚ùå Il vous reste <strong>${questionsManquantes.length} question(s)</strong> √† compl√©ter :<br><br>`;
                
                // Limiter l'affichage aux 10 premi√®res questions manquantes pour √©viter un message trop long
                const questionsAffichees = questionsManquantes.slice(0, 10);
                
                questionsAffichees.forEach((item, index) => {
                    message += `<strong>${index + 1}. ${item.dimension}</strong><br>`;
                    message += `<em>"${item.question.substring(0, 80)}${item.question.length > 80 ? '...' : ''}"</em><br><br>`;
                });
                
                if (questionsManquantes.length > 10) {
                    message += `<em>... et ${questionsManquantes.length - 10} autres questions</em><br><br>`;
                }
                
                message += 'üí° <em>Toutes les 50 questions doivent √™tre r√©pondues pour obtenir un diagnostic pr√©cis.</em><br>';
                message += 'üìã <em>Faites d√©filer vers le haut pour voir les questions manquantes.</em>';
                
                showAlert(message, 'warning');
                
                // Faire d√©filer vers le haut pour voir les questions
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
                
                return; // Arr√™ter ici, ne pas calculer les r√©sultats
            }
            
            // V√©rifier les informations entreprise
            if (!currentData.company.companyName) {
                showAlert('Veuillez d\'abord remplir les informations entreprise.', 'warning');
                showSection('company');
                return;
            }
            
// üéØ VALIDATION SP√âCIALE POUR LES CERTIFICATIONS
            let certificationError = false;
            
            // V√©rifier si quelqu'un a coch√© "Oui" pour les certifications mais n'a rien √©crit
            for (let dimIndex = 0; dimIndex < dimensions.length; dimIndex++) {
                const dimension = dimensions[dimIndex];
                for (let qIndex = 0; qIndex < dimension.questions.length; qIndex++) {
                    const question = dimension.questions[qIndex];
                    
                    if (question.includes('certifications qualit√©')) {
                        const questionId = `${dimIndex}-${qIndex}`;
                        const score = currentData.scores[questionId];
                        
                        // Si l'utilisateur a coch√© "Oui" (score = 4)
                        if (score === 4) {
                            const certificationDetails = currentData.certificationDetails && currentData.certificationDetails[questionId];
                            
                            // Mais n'a pas rempli le champ ou l'a laiss√© vide
                            if (!certificationDetails || certificationDetails.trim() === '') {
                                let message = 'üö® <strong>CERTIFICATION MANQUANTE</strong><br><br>';
                                message += '‚ùå Vous avez indiqu√© poss√©der des <strong>certifications qualit√©</strong><br>';
                                message += 'mais vous n\'avez pas pr√©cis√© lesquelles.<br><br>';
                                message += 'üí° <strong>Merci d\'entrer au moins une certification</strong><br>';
                                message += '<em>Exemples : ISO 9001, HACCP, Certification Bio UE, FDA, CE, etc.</em><br><br>';
                                message += 'üìã <em>Faites d√©filer vers la question des certifications et remplissez le champ.</em>';
                                
                                showAlert(message, 'warning');
                                
                                // Faire d√©filer vers le haut pour voir les questions
                                window.scrollTo({
                                    top: 0,
                                    behavior: 'smooth'
                                });
                                
                                certificationError = true;
                                break; // Sortir de la boucle interne
                            }
                        }
                    }
                }
                if (certificationError) break; // Sortir de la boucle externe
            }
            
            // Si erreur de certification, arr√™ter compl√®tement la fonction
            if (certificationError) {
                return;
            }

            // Calculer les scores par dimension
            const dimensionScores = [];
            let globalWeightedScore = 0;
            
            dimensions.forEach((dimension, dimIndex) => {
                let dimensionTotal = 0;
                const questionsCount = dimension.questions.length;
                
                dimension.questions.forEach((question, qIndex) => {
                    const questionId = `${dimIndex}-${qIndex}`;
                    dimensionTotal += currentData.scores[questionId] || 0;
                });
                
                const dimensionPercent = (dimensionTotal / (questionsCount * 4)) * 100;
                const weightedContribution = (dimensionPercent * dimension.weight) / 100;
                
                dimensionScores.push({
                    name: dimension.title,
                    rawScore: dimensionTotal,
                    maxScore: questionsCount * 4,
                    percentage: Math.round(dimensionPercent),
                    weight: dimension.weight,
                    contribution: weightedContribution
                });
                
                globalWeightedScore += weightedContribution;
            });
            
            // Ajustement sectoriel
            const sectorCoefficient = getSectorCoefficient(currentData.company.sector);
            const adjustedScore = Math.round(globalWeightedScore * sectorCoefficient);
            
            // D√©terminer le niveau
            const level = determineLevel(adjustedScore);
            
            // Calculer l'√©cart-type
            const percentages = dimensionScores.map(d => d.percentage);
            const average = percentages.reduce((a, b) => a + b, 0) / percentages.length;
            const variance = percentages.reduce((acc, val) => acc + Math.pow(val - average, 2), 0) / percentages.length;
            const standardDeviation = Math.round(Math.sqrt(variance) * 10) / 10;
            
            // Sauvegarder les r√©sultats
            currentData.results = {
                globalScore: Math.round(globalWeightedScore),
                adjustedScore: adjustedScore,
                level: level,
                standardDeviation: standardDeviation,
                dimensionScores: dimensionScores,
                calculationDate: new Date().toLocaleDateString('fr-FR')
            };
            
            // Afficher les r√©sultats avec effet de chargement
            debugCertifications();
	    displayResults();
            saveToHistory();
            saveToStorage();

	    // D√©marrer l'animation de chargement avant d'aller aux r√©sultats
            startLoadingAnimation('results');
            
            // Attendre 10 secondes puis afficher les r√©sultats
            setTimeout(() => {
                completeLoading('results');
            }, 10000);

	    // Afficher le bouton Google Sheets si l'API est pr√™te
            if (isGoogleSheetsReady) {
                setTimeout(() => {
                    showGoogleSheetsButton();
                }, 500); // Attendre que l'affichage soit termin√©
            }

        }

// Analyser les questions critiques individuelles
        function analyzeCriticalQuestions() {
            const criticalQuestions = [];
            const warningQuestions = [];
            
            dimensions.forEach((dimension, dimIndex) => {
                dimension.questions.forEach((question, qIndex) => {
    const questionId = `${dimIndex}-${qIndex}`;
    const score = currentData.scores[questionId] || 0;
    
    // Logique sp√©ciale pour les certifications (binaire : 1 = non, 4 = oui)
    if (question.includes('certifications qualit√©')) {
        if (score === 1) {
            criticalQuestions.push({
                dimension: dimension.title,
                question: question,
                score: score,
                severity: 'CRITIQUE'
            });
        }
        // Score 4 pour certifications = excellent, pas de probl√®me
    } else {
        // Logique normale pour les autres questions
        if (score === 1) {
            criticalQuestions.push({
                dimension: dimension.title,
                question: question,
                score: score,
                severity: 'CRITIQUE'
            });
        } else if (score === 2) {
            warningQuestions.push({
                dimension: dimension.title,
                question: question,
                score: score,
                severity: '√âLEV√â'
            });
        }
    }
});
            });
            
            return { critical: criticalQuestions, warning: warningQuestions };
        }

/*
=== LOGIQUE DES COEFFICIENTS SECTORIELS ===

1. EXPORT READINESS COEFFICIENTS (Score) :
   - Objectif : Ajuster le score selon les avantages comparatifs de la CI
   - Mines et M√©taux = 1.2 ‚Üí CI tr√®s comp√©titive ‚Üí boost score +20%
   - √âlectronique = 0.7 ‚Üí CI peu comp√©titive ‚Üí r√©duit score -30%
   - Logique : Plus le secteur est favorable √† la CI, plus le coefficient est √©lev√©

2. INVESTMENT MULTIPLIERS (Budget) :
   - Objectif : Estimer les co√ªts r√©els de d√©veloppement par secteur  
   - √âlectronique = 1.6 ‚Üí √âquipements co√ªteux ‚Üí budget x1.6  
   - Artisanat = 0.8 ‚Üí Investissements limit√©s ‚Üí budget x0.8
   - Logique : Plus le secteur n√©cessite d'investissements, plus le multiplicateur est √©lev√©

EXEMPLE : √âlectronique
- Score r√©duit (0.7) car CI pas comp√©titive
- Budget √©lev√© (1.6) car d√©veloppement co√ªteux
*/

        // D√©terminer le niveau
        function determineLevel(score) {
            if (score >= 80) return 'EXCELLENT';
            if (score >= 65) return 'BON POTENTIEL';
            if (score >= 45) return 'POTENTIEL MOYEN';
            return 'D√âVELOPPEMENT N√âCESSAIRE';
        }

        // Afficher les r√©sultats
        function displayResults() {
            const container = document.getElementById('resultsContainer');
            const results = currentData.results;
            const company = currentData.company;
            
            if (!results) return;
            
            let levelColor = '#34a853';
            if (results.adjustedScore < 45) levelColor = '#ea4335';
            else if (results.adjustedScore < 65) levelColor = '#ff9900';
            
            // Ajouter la navigation secondaire
            let html = createSecondaryNav(resultsNavItems);
            
            html += `
                <div id="scores-globaux" class="anchor-section">
                    <h3 class="anchor-title">üéØ SCORES GLOBAUX</h3>
                    <div class="results-header" style="background: linear-gradient(135deg, ${levelColor}, ${levelColor}dd);">
                        <div style="flex: 1;">
                            <h2 style="margin: 0 0 5px 0; font-size: 1.4em;">üìä ${company.companyName}</h2>
                            <div style="font-size: 0.9em; opacity: 0.8;">${results.level} ‚Ä¢ √âvaluation du ${results.calculationDate}</div>
                        </div>
                        <div style="text-align: right;">
                            <div class="score-display">${results.globalScore}%</div>
                            <div style="font-size: 0.85em; opacity: 0.8; margin-top: 2px;">Ajust√© : ${results.adjustedScore}%</div>
                        </div>
                    </div>
                </div>
                
                <div id="par-dimension" class="anchor-section">
                    <h3 class="anchor-title">üìä SCORES PAR DIMENSION</h3>
                    <div class="dimension-scores">
            `;
            
            // Scores par dimension
            results.dimensionScores.forEach(dimension => {
                let barColor = '#ea4335';
                if (dimension.percentage >= 75) barColor = '#34a853';
                else if (dimension.percentage >= 50) barColor = '#ff9900';
                
                html += `
                    <div class="dimension-card">
                        <div class="dimension-name">${dimension.name.replace(/^\d+\.\s*/, '')}</div>
                        <div class="dimension-score">${dimension.percentage}%</div>
                        <div class="dimension-bar">
                            <div class="dimension-fill" style="width: ${dimension.percentage}%; background: ${barColor};"></div>
                        </div>
                        <small>Poids: ${dimension.weight}% | Score: ${dimension.rawScore}/${dimension.maxScore}</small>
                    </div>
                `;
            });
            
            html += '</div></div>';
            
            // Diagnostic global
            html += `<div id="diagnostic-global" class="anchor-section">`;
            html += generateGlobalDiagnosis(results, company);
            html += '</div>';
            
            // Actions prioritaires
            const specificRecommendations = generateSpecificRecommendations(currentData.scores, 'short');
            if (specificRecommendations.length > 0) {
                html += `
                    <div id="actions-prioritaires" class="anchor-section">
                        <h3 class="anchor-title">‚ö° ACTIONS PRIORITAIRES SP√âCIFIQUES</h3>
                        <div class="specific-recommendations" style="background: #fff3e0; padding: 20px; border-radius: 12px; margin: 20px 0; border-left: 5px solid #ff9900;">
                            <p style="margin-bottom: 15px;">Bas√© sur vos r√©ponses d√©taill√©es, voici les am√©liorations sp√©cifiques n√©cessaires :</p>
                `;
                
                specificRecommendations.forEach((rec, index) => {
                    const priorityColor = rec.priority === 'CRITIQUE' ? '#ea4335' : '#ff9900';
                    html += `
                        <div style="background: white; padding: 12px; margin: 8px 0; border-radius: 6px; border-left: 3px solid ${priorityColor};">
                            <div style="display: flex; align-items: center; margin-bottom: 5px;">
                                <span style="background: ${priorityColor}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 10px; margin-right: 10px;">
                                    ${rec.priority}
                                </span>
                                <strong style="color: #333;">${rec.dimension}</strong>
                            </div>
                            <p style="margin: 0; color: #666; font-size: 14px;">${rec.text}</p>
                        </div>
                    `;
                });
                
                html += '</div></div>';
            }

            // Plan strat√©gique
            html += `<div id="plan-strategique" class="anchor-section">`;
            html += generateStrategicRecommendations(results, company);
            html += '</div>';
            
            // Export
            html += `
                <div id="export-resultats" class="anchor-section">
                    <h3 class="anchor-title">üìÑ EXPORTER VOS R√âSULTATS</h3>
                    <div style="background: linear-gradient(135deg, #1a73e8, #4285f4); color: white; padding: 25px; border-radius: 15px; margin: 20px 0; text-align: center;">
                        <h4>üìÑ EXPORTER VOS R√âSULTATS</h4>
                        <p style="margin: 15px 0;">T√©l√©chargez ou exportez votre rapport professionnel</p>
                        <button onclick="exportToPDF('complete')" class="btn" style="background: white; color: #1a73e8; border: none; padding: 15px 30px; border-radius: 8px; cursor: pointer; font-weight: bold; margin: 10px; font-size: 1.1em;">
                            üì• T√©l√©charger Rapport PDF
                        </button>
                        <button onclick="exportToGoogleSheets()" class="btn google-sheets-btn" style="background: #34a853; color: white; border: none; padding: 15px 30px; border-radius: 8px; cursor: pointer; font-weight: bold; margin: 10px; font-size: 1.1em; display: none;">
                            üìä Exporter vers Google Sheets
                        </button>
                    </div>
                </div>
            `;

            container.innerHTML = html;
        }

        // Diagnostic global approfondi
        function generateGlobalDiagnosis(results, company) {
            const score = results.adjustedScore;
            const weakDimensions = results.dimensionScores.filter(d => d.percentage < 50);
            const strongDimensions = results.dimensionScores.filter(d => d.percentage >= 75);
            const criticalDimensions = results.dimensionScores.filter(d => d.percentage < 30);

	// Analyser les questions individuelles critiques
                const criticalAnalysis = analyzeCriticalQuestions();
                const hasCriticalQuestions = criticalAnalysis.critical.length > 0 || criticalAnalysis.warning.length > 0;            

            // Analyse de coh√©rence
            const coherenceAnalysis = analyzeCoherence(results);
            
            // Identification goulots d'√©tranglement
            const bottlenecks = identifyBottlenecks(results, company.sector);
            
            // Estimation d√©lais et budget
            const timeline = estimateTimeline(score, weakDimensions.length);
            const budget = estimateBudget(score, weakDimensions, company.sector);
            
            let diagnosis = `
                <div class="detailed-diagnosis">
                    <h4>üìä DIAGNOSTIC COMPLET POUR ${company.companyName.toUpperCase()}</h4>
                    
                    <div class="diagnosis-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                        <div class="diagnosis-card" style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #1a73e8;">
    <h5>üéØ PROFIL EXPORT</h5>
    <p><strong>Score brut :</strong> ${results.globalScore}%</p>
    <p><strong>Score ajust√© :</strong> ${score}%</p>
    ${results.globalScore !== score ? `
        <div style="background: #e3f2fd; padding: 10px; border-radius: 6px; margin: 8px 0; border-left: 3px solid #1a73e8;">
            <p style="margin: 0; font-size: 0.9em; color: #1565c0;">
                <strong>üí° Explication de l'ajustement :</strong> 
                ${getAdjustmentExplanation(company.sector, results.globalScore, score)}
            </p>
        </div>
    ` : ''}
    <p><strong>Niveau :</strong> ${results.level}</p>
                            <p><strong>D√©lai export :</strong> ${timeline}</p>
                            <p><strong>Budget total :</strong> ${budget}</p>
                            <p><strong>Homog√©n√©it√© :</strong> ${coherenceAnalysis.type}</p>
                        </div>
                        
                        <div class="diagnosis-card" style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #ff9900;">
                            <h5>‚ö° FORCES & FAIBLESSES</h5>
                            <p><strong>Dimensions fortes :</strong> ${strongDimensions.length}/10</p>
                            <p><strong>Dimensions faibles :</strong> ${weakDimensions.length}/10</p>
                            <p><strong>Dimensions critiques :</strong> ${criticalDimensions.length}/10</p>
                        </div>
                    </div>
                    
                    <div class="diagnosis-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                        <div class="diagnosis-card" style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #228B22;">
                            <h5>üåç MARCH√âS ACTUELS</h5>
                            <p>${(company.currentMarkets && company.currentMarkets.length > 0) ? company.currentMarkets.join(', ') : 'Non sp√©cifi√©s'}</p>
                        </div>
                        
                        <div class="diagnosis-card" style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #FF6B35;">
                            <h5>üéØ MARCH√â CIBLE</h5>
                            <p>${company.targetMarket || 'Non sp√©cifi√©'}</p>
                        </div>
                    </div>
                    
                    <div class="coherence-analysis" style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <h5>üîç ANALYSE DE COH√âRENCE</h5>
                        ${coherenceAnalysis.description}
                        <p><strong>Impact :</strong> ${coherenceAnalysis.impact}</p>
                        <p><strong>Recommandation :</strong> ${coherenceAnalysis.recommendation}</p>
                    </div>
                    
                     `;
 // Afficher les atouts certifications si disponibles
                    if (currentData.certificationDetails) {
                        Object.entries(currentData.certificationDetails).forEach(([questionId, details]) => {
                            if (details && details.trim()) {
                                diagnosis += `
                                    <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #34a853;">
                                        <h5>‚úÖ ATOUT MAJEUR - CERTIFICATIONS EXISTANTES</h5>
                                        <p><strong>Certifications poss√©d√©es :</strong> ${details}</p>
                                        <p style="color: #2e7d32;"><strong>Impact positif :</strong> Facilite l'acc√®s aux march√©s internationaux exigeants</p>
                                    </div>
                                `;
                            }
                        });
                    }
                    
                    diagnosis += `
                    <div class="bottleneck-analysis" style="background: #fff3e0; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <h5>üö® GOULOTS D'√âTRANGLEMENT IDENTIFI√âS</h5>
                        <ol>
                            ${bottlenecks.details.map(item => `<li><strong>${item.dimension}</strong>: ${item.impact}</li>`).join('')}
                        </ol>
                        <p><strong>Risque principal :</strong> ${bottlenecks.mainRisk}</p>
                    </div>
                    
                    ${hasCriticalQuestions ? `
                    <div class="critical-questions-alert" style="background: #ffebee; padding: 20px; border-radius: 8px; margin: 15px 0; border: 2px solid #ea4335;">
                        <h5 style="color: #ea4335;">üö® ALERTE - D√âFAILLANCES CRITIQUES D√âTECT√âES</h5>
                        <p style="color: #c62828; font-weight: bold;">Malgr√© un score global satisfaisant, des faiblesses majeures ont √©t√© identifi√©es sur des questions sp√©cifiques :</p>
                        
                        ${criticalAnalysis.critical.length > 0 ? `
<div style="background: #ffcdd2; padding: 15px; border-radius: 6px; margin: 10px 0;">
    <h6 style="color: #b71c1c;">‚õî D√âFAILLANCES CRITIQUES (Score 1/4) :</h6>
    <ul style="margin: 10px 0;">
        ${criticalAnalysis.critical.map(item => `
            <li style="margin: 8px 0;"><strong>${item.dimension.replace(/^\d+\.\s*/, '')} :</strong> ${transformQuestionToStatement(item.question)}</li>
        `).join('')}
    </ul>
                            <p style="color: #d32f2f; font-weight: bold;">‚ö†Ô∏è URGENCE ABSOLUE : Ces √©l√©ments doivent √™tre corrig√©s avant tout lancement export !</p>
                        </div>
                        ` : ''}
                        
                        ${criticalAnalysis.warning.length > 0 ? `
<div style="background: #ffe0b2; padding: 15px; border-radius: 6px; margin: 10px 0;">
    <h6 style="color: #e65100;">‚ö†Ô∏è FAIBLESSES IMPORTANTES (Score 2/4) :</h6>
    <ul style="margin: 10px 0;">
        ${criticalAnalysis.warning.map(item => `
            <li style="margin: 8px 0;"><strong>${item.dimension.replace(/^\d+\.\s*/, '')} :</strong> ${transformQuestionToStatement(item.question)}</li>
        `).join('')}
    </ul>
                            <p style="color: #f57c00; font-weight: bold;">üìã PRIORIT√â HAUTE : Am√©lioration obligatoire avant export.</p>
                        </div>
                        ` : ''}
                    </div>
                    ` : ''}
                </div>
            `;
            
            return diagnosis;
        }

        // Analyse de coh√©rence
        function analyzeCoherence(results) {
            const percentages = results.dimensionScores.map(d => d.percentage);
            const average = percentages.reduce((a, b) => a + b, 0) / percentages.length;
            const variance = percentages.reduce((acc, val) => acc + Math.pow(val - average, 2), 0) / percentages.length;
            const standardDeviation = Math.sqrt(variance);
            
            let coherenceType, description, impact, recommendation;
            
            if (standardDeviation < 10) {
                coherenceType = "√âQUILIBR√â";
                description = "Profil homog√®ne avec des capacit√©s coh√©rentes entre toutes les dimensions.";
                impact = "Facilite la pr√©sentation commerciale et r√©duit les risques per√ßus.";
                recommendation = "Maintenez cette homog√©n√©it√© en d√©veloppant toutes les dimensions de mani√®re √©quilibr√©e.";
            } else if (standardDeviation < 20) {
                coherenceType = "MOYENNEMENT √âQUILIBR√â";
                description = "Quelques disparit√©s entre dimensions mais profil globalement coh√©rent.";
                impact = "N√©cessite une communication cibl√©e pour mettre en avant les points forts.";
                recommendation = "Concentrez 60% des efforts sur les 2-3 dimensions les plus faibles.";
            } else if (standardDeviation < 30) {
                coherenceType = "H√âT√âROG√àNE";
                description = "Profil contrast√© avec des points forts marqu√©s mais aussi des faiblesses significatives.";
                impact = "Risque que les faiblesses compromettent l'exploitation des forces.";
                recommendation = "URGENCE: Investissez 80% des ressources sur les dimensions les plus faibles.";
            } else {
                coherenceType = "TR√àS H√âT√âROG√àNE";
                description = "D√©s√©quilibres majeurs avec d'excellentes capacit√©s dans certains domaines mais des d√©faillances critiques dans d'autres.";
                impact = "Situation √† risque √©lev√© - les faiblesses peuvent annuler les avantages des forces.";
                recommendation = "CRITIQUE: Plan de r√©√©quilibrage urgent n√©cessaire avant tout lancement export.";
            }
            
            return { type: coherenceType, description, impact, recommendation };
        }

        // Identification des goulots d'√©tranglement
        function identifyBottlenecks(results, sector) {
            const weakDimensions = results.dimensionScores
                .filter(d => d.percentage < 50)
                .sort((a, b) => a.percentage - b.percentage);
            
            const criticalDimensions = results.dimensionScores.filter(d => d.percentage < 30);
            
            let primaryBottleneck = "Aucun goulot critique";
            let mainRisk = "Risques limit√©s";
            let details = [];
            
            if (weakDimensions.length > 0) {
                const critical = weakDimensions[0];
                primaryBottleneck = critical.name.split(' ')[0];
                
                const impacts = {
                    'QUALIT√â': { impact: "Rejet produits, amendes r√©glementaires, perte de r√©putation", severity: "CRITIQUE" },
                    'PRIX': { impact: "Erreurs pricing co√ªteuses, litiges paiement, pertes change", severity: "√âLEV√â" },
                    'FINANCI√àRE': { impact: "Rupture tr√©sorerie, incapacit√© honorer commandes", severity: "CRITIQUE" },
                    'EXP√âRIENCE': { impact: "Erreurs strat√©giques, non-conformit√©s, √©checs commerciaux", severity: "√âLEV√â" },
                    'PRODUIT': { impact: "Positionnement inad√©quat, √©chec commercial", severity: "√âLEV√â" }
                };
                
                weakDimensions.forEach(dim => {
                    const key = dim.name.toUpperCase().split(' ')[0];
                    const impactInfo = impacts[key] || { impact: "Impact n√©gatif sur performance export", severity: "MOYEN" };
                    
                    details.push({
                        dimension: dim.name.split(' ')[0],
                        percentage: dim.percentage,
                        impact: impactInfo.impact,
                        severity: impactInfo.severity
                    });
                });
                
                if (criticalDimensions.length >= 3) {
                    mainRisk = "RISQUE MAJEUR - √âchec probable sans redressement imm√©diat";
                } else if (criticalDimensions.length >= 1) {
                    mainRisk = "RISQUE √âLEV√â - Consolidation urgente requise";
                } else if (weakDimensions.length >= 4) {
                    mainRisk = "RISQUE MOD√âR√â - D√©veloppement structur√© n√©cessaire";
                } else {
                    mainRisk = "RISQUE LIMIT√â - Am√©liorations cibl√©es suffisantes";
                }
            }
            
            return { primary: primaryBottleneck, mainRisk, details };
        }

        // Estimation timeline
        function estimateTimeline(score, weakCount) {
            if (score >= 80) return "Imm√©diat (0-3 mois)";
            if (score >= 65) return "Court terme (3-6 mois)";
            if (score >= 45) return "Moyen terme (6-12 mois)";
            if (weakCount >= 6) return "Long terme (18-24 mois)";
            return "Moyen-long terme (12-18 mois)";
        }

        // Estimation budget
        function estimateBudget(score, weakDimensions, sector) {
            let baseBudget = 0;
            
            if (score >= 80) baseBudget = 2000000;
            else if (score >= 65) baseBudget = 5000000;
            else if (score >= 45) baseBudget = 10000000;
            else baseBudget = 20000000;
            
            const criticalDimensions = weakDimensions.filter(d => d.percentage < 30);
            baseBudget += criticalDimensions.length * 3000000;
            
            const sectorMultipliers = {
    // ‚úÖ SECTEURS PRIMAIRES
    'Agriculture': 1.1,
    'Agroforesterie': 1.2,
    'Mines et M√©taux': 1.4,
    'P√©trole et Gaz': 1.5,
    
    // ‚úÖ TRANSFORMATION
    'Agro-alimentaire': 1.2,
    'Pharmaceutique': 1.5,
    'Cosm√©tiques': 1.3,
    
    // ‚úÖ MANUFACTURIERS
    'Textile': 1.0,
    'Confection': 0.9,
    'Artisanat': 0.8,
    'Bois et Ameublement': 1.1,
    'Mat√©riaux de Construction': 1.2,
    'Chimie et Parachimie': 1.4,
    '√âlectronique': 1.6,
    'M√©canique': 1.3,
    
    // ‚úÖ SERVICES
    'Transport et Logistique': 1.1,
    'Services Financiers': 1.2,
    'Tourisme': 1.0,
    'BTP': 1.1,
    '√ânergie Renouvelable': 1.3,
    
    // ‚úÖ D√âFAUT
    'Autre': 1.0
};
            
            const multiplier = sectorMultipliers[sector] || 1.0;
            const finalBudget = baseBudget * multiplier;
            
            if (finalBudget >= 1000000) {
                return Math.round(finalBudget / 1000000) + "M FCFA";
            } else {
                return Math.round(finalBudget / 1000) + "K FCFA";
            }
        }

        // G√©n√©rer recommandations strat√©giques
        function generateStrategicRecommendations(results, company) {
            const weakDimensions = results.dimensionScores.filter(d => d.percentage < 50);
            const score = results.adjustedScore;
            
            let recommendations = `
                <div class="strategic-recommendations">
                    <h4>üí° PLAN D'ACTION STRAT√âGIQUE D√âTAILL√â</h4>
            `;
            
            if (score >= 80) {
                recommendations += `
                    <div style="background: #e8f5e8; padding: 20px; border-radius: 10px; margin: 15px 0;">
                        <h5>‚úÖ STRAT√âGIE LANCEMENT IMM√âDIAT</h5>
                        <p><strong>Position :</strong> Entreprise mature pour l'export avec excellentes capacit√©s.</p>
                        
                        <h6>üéØ PLAN D'ACTION IMM√âDIAT (0-90 jours) :</h6>
                        <ul>
                            <li><strong>Semaines 1-2 :</strong> Documentation commerciale multilingue - Budget : 300-800K FCFA</li>
                            <li><strong>Semaines 3-6 :</strong> Inscription 3 salons internationaux - Budget : 1.5-4M FCFA</li>
                            <li><strong>Semaines 7-12 :</strong> Missions commerciales dans 2 pays - Budget : 800K-2M FCFA</li>
                        </ul>
                        
                        <p><strong>üéØ OBJECTIFS 12 MOIS :</strong></p>
<ul>
    <li>2-4 contrats export sign√©s</li>
    <li>5-10% du CA g√©n√©r√© √† l'export</li>
    <li>ROI export : 80-120% sur investissement</li>
</ul>
                    </div>
                `;
            } else if (score >= 65) {
                recommendations += `
                    <div style="background: #e3f2fd; padding: 20px; border-radius: 10px; margin: 15px 0;">
                        <h5>üöÄ STRAT√âGIE PR√âPARATION FINALE</h5>
                        <p><strong>Position :</strong> Bon potentiel avec quelques ajustements n√©cessaires.</p>
                        
                        <h6>‚ö° PLAN DE MISE √Ä NIVEAU (3-6 mois) :</h6>
                        <ul>
                            <li><strong>Mois 1 :</strong> D√©marrage actions correctives prioritaires</li>
                            <li><strong>Mois 2 :</strong> 50% des faiblesses corrig√©es</li>
                            <li><strong>Mois 3 :</strong> Validation conformit√© standards export</li>
                            <li><strong>Mois 6 :</strong> Pr√™t pour lancement export</li>
                        </ul>
                    </div>
                `;
            } else if (score >= 45) {
                recommendations += `
                    <div style="background: #fff3e0; padding: 20px; border-radius: 10px; margin: 15px 0;">
                        <h5>‚ö° STRAT√âGIE D√âVELOPPEMENT STRUCTUR√â</h5>
                        <p><strong>Position :</strong> Potentiel export identifi√© n√©cessitant d√©veloppement cibl√©.</p>
                        
                        <h6>üîß PROGRAMME DE D√âVELOPPEMENT (6-12 mois) :</h6>
                        <ul>
                            <li><strong>Phase 1 (0-3 mois) :</strong> Fondamentaux - Formation √©quipe, processus internes</li>
                            <li><strong>Phase 2 (3-6 mois) :</strong> Conformit√© - Certifications, mise aux normes</li>
                            <li><strong>Phase 3 (6-9 mois) :</strong> Adaptation - Produits export, √©tudes march√©</li>
                            <li><strong>Phase 4 (9-12 mois) :</strong> Pr√©paration - Tests, partenariats</li>
                        </ul>
                        
                        <p><strong>üéØ OBJECTIF 12 MOIS :</strong> Score export 70%+ et premi√®re mission commerciale</p>
                    </div>
                `;
            } else {
                recommendations += `
                    <div style="background: #ffebee; padding: 20px; border-radius: 10px; margin: 15px 0;">
                        <h5>üîß STRAT√âGIE CONSOLIDATION FONDAMENTAUX</h5>
                        <p><strong>Position :</strong> Consolidation interne n√©cessaire avant export.</p>
                        
                        <h6>üèóÔ∏è PLAN DE REDRESSEMENT (12-24 mois) :</h6>
                        <ul>
                            <li><strong>Phase 1 - Stabilisation (0-6 mois) :</strong> Audit organisation, formation management</li>
                            <li><strong>Phase 2 - D√©veloppement (6-12 mois) :</strong> Investissements, renforcement capacit√©s</li>
                            <li><strong>Phase 3 - Pr√©paration Export (12-18 mois) :</strong> Formation commerce international</li>
                        </ul>
                        
                        <p><strong>‚ö†Ô∏è CONDITION CRITIQUE :</strong> Ne pas se lancer √† l'export avant d'avoir atteint 65% minimum</p>
                    </div>
                `;
            }
            
            // Actions prioritaires par dimension faible
            if (weakDimensions.length > 0) {
                recommendations += `
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 15px 0;">
                        <h5>üéØ ACTIONS PRIORITAIRES PAR DIMENSION</h5>
                `;
                
                weakDimensions.slice(0, 3).forEach(dim => {
                    const actions = getDetailedActions(dim.name, dim.percentage);
                    recommendations += `
                        <div style="background: white; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 4px solid #ff9900;">
                            <h6>${dim.name.replace(/^\d+\.\s*/, '')} (${dim.percentage}%)</h6>
                            ${actions}
                        </div>
                    `;
                });
                
                recommendations += '</div>';
            }
            
            // Budget et ROI
            const budgetEstimate = score < 50 ? '8-25M FCFA' : score < 70 ? '3-12M FCFA' : '1-5M FCFA';
            
            recommendations += `
                <div style="background: #e8f5e8; padding: 20px; border-radius: 10px; margin: 15px 0;">
                    <h5>üí∞ INVESTISSEMENT ET RETOUR SUR INVESTISSEMENT</h5>
                    <p><strong>Budget total estim√© :</strong> ${budgetEstimate}</p>
                   <p><strong>ROI attendu :</strong> 80-150% sur 2-3 ans</p>
                    <p><strong>D√©lai d'amortissement :</strong> 18-30 mois pour les entreprises bien pr√©par√©es</p>
                    <p><strong>CA export cible :</strong> 15-40% du CA total dans les 2-3 ans</p>
                </div>
            `;
            
            recommendations += '</div>';
            return recommendations;
        }

        // Actions d√©taill√©es par dimension
        function getDetailedActions(dimensionName, percentage) {
            if (dimensionName.includes('Qualit√©')) {
                return `
                    <p><strong>Actions imm√©diates :</strong></p>
                    <ul>
                        <li>Audit qualit√© externe par organisme certifi√© (2 semaines)</li>
                        <li>Lancement certifications adapt√©es au secteur (6-12 mois)</li>
                        <li>Formation √©quipe aux standards qualit√© (40h/personne)</li>
                        <li>√âquipements contr√¥le qualit√© selon secteur</li>
                    </ul>
                    <p><strong>Budget :</strong> 800K-3M FCFA | <strong>ROI :</strong> Acc√®s march√©s premium +30%</p>
                `;
            } else if (dimensionName.includes('Prix')) {
                return `
                    <p><strong>Actions imm√©diates :</strong></p>
                    <ul>
                        <li>Formation intensive Incoterms 2020 (3 jours)</li>
                        <li>D√©veloppement grille prix export par pays</li>
                        <li>Ouverture comptes multi-devises (EUR, USD)</li>
                        <li>Formation cr√©dit documentaire et paiements s√©curis√©s</li>
                    </ul>
                    <p><strong>Budget :</strong> 300K-1M FCFA | <strong>ROI :</strong> S√©curisation paiements +80%</p>
                `;
            } else if (dimensionName.includes('Financi√®re')) {
                return `
                    <p><strong>Actions imm√©diates :</strong></p>
                    <ul>
                        <li>Recherche financements export d√©di√©s (BPIFRANCE, AFD)</li>
                        <li>N√©gociation ligne cr√©dit export avec banque</li>
                        <li>Diversification sources financement</li>
                        <li>Mise en place reporting financier mensuel</li>
                    </ul>
                    <p><strong>Budget :</strong> 500K-2M FCFA | <strong>ROI :</strong> Capacit√© d√©veloppement x1.5-2.5</p>
                `;
            } else if (dimensionName.includes('Exp√©rience')) {
                return `
                    <p><strong>Actions imm√©diates :</strong></p>
                    <ul>
                        <li>Recrutement responsable export exp√©riment√© (priorit√© absolue)</li>
                        <li>Formation direction aux fondamentaux commerce international</li>
                        <li>Participation missions √©conomiques et salons</li>
                        <li>Mentorat par entrepreneur exportateur exp√©riment√©</li>
                    </ul>
                    <p><strong>Budget :</strong> 2-5M FCFA/an | <strong>ROI :</strong> √âvitement erreurs co√ªteuses +150%</p>
                `;
            } else if (dimensionName.includes('Production')) {
                return `
                    <p><strong>Actions imm√©diates :</strong></p>
                    <ul>
                        <li>Audit capacit√© production vs projections export</li>
                        <li>Plan investissement √©quipements selon besoins</li>
                        <li>Formation √©quipes techniques et am√©lioration continue</li>
                        <li>Certification processus production (ISO, HACCP)</li>
                    </ul>
                    <p><strong>Budget :</strong> 3-15M FCFA | <strong>ROI :</strong> Capacit√© doubl√©e, fiabilit√© +50%</p>
                `;
            } else {
                return `
                    <p><strong>Actions recommand√©es :</strong></p>
                    <ul>
                        <li>Audit sp√©cialis√© de cette dimension</li>
                        <li>Plan d'action avec expert externe</li>
                        <li>Formation √©quipes concern√©es</li>
                        <li>Mise en place outils et processus adapt√©s</li>
                    </ul>
                    <p><strong>Budget :</strong> √Ä d√©finir selon besoins | <strong>ROI :</strong> Am√©lioration performance export</p>
                `;
            }
        }

        // Syst√®me d'alertes
        function showAlert(message, type = 'info') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.innerHTML = message;
            
            // Ins√©rer en haut du contenu
            const content = document.querySelector('.content');
            content.insertBefore(alertDiv, content.firstChild);
            
            // Supprimer apr√®s 5 secondes
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }

        // Historique des √©valuations
        function saveToHistory() {
            const history = JSON.parse(localStorage.getItem('exportToolHistory') || '[]');
            
            const entry = {
                id: Date.now(),
                date: new Date().toLocaleDateString('fr-FR'),
                time: new Date().toLocaleTimeString('fr-FR'),
                company: currentData.company,
                results: currentData.results
            };
            
            history.unshift(entry);
            
            // Garder seulement les 10 derni√®res √©valuations
            if (history.length > 10) {
                history.splice(10);
            }
            
            localStorage.setItem('exportToolHistory', JSON.stringify(history));
            loadHistory();
        }

        function loadHistory() {
            const history = JSON.parse(localStorage.getItem('exportToolHistory') || '[]');
            const container = document.getElementById('historyContainer');
            
            if (history.length === 0) {
                container.innerHTML = `
                    <div class="alert alert-warning">
                        <strong>Aucun historique disponible.</strong><br>
                        Vos √©valuations appara√Ætront ici une fois que vous aurez calcul√© vos premiers r√©sultats.
                    </div>
                `;
                return;
            }
            
            let html = '';
            history.forEach(entry => {
                let levelColor = '#34a853';
                if (entry.results.adjustedScore < 45) levelColor = '#ea4335';
                else if (entry.results.adjustedScore < 65) levelColor = '#ff9900';
                
                html += `
                    <div class="history-item">
                        <div class="history-header">
                            <div>
    <h4>${entry.company.companyName}</h4>
    <p><strong>Secteur:</strong> ${entry.company.sector} | <strong>March√© cible:</strong> ${entry.company.targetMarket || 'Non sp√©cifi√©'}</p>
    <p><strong>Dossier suivi par:</strong> ${entry.company.interviewer || 'Non sp√©cifi√©'}</p>
    <p><strong>Date:</strong> ${entry.date} √† ${entry.time}</p>
</div>
                            <div style="text-align: right;">
                                <div style="font-size: 2em; font-weight: bold; color: ${levelColor};">${entry.results.adjustedScore}%</div>
                                <div style="color: ${levelColor};">${entry.results.level}</div>
                            </div>
                        </div>
                        <div style="margin-top: 15px;">
                            
<button class="btn" onclick="deleteHistoryEntry(${entry.id})" style="background: #ea4335;">
                                üóëÔ∏è Supprimer
                            </button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function loadHistoryEntry(entryId, section = 'results') {
            const history = JSON.parse(localStorage.getItem('exportToolHistory') || '[]');
            const entry = history.find(e => e.id === entryId);
            
            if (entry) {
                currentData.company = entry.company;
                currentData.results = entry.results;
                displayResults();
                
                // Utiliser l'effet de chargement pour afficher la section demand√©e
                if (section === 'detailed') {
                    showSectionWithLoading('detailed');
                } else {
                    showSectionWithLoading('results');
                }
            }
        }

        function deleteHistoryEntry(entryId) {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer cette √©valuation ?')) {
                let history = JSON.parse(localStorage.getItem('exportToolHistory') || '[]');
                history = history.filter(e => e.id !== entryId);
                localStorage.setItem('exportToolHistory', JSON.stringify(history));
                loadHistory();
                showAlert('√âvaluation supprim√©e avec succ√®s.', 'success');
            }
        }

// Export PDF - Interface √©pur√©e avec informations entreprise compl√®tes
async function exportToPDF(type = 'complete') {
    if (!currentData.results) {
        showAlert('Aucun r√©sultat √† exporter. Veuillez d\'abord compl√©ter l\'√©valuation.', 'warning');
        return;
    }

    if (typeof window.jspdf === 'undefined') {
        showAlert('Erreur: Librairie PDF non charg√©e. Veuillez rafra√Æchir la page.', 'error');
        return;
    }

    const exportButton = event?.target;
    const originalText = exportButton?.innerHTML;
    if (exportButton) {
        exportButton.innerHTML = 'üìÑ G√©n√©ration PDF...';
        exportButton.disabled = true;
    }

    try {
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF('p', 'mm', 'a4');
        
        const pageWidth = 210;
        const pageHeight = 297;
        const margin = 20;
        const usableWidth = pageWidth - (2 * margin);
        let currentY = margin;

        // COULEURS √âPUR√âES
        const aciexGreen = [34, 139, 34];
        const blueColor = [26, 115, 232];
        const orangeColor = [255, 153, 0];
        const redColor = [234, 67, 53];
        const lightGray = [240, 240, 240];
        const darkGray = [51, 51, 51];
        const textGray = [102, 102, 102];

        function checkPageBreak(requiredHeight = 25) {
            if (currentY + requiredHeight > pageHeight - margin - 15) {
                pdf.addPage();
                addPageHeader();
                currentY = margin + 20;
                return true;
            }
            return false;
        }

        function addPageHeader() {
            // En-t√™te simple sans fond color√©
            pdf.setDrawColor(200, 200, 200);
            pdf.setLineWidth(0.3);
            pdf.line(margin, 15, pageWidth - margin, 15);
            
            pdf.setTextColor(...aciexGreen);
            pdf.setFontSize(10);
            pdf.setFont('helvetica', 'bold');
            pdf.text('ACIEX - Diagnostic Export', margin, 12);
            
            const pageNum = pdf.internal.getCurrentPageInfo().pageNumber;
            pdf.setTextColor(...textGray);
            pdf.setFontSize(8);
            pdf.text(`Page ${pageNum}`, pageWidth - margin - 15, 12);
        }

        function addText(text, x, y, maxWidth, fontSize = 10, style = 'normal', color = darkGray) {
            pdf.setFontSize(fontSize);
            pdf.setFont('helvetica', style);
            pdf.setTextColor(...color);
            
            const cleanText = text.replace(/[üîçüìäüè¢üìãüéØüìÑ‚è≥‚úÖ‚ùåüöÄüí°üìàüîß‚ö°üí∞üåçüìÖüë•üíºüì±üé®üî•‚≠êüö®üìûüíæüéâ]/g, '').replace(/\s+/g, ' ').trim();
            
            if (maxWidth) {
                const lines = pdf.splitTextToSize(cleanText, maxWidth);
                lines.forEach((line, index) => {
                    if (y + (index * fontSize * 0.4) > pageHeight - margin - 10) {
                        pdf.addPage();
                        addPageHeader();
                        y = margin + 20;
                    }
                    pdf.text(line, x, y + (index * fontSize * 0.4));
                });
                return y + (lines.length * fontSize * 0.4);
            } else {
                pdf.text(cleanText, x, y);
                return y + fontSize * 0.4;
            }
        }

        function addSectionTitle(title, color = aciexGreen) {
            checkPageBreak(15);
            pdf.setTextColor(...color);
            pdf.setFontSize(14);
            pdf.setFont('helvetica', 'bold');
            pdf.text(title, margin, currentY);
            
            // Ligne sous le titre
            pdf.setDrawColor(...color);
            pdf.setLineWidth(0.5);
            pdf.line(margin, currentY + 2, margin + 60, currentY + 2);
            
            currentY += 12;
        }

        function addSubSection(title, color = blueColor) {
            checkPageBreak(12);
            pdf.setTextColor(...color);
            pdf.setFontSize(11);
            pdf.setFont('helvetica', 'bold');
            pdf.text(title, margin, currentY);
            currentY += 8;
        }

        // 1. PAGE DE COUVERTURE √âPUR√âE
        function addCoverPage() {
            // Titre principal
            pdf.setTextColor(...aciexGreen);
            pdf.setFontSize(24);
            pdf.setFont('helvetica', 'bold');
            pdf.text('DIAGNOSTIC EXPORT', pageWidth/2, 40, { align: 'center' });
            
            pdf.setFontSize(14);
            pdf.setFont('helvetica', 'normal');
            pdf.text('Evaluation des Capacites Export', pageWidth/2, 55, { align: 'center' });

            // Informations entreprise dans un cadre simple
            pdf.setDrawColor(...aciexGreen);
            pdf.setLineWidth(1);
            pdf.rect(margin, 80, usableWidth, 60, 'S');

            pdf.setTextColor(...darkGray);
            pdf.setFontSize(18);
            pdf.setFont('helvetica', 'bold');
            pdf.text(currentData.company.companyName || 'Entreprise', pageWidth/2, 95, { align: 'center' });

            pdf.setFontSize(11);
            pdf.setFont('helvetica', 'normal');
            pdf.text(`Secteur: ${currentData.company.sector || 'Non specifie'}`, pageWidth/2, 108, { align: 'center' });
            pdf.text(`Marche cible: ${currentData.company.targetMarket || 'Non specifie'}`, pageWidth/2, 118, { align: 'center' });
            pdf.text(`Agent ACIEX: ${currentData.company.interviewer || 'Non specifie'}`, pageWidth/2, 128, { align: 'center' });

            // Score dans un cercle simple
            const scoreColor = currentData.results.adjustedScore >= 80 ? [52, 168, 83] : 
                             currentData.results.adjustedScore >= 65 ? blueColor :
                             currentData.results.adjustedScore >= 45 ? orangeColor : redColor;

            pdf.setDrawColor(...scoreColor);
            pdf.setLineWidth(3);
            pdf.circle(pageWidth/2, 175, 25, 'S');
            
            pdf.setTextColor(...scoreColor);
            pdf.setFontSize(20);
            pdf.setFont('helvetica', 'bold');
            pdf.text(`${currentData.results.adjustedScore}%`, pageWidth/2, 180, { align: 'center' });

            pdf.setFontSize(12);
            pdf.text(currentData.results.level, pageWidth/2, 205, { align: 'center' });

            pdf.setTextColor(...textGray);
            pdf.setFontSize(9);
            pdf.text(`Rapport genere le ${new Date().toLocaleDateString('fr-FR')}`, pageWidth/2, 240, { align: 'center' });

            pdf.addPage();
            addPageHeader();
            currentY = margin + 25;
        }

        // 2. INFORMATIONS ENTREPRISE COMPL√àTES (PREMI√àRE SECTION)
        function addCompanyInformation() {
            addSectionTitle('INFORMATIONS DE L\'ENTREPRISE');

            // Informations de base
            addSubSection('Identite de l\'entreprise');
            currentY = addText(`Nom: ${currentData.company.companyName || 'Non specifie'}`, margin + 5, currentY, usableWidth - 10, 10, 'normal');
            currentY += 5;
            currentY = addText(`Secteur d'activite: ${currentData.company.sector || 'Non specifie'}`, margin + 5, currentY, usableWidth - 10, 10, 'normal');
            currentY += 5;
            currentY = addText(`Pays du siege social: ${currentData.company.country || 'Non specifie'}`, margin + 5, currentY, usableWidth - 10, 10, 'normal');
            currentY += 5;
            currentY = addText(`Email de contact: ${currentData.company.email || 'Non specifie'}`, margin + 5, currentY, usableWidth - 10, 10, 'normal');
            currentY += 10;

            // Taille et finances
            addSubSection('Taille et Finances');
            currentY = addText(`Nombre d'employes: ${currentData.company.employees || 'Non specifie'}`, margin + 5, currentY, usableWidth - 10, 10, 'normal');
            currentY += 5;
            currentY = addText(`Chiffre d'affaires annuel: ${currentData.company.revenue || 'Non specifie'}`, margin + 5, currentY, usableWidth - 10, 10, 'normal');
            currentY += 10;

            // Dirigeant
            addSubSection('Profil du dirigeant');
            currentY = addText(`Sexe: ${currentData.company.leaderGender || 'Non specifie'}`, margin + 5, currentY, usableWidth - 10, 10, 'normal');
            currentY += 5;
            currentY = addText(`Tranche d'age: ${currentData.company.leaderAge || 'Non specifie'}`, margin + 5, currentY, usableWidth - 10, 10, 'normal');
            currentY += 10;

            // March√©s
            addSubSection('Marches et Export');
            currentY = addText(`Marches actuels: ${(currentData.company.currentMarkets || []).join(', ') || 'Non specifies'}`, margin + 5, currentY, usableWidth - 10, 10, 'normal');
            currentY += 5;
            currentY = addText(`Marche cible prioritaire: ${currentData.company.targetMarket || 'Non specifie'}`, margin + 5, currentY, usableWidth - 10, 10, 'normal');
            currentY += 10;

            // Suivi ACIEX
            addSubSection('Suivi ACIEX');
            currentY = addText(`Dossier suivi par: ${currentData.company.interviewer || 'Non specifie'}`, margin + 5, currentY, usableWidth - 10, 10, 'normal');
            currentY += 5;
            currentY = addText(`Date d'evaluation: ${currentData.results.calculationDate || new Date().toLocaleDateString('fr-FR')}`, margin + 5, currentY, usableWidth - 10, 10, 'normal');
            currentY += 15;
        }

        // 3. R√âSULTATS GLOBAUX
        function addGlobalResults() {
            addSectionTitle('RESULTATS GLOBAUX');

            const scoreColor = currentData.results.adjustedScore >= 80 ? [52, 168, 83] : 
                             currentData.results.adjustedScore >= 65 ? blueColor :
                             currentData.results.adjustedScore >= 45 ? orangeColor : redColor;

            // Scores en tableau simple
            pdf.setTextColor(...scoreColor);
            pdf.setFontSize(16);
            pdf.setFont('helvetica', 'bold');
            currentY = addText(`Score global: ${currentData.results.globalScore}%`, margin, currentY, usableWidth, 16, 'bold', scoreColor);
            currentY += 5;
            
            currentY = addText(`Score ajuste secteur: ${currentData.results.adjustedScore}%`, margin, currentY, usableWidth, 16, 'bold', scoreColor);
            currentY += 5;
            
            pdf.setFontSize(12);
            currentY = addText(`Niveau: ${currentData.results.level}`, margin, currentY, usableWidth, 12, 'bold', scoreColor);
            currentY += 10;

            // Explication ajustement si diff√©rent
            if (currentData.results.globalScore !== currentData.results.adjustedScore) {
                addSubSection('Explication de l\'ajustement sectoriel');
                const adjustmentText = getAdjustmentExplanation(currentData.company.sector, currentData.results.globalScore, currentData.results.adjustedScore);
                currentY = addText(adjustmentText, margin + 5, currentY, usableWidth - 10, 9, 'normal', textGray);
                currentY += 10;
            }
        }

        // 4. SCORES PAR DIMENSION √âPUR√âS
        function addDimensionScores() {
            addSectionTitle('SCORES PAR DIMENSION');

            currentData.results.dimensionScores.forEach((dimension, index) => {
                checkPageBreak(10);
                
                const dimName = dimension.name.replace(/^\d+\.\s*/, '');
                
                // Nom et pourcentage
                pdf.setTextColor(...darkGray);
                pdf.setFontSize(10);
                pdf.setFont('helvetica', 'bold');
                pdf.text(dimName, margin, currentY);
                
                pdf.setTextColor(...textGray);
                pdf.text(`${dimension.percentage}%`, pageWidth - margin - 20, currentY);
                
                // Barre de progression minimaliste
                const barWidth = 80;
                const barHeight = 2;
                const barX = pageWidth - margin - 100;
                
                pdf.setDrawColor(220, 220, 220);
                pdf.setLineWidth(barHeight);
                pdf.line(barX, currentY - 2, barX + barWidth, currentY - 2);
                
                const fillWidth = (dimension.percentage / 100) * barWidth;
                const barColor = dimension.percentage >= 75 ? [52, 168, 83] : 
                                dimension.percentage >= 50 ? orangeColor : redColor;
                
                pdf.setDrawColor(...barColor);
                pdf.line(barX, currentY - 2, barX + fillWidth, currentY - 2);
                
                // D√©tails en petit
                pdf.setTextColor(...textGray);
                pdf.setFontSize(8);
                pdf.text(`Poids: ${dimension.weight}% | Score: ${dimension.rawScore}/${dimension.maxScore}`, margin + 5, currentY + 4);
                
                currentY += 12;
            });

            currentY += 10;
        }

        // 5. ACTIONS PRIORITAIRES (√©pur√©)
        function addSpecificRecommendations() {
            const specificRecommendations = generateSpecificRecommendations(currentData.scores, 'detailed');

            if (specificRecommendations.length > 0) {
                addSectionTitle('ACTIONS PRIORITAIRES SPECIFIQUES');
                
                currentY = addText(`${specificRecommendations.length} actions identifiees comme necessitant une amelioration immediate:`, margin, currentY, usableWidth, 10, 'normal', textGray);
                currentY += 8;

                specificRecommendations.slice(0, 8).forEach((rec, index) => {
                    checkPageBreak(15);
                    
                    const priorityColor = rec.priority === 'CRITIQUE' ? redColor : orangeColor;
                    
                    // Num√©ro et priorit√©
                    pdf.setTextColor(...priorityColor);
                    pdf.setFontSize(9);
                    pdf.setFont('helvetica', 'bold');
                    pdf.text(`${index + 1}. ${rec.priority}`, margin, currentY);
                    
                    // Dimension
                    pdf.setTextColor(...darkGray);
                    pdf.setFont('helvetica', 'bold');
                    pdf.text(rec.dimension, margin + 25, currentY);
                    currentY += 5;
                    
                    // Action
                    currentY = addText(`${rec.text}`, margin + 5, currentY, usableWidth - 10, 9, 'normal', darkGray);
                    currentY += 8;
                });
            }
        }

        // 6. PLAN STRAT√âGIQUE SIMPLIFI√â
        function addStrategicPlan() {
            addSectionTitle('PLAN STRATEGIQUE');

            const score = currentData.results.adjustedScore;
            let timeline, budget, actions;
            
            if (score >= 80) {
                timeline = "0-3 mois";
                budget = "1-3M FCFA";
                actions = "Lancement immediat possible - Documentation finale et prospection active";
            } else if (score >= 65) {
                timeline = "3-6 mois";
                budget = "3-8M FCFA";
                actions = "Ajustements necessaires - Corrections prioritaires puis lancement";
            } else if (score >= 45) {
                timeline = "6-12 mois";
                budget = "5-15M FCFA";
                actions = "Developpement structure - Renforcement capacites et certifications";
            } else {
                timeline = "12-24 mois";
                budget = "10-30M FCFA";
                actions = "Consolidation fondamentaux - Audit complet et restructuration";
            }

            currentY = addText(`Delai recommande: ${timeline}`, margin, currentY, usableWidth, 11, 'bold', darkGray);
            currentY += 6;
            currentY = addText(`Budget estime: ${budget}`, margin, currentY, usableWidth, 11, 'bold', darkGray);
            currentY += 6;
            currentY = addText(`ROI attendu: 200-400% sur 2-3 ans`, margin, currentY, usableWidth, 10, 'normal', textGray);
            currentY += 8;
            currentY = addText(`Strategie: ${actions}`, margin, currentY, usableWidth, 10, 'normal', darkGray);
            currentY += 15;
        }

// 7. PLAN STRAT√âGIQUE D√âTAILL√â - EXPORT (comme dans l'interface)
        function addDetailedStrategicPlanFromInterface() {
            addSectionTitle('PLAN STRATEGIQUE DETAILLE - EXPORT');

            // R√©cup√©rer les donn√©es du diagnostic d√©taill√© existant
            const countryData = countryProfiles[currentData.company.targetMarket];
            
            // FEUILLE DE ROUTE STRAT√âGIQUE (utilise la fonction existante)
            addSubSection('Feuille de route strategique');
            const timeline = generateDetailedTimeline(currentData.results, countryData, currentData.company);
            
            // Parser le HTML pour extraire le texte
            const timelineText = timeline
                .replace(/<[^>]*>/g, '') // Supprimer les balises HTML
                .replace(/PHASE \d+ - /g, '\n‚Ä¢ PHASE ') // Formater les phases
                .replace(/\n\s*\n/g, '\n') // Supprimer les lignes vides multiples
                .trim();
            
            currentY = addText(timelineText, margin + 5, currentY, usableWidth - 10, 9, 'normal', darkGray);
            currentY += 10;

            // PLAN D'INVESTISSEMENT (utilise la fonction existante)
            addSubSection('Plan d\'investissement');
            const investment = calculateDetailedInvestment(currentData.results, countryData, currentData.company);
            const investmentText = investment
                .replace(/<[^>]*>/g, '')
                .replace(/‚Ä¢/g, '‚Ä¢ ')
                .trim();
            
            currentY = addText(investmentText, margin + 5, currentY, usableWidth - 10, 9, 'normal', darkGray);
            currentY += 10;

            // INDICATEURS DE PERFORMANCE (utilise la fonction existante)
            addSubSection('Indicateurs de performance');
            const kpis = defineKPIs(currentData.results, countryData, currentData.company);
            const kpisText = kpis
                .replace(/<[^>]*>/g, '')
                .replace(/‚Ä¢/g, '‚Ä¢ ')
                .trim();
            
            currentY = addText(kpisText, margin + 5, currentY, usableWidth - 10, 9, 'normal', darkGray);
            currentY += 10;

            // FACTEURS CL√âS DE SUCC√àS (utilise la fonction existante)
            addSubSection('Facteurs cles de succes');
            const successFactors = generateSuccessFactors(currentData.results, countryData, currentData.company);
            const factorsText = successFactors
                .replace(/<[^>]*>/g, '')
                .replace(/‚Ä¢/g, '‚Ä¢ ')
                .trim();
            
            currentY = addText(factorsText, margin + 5, currentY, usableWidth - 10, 9, 'normal', darkGray);
            currentY += 15;
        }

        // 8. ALERTES ET D√âFAILLANCES CRITIQUES (comme dans l'interface)
        function addCriticalAlertsFromInterface() {
            // Utiliser la fonction existante pour analyser les questions critiques
            const criticalAnalysis = analyzeCriticalQuestions();
            const hasCriticalQuestions = criticalAnalysis.critical.length > 0 || criticalAnalysis.warning.length > 0;

            if (hasCriticalQuestions) {
                addSectionTitle('ALERTE - DEFAILLANCES CRITIQUES DETECTEES', redColor);
                
                currentY = addText('Malgre un score global satisfaisant, des faiblesses majeures ont ete identifiees sur des questions specifiques:', margin, currentY, usableWidth, 10, 'bold', [200, 44, 40]);
                currentY += 8;

                // D√âFAILLANCES CRITIQUES (Score 1/4)
                if (criticalAnalysis.critical.length > 0) {
                    addSubSection('DEFAILLANCES CRITIQUES (Score 1/4)');
                    
                    criticalAnalysis.critical.forEach(item => {
                        checkPageBreak(10);
                        const statement = transformQuestionToStatement(item.question);
                        const dimName = item.dimension.replace(/^\d+\.\s*/, '');
                        
                        pdf.setTextColor(...redColor);
                        pdf.setFontSize(9);
                        pdf.setFont('helvetica', 'bold');
                        currentY = addText(`‚Ä¢ ${dimName}:`, margin + 5, currentY, usableWidth - 10, 9, 'bold', redColor);
                        currentY += 4;
                        
                        currentY = addText(statement, margin + 10, currentY, usableWidth - 15, 8, 'normal', darkGray);
                        currentY += 6;
                    });
                    
                    currentY = addText('URGENCE ABSOLUE: Ces elements doivent etre corriges avant tout lancement export!', margin, currentY, usableWidth, 10, 'bold', redColor);
                    currentY += 10;
                }

                // FAIBLESSES IMPORTANTES (Score 2/4)
                if (criticalAnalysis.warning.length > 0) {
                    addSubSection('FAIBLESSES IMPORTANTES (Score 2/4)');
                    
                    criticalAnalysis.warning.forEach(item => {
                        checkPageBreak(10);
                        const statement = transformQuestionToStatement(item.question);
                        const dimName = item.dimension.replace(/^\d+\.\s*/, '');
                        
                        pdf.setTextColor(...orangeColor);
                        pdf.setFontSize(9);
                        pdf.setFont('helvetica', 'bold');
                        currentY = addText(`‚Ä¢ ${dimName}:`, margin + 5, currentY, usableWidth - 10, 9, 'bold', orangeColor);
                        currentY += 4;
                        
                        currentY = addText(statement, margin + 10, currentY, usableWidth - 15, 8, 'normal', darkGray);
                        currentY += 6;
                    });
                    
                    currentY = addText('PRIORITE HAUTE: Amelioration obligatoire avant export.', margin, currentY, usableWidth, 10, 'bold', orangeColor);
                    currentY += 15;
                }
            } else {
                addSectionTitle('ANALYSE DES REPONSES');
                currentY = addText('Aucune defaillance critique identifiee dans vos reponses. Votre profil presente une coherence satisfaisante pour le developpement export.', margin, currentY, usableWidth, 10, 'normal', aciexGreen);
                currentY += 15;
            }
        }

// 7. PLAN STRAT√âGIQUE D√âTAILL√â - EXPORT
        function addDetailedStrategicPlan() {
            addSectionTitle('PLAN STRATEGIQUE DETAILLE - EXPORT');

            const score = currentData.results.adjustedScore;
            
            // FEUILLE DE ROUTE STRAT√âGIQUE
            addSubSection('Feuille de route strategique');
            
            let phases = [];
            if (score >= 70) {
                phases = [
                    { phase: 'PHASE 1', period: 'Mois 1-2', title: 'Finalisation Preparatifs', tasks: ['Documentation commerciale', 'Certifications finales', 'Echantillonnage'] },
                    { phase: 'PHASE 2', period: 'Mois 2-4', title: 'Prospection Active', tasks: ['Participation salons', 'Missions commerciales', 'Negociations distributeurs'] },
                    { phase: 'PHASE 3', period: 'Mois 4-6', title: 'Premiers Contrats', tasks: ['Signature accords', 'Livraisons pilotes', 'Ajustements operationnels'] },
                    { phase: 'PHASE 4', period: 'Mois 6+', title: 'Montee en Puissance', tasks: ['Developpement volumes', 'Extension gamme', 'Consolidation partenariats'] }
                ];
            } else if (score >= 50) {
                phases = [
                    { phase: 'PHASE 1', period: 'Mois 1-4', title: 'Renforcement Capacites', tasks: ['Formation equipes', 'Mise aux normes', 'Processus qualite'] },
                    { phase: 'PHASE 2', period: 'Mois 4-8', title: 'Preparation Marche', tasks: ['Etude marche approfondie', 'Adaptation produits', 'Strategie prix'] },
                    { phase: 'PHASE 3', period: 'Mois 8-12', title: 'Tests Marche', tasks: ['Echantillonnage', 'Prospection selective', 'Validation concept'] },
                    { phase: 'PHASE 4', period: 'Mois 12+', title: 'Lancement Commercial', tasks: ['Entree marche', 'Premiers clients', 'Optimisation continue'] }
                ];
            } else {
                phases = [
                    { phase: 'PHASE 1', period: 'Mois 1-6', title: 'Consolidation Interne', tasks: ['Audit complet', 'Plan redressement', 'Investissements prioritaires'] },
                    { phase: 'PHASE 2', period: 'Mois 6-12', title: 'Developpement Capacites', tasks: ['Formation intensive', 'Certifications', 'Systemes qualite'] },
                    { phase: 'PHASE 3', period: 'Mois 12-18', title: 'Preparation Export', tasks: ['Veille concurrentielle', 'Adaptation offre', 'Partenariats strategiques'] },
                    { phase: 'PHASE 4', period: 'Mois 18+', title: 'Demarrage Export', tasks: ['Prospection pilote', 'Tests marche', 'Premiers contrats'] }
                ];
            }
            
            phases.forEach((phase, index) => {
                checkPageBreak(12);
                
                pdf.setTextColor(...blueColor);
                pdf.setFontSize(10);
                pdf.setFont('helvetica', 'bold');
                currentY = addText(`${phase.phase} - ${phase.title} (${phase.period})`, margin + 5, currentY, usableWidth - 10, 10, 'bold', blueColor);
                currentY += 4;
                
                phase.tasks.forEach(task => {
                    currentY = addText(`‚Ä¢ ${task}`, margin + 10, currentY, usableWidth - 15, 9, 'normal', darkGray);
                    currentY += 4;
                });
                currentY += 6;
            });

            // PLAN D'INVESTISSEMENT D√âTAILL√â
            addSubSection('Plan d\'investissement detaille');
            
            const baseBudgets = {
                preparation: score < 50 ? 3000000 : score < 70 ? 1500000 : 800000,
                marketing: score < 50 ? 2000000 : score < 70 ? 1200000 : 800000,
                operations: score < 50 ? 5000000 : score < 70 ? 3000000 : 1500000,
                certification: score < 50 ? 2500000 : score < 70 ? 1800000 : 1000000
            };
            
            const multiplier = getSectorCoefficient(currentData.company.sector);
            
            currentY = addText(`Repartition budgetaire (coefficient secteur: ${multiplier.toFixed(1)}):`, margin + 5, currentY, usableWidth - 10, 10, 'bold', darkGray);
            currentY += 6;
            
            currentY = addText(`‚Ä¢ Preparation/Formation: ${Math.round(baseBudgets.preparation * multiplier / 1000)}K FCFA`, margin + 10, currentY, usableWidth - 15, 9, 'normal', darkGray);
            currentY += 4;
            currentY = addText(`‚Ä¢ Marketing/Commercial: ${Math.round(baseBudgets.marketing * multiplier / 1000)}K FCFA`, margin + 10, currentY, usableWidth - 15, 9, 'normal', darkGray);
            currentY += 4;
            currentY = addText(`‚Ä¢ Operations/Logistique: ${Math.round(baseBudgets.operations * multiplier / 1000)}K FCFA`, margin + 10, currentY, usableWidth - 15, 9, 'normal', darkGray);
            currentY += 4;
            currentY = addText(`‚Ä¢ Certifications/Conformite: ${Math.round(baseBudgets.certification * multiplier / 1000)}K FCFA`, margin + 10, currentY, usableWidth - 15, 9, 'normal', darkGray);
            currentY += 6;
            
            const totalBudget = Math.round((baseBudgets.preparation + baseBudgets.marketing + baseBudgets.operations + baseBudgets.certification) * multiplier / 1000000);
            currentY = addText(`TOTAL INVESTISSEMENT: ${totalBudget}M FCFA`, margin + 5, currentY, usableWidth - 10, 11, 'bold', aciexGreen);
            currentY += 4;
            currentY = addText(`ROI attendu: 200-400% sur 2-3 ans`, margin + 5, currentY, usableWidth - 10, 9, 'normal', textGray);
            currentY += 10;

            // INDICATEURS DE PERFORMANCE (KPIs)
            addSubSection('Indicateurs de performance (KPIs)');
            
            const kpis = {
                preparation: {
                    '6 mois': score >= 70 ? '95%' : score >= 50 ? '85%' : '70%',
                    '12 mois': '98%'
                },
                commercial: {
                    'Prospects qualifi√©s': score >= 70 ? '20-30' : score >= 50 ? '15-25' : '10-15',
                    'Premiers contrats': score >= 70 ? '3-6 mois' : score >= 50 ? '6-12 mois' : '12-18 mois'
                },
                financial: {
    'CA export Y1': score >= 70 ? '5-12%' : score >= 50 ? '3-8%' : '1-5%',
    'CA export Y3': score >= 70 ? '15-25%' : score >= 50 ? '10-20%' : '5-15%'
}
            };
            
            currentY = addText(`Objectifs Preparation:`, margin + 5, currentY, usableWidth - 10, 10, 'bold', darkGray);
            currentY += 4;
            currentY = addText(`‚Ä¢ 6 mois: ${kpis.preparation['6 mois']} capacites operationnelles`, margin + 10, currentY, usableWidth - 15, 9, 'normal', darkGray);
            currentY += 4;
            currentY = addText(`‚Ä¢ 12 mois: ${kpis.preparation['12 mois']} pret export`, margin + 10, currentY, usableWidth - 15, 9, 'normal', darkGray);
            currentY += 6;
            
            currentY = addText(`Objectifs Commerciaux:`, margin + 5, currentY, usableWidth - 10, 10, 'bold', darkGray);
            currentY += 4;
            currentY = addText(`‚Ä¢ Prospects: ${kpis.commercial['Prospects qualifi√©s']}/an`, margin + 10, currentY, usableWidth - 15, 9, 'normal', darkGray);
            currentY += 4;
            currentY = addText(`‚Ä¢ Premiers contrats: ${kpis.commercial['Premiers contrats']}`, margin + 10, currentY, usableWidth - 15, 9, 'normal', darkGray);
            currentY += 6;
            
            currentY = addText(`Objectifs Financiers:`, margin + 5, currentY, usableWidth - 10, 10, 'bold', darkGray);
            currentY += 4;
            currentY = addText(`‚Ä¢ CA export Annee 1: ${kpis.financial['CA export Y1']}`, margin + 10, currentY, usableWidth - 15, 9, 'normal', darkGray);
            currentY += 4;
            currentY = addText(`‚Ä¢ CA export Annee 3: ${kpis.financial['CA export Y3']}`, margin + 10, currentY, usableWidth - 15, 9, 'normal', darkGray);
            currentY += 10;

            // FACTEURS CL√âS DE SUCC√àS
            addSubSection('Facteurs cles de succes');
            
            const factors = [
                'Excellence qualite produits et respect strict standards cible',
                'Adaptation culturelle et linguistique de l\'approche commerciale',
                'Partenariats locaux strategiques (distributeurs, prescripteurs)',
                'Pricing competitif avec marges preservees',
                'Service client reactif et support technique',
                'Conformite reglementaire anticipee et maintenue',
                'Innovation continue et veille concurrentielle',
                'Flexibilite operationnelle et capacite d\'adaptation'
            ];
            
            factors.forEach((factor, index) => {
                currentY = addText(`${index + 1}. ${factor}`, margin + 5, currentY, usableWidth - 10, 9, 'normal', darkGray);
                currentY += 5;
            });
            
            currentY += 10;
        }

        // 7. SERVICES ACIEX RECOMMAND√âS
        function addAciexServices() {
            addSectionTitle('SERVICES ACIEX RECOMMANDES');

            const services = [
                'Formation et coaching export personnalise',
                'Accompagnement certification et mise aux normes',
                'Missions commerciales dans votre marche cible',
                'Appui technique specialise selon vos faiblesses',
                'Mise en relation avec partenaires locaux'
            ];
            
            services.forEach((service, index) => {
                currentY = addText(`‚Ä¢ ${service}`, margin + 5, currentY, usableWidth - 10, 10, 'normal', darkGray);
                currentY += 6;
            });
            
            currentY += 5;
            currentY = addText('Contact ACIEX pour un accompagnement personnalise adapte a vos besoins specifiques.', margin, currentY, usableWidth, 9, 'italic', textGray);
        }

// 7. ALERTE - D√âFAILLANCES CRITIQUES (exactement comme l'interface)
        function addCriticalDefaillancesAlert() {
            const criticalAnalysis = analyzeCriticalQuestions();
            const hasCriticalQuestions = criticalAnalysis.critical.length > 0 || criticalAnalysis.warning.length > 0;

            if (hasCriticalQuestions) {
                addSectionTitle('ALERTE - DEFAILLANCES CRITIQUES DETECTEES', redColor);
                
                currentY = addText('Malgre un score global satisfaisant, des faiblesses majeures ont ete identifiees sur des questions specifiques :', margin, currentY, usableWidth, 10, 'normal', [200, 44, 40]);
                currentY += 10;

                // D√âFAILLANCES CRITIQUES (Score 1/4)
                if (criticalAnalysis.critical.length > 0) {
                    pdf.setTextColor(...redColor);
                    pdf.setFontSize(10);
                    pdf.setFont('helvetica', 'bold');
                    currentY = addText('DEFAILLANCES CRITIQUES (Score 1/4) :', margin, currentY, usableWidth, 10, 'bold', redColor);
                    currentY += 6;
                    
                    criticalAnalysis.critical.forEach(item => {
                        checkPageBreak(8);
                        const statement = transformQuestionToStatement(item.question);
                        const dimName = item.dimension.replace(/^\d+\.\s*/, '');
                        currentY = addText(`‚Ä¢ ${dimName} : ${statement}`, margin + 5, currentY, usableWidth - 10, 9, 'normal', darkGray);
                        currentY += 6;
                    });
                    
                    currentY = addText('URGENCE ABSOLUE : Ces elements doivent etre corriges avant tout lancement export !', margin, currentY, usableWidth, 10, 'bold', redColor);
                    currentY += 10;
                }

                // FAIBLESSES IMPORTANTES (Score 2/4)
                if (criticalAnalysis.warning.length > 0) {
                    pdf.setTextColor(...orangeColor);
                    pdf.setFontSize(10);
                    pdf.setFont('helvetica', 'bold');
                    currentY = addText('FAIBLESSES IMPORTANTES (Score 2/4) :', margin, currentY, usableWidth, 10, 'bold', orangeColor);
                    currentY += 6;
                    
                    criticalAnalysis.warning.forEach(item => {
                        checkPageBreak(8);
                        const statement = transformQuestionToStatement(item.question);
                        const dimName = item.dimension.replace(/^\d+\.\s*/, '');
                        currentY = addText(`‚Ä¢ ${dimName} : ${statement}`, margin + 5, currentY, usableWidth - 10, 9, 'normal', darkGray);
                        currentY += 6;
                    });
                    
                    currentY = addText('PRIORITE HAUTE : Amelioration obligatoire avant export.', margin, currentY, usableWidth, 10, 'bold', orangeColor);
                    currentY += 15;
                }
            }
        }

        // 8. ACTIONS PRIORITAIRES SP√âCIFIQUES (exactement comme l'interface)
        function addActionsSpecifiques() {
            const specificRecommendations = generateSpecificRecommendations(currentData.scores, 'short');

            if (specificRecommendations.length > 0) {
                addSectionTitle('ACTIONS PRIORITAIRES SPECIFIQUES', orangeColor);
                
                currentY = addText('Base sur vos reponses detaillees, voici les ameliorations specifiques necessaires :', margin, currentY, usableWidth, 10, 'normal', darkGray);
                currentY += 10;

                specificRecommendations.forEach((rec, index) => {
                    checkPageBreak(15);
                    
                    const priorityColor = rec.priority === 'CRITIQUE' ? redColor : orangeColor;
                    
                    // Badge priorit√©
                    pdf.setFillColor(...priorityColor);
                    pdf.rect(margin, currentY, 20, 6, 'F');
                    pdf.setTextColor(255, 255, 255);
                    pdf.setFontSize(7);
                    pdf.setFont('helvetica', 'bold');
                    pdf.text(rec.priority, margin + 2, currentY + 4);
                    
                    // Dimension
                    pdf.setTextColor(...darkGray);
                    pdf.setFontSize(10);
                    pdf.setFont('helvetica', 'bold');
                    pdf.text(rec.dimension, margin + 25, currentY + 4);
                    currentY += 8;
                    
                    // Recommandation
                    currentY = addText(rec.text, margin + 5, currentY, usableWidth - 10, 9, 'normal', darkGray);
                    currentY += 8;
                });
                
                currentY += 10;
            }
        }

        // G√âN√âRATION DANS L'ORDRE EXACT

        // G√âN√âRATION DANS L'ORDRE EXACT
        addCoverPage();
        addCompanyInformation();
        addGlobalResults();
        addDimensionScores();
        addSpecificRecommendations();
        addStrategicPlan();
        addDetailedStrategicPlan();
        addCriticalDefaillancesAlert();  // NOUVEAU
        addActionsSpecifiques();         // NOUVEAU

        const fileName = `Diagnostic_Export_${currentData.company.companyName?.replace(/[^a-zA-Z0-9]/g, '_') || 'Entreprise'}_${new Date().toISOString().split('T')[0]}.pdf`;
        pdf.save(fileName);
        
        showAlert('Rapport PDF epure genere avec toutes les informations entreprise !', 'success');

    } catch (error) {
        console.error('Erreur generation PDF:', error);
        showAlert('Erreur lors de la generation du PDF. Veuillez reessayer.', 'error');
    } finally {
        if (exportButton) {
            exportButton.innerHTML = originalText || 'Telecharger Rapport PDF';
            exportButton.disabled = false;
        }
    }
}

// =================================
// =================================
// GOOGLE SHEETS EXPORT FUNCTIONS - API REST
// =================================

let isGoogleSheetsReady = true; // Toujours pr√™t avec l'API REST

// Fonction d'initialisation simplifi√©e
function initGoogleAPI() {
    console.log('üîß Initialisation Google Sheets (API REST)...');
    
    // V√©rifier la configuration
    if (GOOGLE_SHEETS_CONFIG.apiKey === 'TON_API_KEY_ICI' || 
        GOOGLE_SHEETS_CONFIG.spreadsheetId === 'TON_SPREADSHEET_ID_ICI') {
        console.log('‚ö†Ô∏è Configuration non compl√©t√©e');
        return;
    }
    
    console.log('‚úÖ Google Sheets API REST pr√™t !');
    isGoogleSheetsReady = true;
    showGoogleSheetsButton();
}

// Afficher le bouton Google Sheets
function showGoogleSheetsButton() {
    console.log('üîç Recherche du bouton Google Sheets...');
    const buttons = document.querySelectorAll('.google-sheets-btn');
    console.log('üîç Boutons trouv√©s:', buttons.length);
    
    buttons.forEach((btn, index) => {
        console.log(`üîç Bouton ${index}:`, btn);
        btn.style.display = 'inline-block';
        btn.disabled = false;
        console.log('‚úÖ Bouton affich√©');
    });
    
    if (buttons.length === 0) {
        console.log('‚ùå Aucun bouton avec la classe google-sheets-btn trouv√© !');
    }
}

// Exporter vers Google Sheets via Apps Script (m√©thode alternative)
async function exportToGoogleSheets() {
    if (!currentData.results) {
        showAlert('Aucun r√©sultat √† exporter. Veuillez d\'abord compl√©ter l\'√©valuation.', 'warning');
        return;
    }

    const exportButton = event?.target;
    const originalText = exportButton?.innerHTML;
    if (exportButton) {
        exportButton.innerHTML = '‚è≥ Export en cours...';
        exportButton.disabled = true;
    }

    try {
        console.log('üìä D√©but export Google Sheets (Apps Script)...');
        
        // Pr√©parer les donn√©es d'export
        const exportData = prepareExportData();
        
        // Pr√©parer les donn√©es pour Apps Script
        const sheetData = prepareSheetData(exportData);
        
        // Cr√©er un formulaire invisible pour envoyer les donn√©es
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = APPS_SCRIPT_URL;
        form.target = '_blank';
        form.style.display = 'none';
        
        const input = document.createElement('textarea');
        input.name = 'data';
        input.value = JSON.stringify(sheetData);
        form.appendChild(input);
        
        document.body.appendChild(form);
        form.submit();
        document.body.removeChild(form);
        
        console.log('‚úÖ Export lanc√© vers Google Apps Script');
        showAlert('‚úÖ Export lanc√© ! V√©rifiez votre Google Sheet dans quelques secondes.', 'success');
        
    } catch (error) {
        console.error('‚ùå Erreur export Google Sheets:', error);
        showAlert(`‚ùå Erreur lors de l'export: ${error.message}`, 'error');
    } finally {
        if (exportButton) {
            exportButton.innerHTML = originalText || 'üìä Exporter vers Google Sheets';
            exportButton.disabled = false;
        }
    }
}

// Pr√©parer les donn√©es pour l'export (identique √† avant)
function prepareExportData() {
    const company = currentData.company;
    const results = currentData.results;
    
    const questionResponses = [];
    dimensions.forEach((dimension, dimIndex) => {
        dimension.questions.forEach((question, qIndex) => {
            const questionId = `${dimIndex}-${qIndex}`;
            const score = currentData.scores[questionId] || 0;
            questionResponses.push({
                dimension: dimension.title,
                question: question,
                score: score,
                scoreText: getScoreText(score)
            });
        });
    });

    return {
        companyName: company.companyName || 'Entreprise_Inconnue',
        sector: company.sector || 'Non sp√©cifi√©',
        employees: company.employees || 'Non sp√©cifi√©',
        revenue: company.revenue || 'Non sp√©cifi√©',
        country: company.country || 'Non sp√©cifi√©',
        email: company.email || 'Non sp√©cifi√©',
	interviewer: company.interviewer || 'Non sp√©cifi√©',
leaderGender: company.leaderGender || 'Non sp√©cifi√©',
leaderAge: company.leaderAge || 'Non sp√©cifi√©',
        currentMarkets: (company.currentMarkets || []).join(', ') || 'Non sp√©cifi√©s',
        targetMarket: company.targetMarket || 'Non sp√©cifi√©',
        globalScore: results.globalScore,
        adjustedScore: results.adjustedScore,
        level: results.level,
        standardDeviation: results.standardDeviation,
        calculationDate: results.calculationDate,
        dimensionScores: results.dimensionScores,
        questionResponses: questionResponses,
        recommendations: generateRecommendationsText(results, company),
        exportDate: new Date().toLocaleDateString('fr-FR'),
        exportTime: new Date().toLocaleTimeString('fr-FR')
    };
}

// Pr√©parer les donn√©es pour Google Apps Script
function prepareSheetData(data) {
    const cleanName = data.companyName
        .replace(/[^a-zA-Z0-9\s\-_]/g, '')
        .substring(0, 100)
        .trim();
    
    const timestamp = new Date().toISOString().slice(0, 10);
    const sheetName = `${cleanName}_${timestamp}`;
    
    const values = [];
    
    // En-t√™te principal
    values.push(['=== DIAGNOSTIC EXPORT ACIEX ===']);
    values.push(['']);
    
    // Informations entreprise
    values.push(['INFORMATIONS ENTREPRISE']);
    values.push(['Nom entreprise', data.companyName]);
    values.push(['Secteur', data.sector]);
    values.push(['Employ√©s', data.employees]);
    values.push(['CA annuel', data.revenue]);
    values.push(['Pays si√®ge', data.country]);
    values.push(['Email', data.email]);
    values.push(['Dossier suivi par', data.interviewer]);
    values.push(['March√©s actuels', data.currentMarkets]);
    values.push(['March√© cible', data.targetMarket]);
values.push(['Sexe dirigeant', data.leaderGender]);
values.push(['√Çge dirigeant', data.leaderAge]);
    values.push(['']);
    
    // R√©sultats globaux
    values.push(['R√âSULTATS GLOBAUX']);
    values.push(['Score global', data.globalScore + '%']);
    values.push(['Score ajust√©', data.adjustedScore + '%']);
    values.push(['Niveau', data.level]);
    values.push(['√âcart-type', data.standardDeviation]);
    values.push(['Date calcul', data.calculationDate]);
    values.push(['']);
    
    // Scores par dimension
    values.push(['SCORES PAR DIMENSION']);
    values.push(['Dimension', 'Score (%)', 'Poids', 'Score brut', 'Score max']);
    data.dimensionScores.forEach(dim => {
        values.push([
            dim.name.replace(/^\d+\.\s*/, ''),
            dim.percentage,
            dim.weight,
            dim.rawScore,
            dim.maxScore
        ]);
    });
    values.push(['']);
    
    // R√©ponses d√©taill√©es aux questions
    values.push(['R√âPONSES D√âTAILL√âES (50 QUESTIONS)']);
    values.push(['Dimension', 'Question', 'Score (1-4)', 'R√©ponse']);
    data.questionResponses.forEach(response => {
        values.push([
            response.dimension.replace(/^\d+\.\s*/, ''),
            response.question,
            response.score,
            response.scoreText
        ]);
    });
    values.push(['']);
    
    // Recommandations
    values.push(['RECOMMANDATIONS']);
    const recommendationsLines = data.recommendations.split('\n');
    recommendationsLines.forEach(line => {
        if (line.trim()) {
            values.push([line.trim()]);
        }
    });
    values.push(['']);
    
    // M√©tadonn√©es export
    values.push(['M√âTADONN√âES EXPORT']);
    values.push(['Date export', data.exportDate]);
    values.push(['Heure export', data.exportTime]);
    values.push(['Outil', 'ACIEX Diagnostic Export v3.1']);
    
    return {
        sheetName: sheetName,
        values: values
    };
}

// Convertir score num√©rique en texte (pour export)
function getScoreText(score) {
    switch(score) {
        case 1: return 'Niveau 1 (Faible)';
        case 2: return 'Niveau 2 (Moyen)';
        case 3: return 'Niveau 3 (Bon)';
        case 4: return 'Niveau 4 (Excellent)';
        default: return 'Non r√©pondu';
    }
}

// G√©n√©rer le texte des recommandations
function generateRecommendationsText(results, company) {
    const weakDimensions = results.dimensionScores.filter(d => d.percentage < 50);
    const score = results.adjustedScore;
    
    let recommendations = `RECOMMANDATIONS POUR ${company.companyName}\n\n`;
    recommendations += `Score global: ${score}% (${results.level})\n\n`;
    
    if (score >= 80) {
        recommendations += "EXCELLENT NIVEAU - Lancement export imm√©diat recommand√©\n";
        recommendations += "Actions: Documentation finale, prospection active, premiers contrats\n";
        recommendations += "D√©lai: 0-3 mois\nBudget: 1-3M FCFA\n\n";
    } else if (score >= 65) {
        recommendations += "BON POTENTIEL - Ajustements n√©cessaires avant export\n";
        recommendations += "Actions: Corrections prioritaires, pr√©paration finale\n";
        recommendations += "D√©lai: 3-6 mois\nBudget: 3-8M FCFA\n\n";
    } else if (score >= 45) {
        recommendations += "D√âVELOPPEMENT STRUCTUR√â REQUIS\n";
        recommendations += "Actions: Renforcement capacit√©s, certifications, adaptation offre\n";
        recommendations += "D√©lai: 6-12 mois\nBudget: 5-15M FCFA\n\n";
    } else {
        recommendations += "CONSOLIDATION FONDAMENTAUX URGENTE\n";
        recommendations += "Actions: Audit organisation, formation management, investissements\n";
        recommendations += "D√©lai: 12-24 mois\nBudget: 10-30M FCFA\n\n";
    }
    
    if (weakDimensions.length > 0) {
        recommendations += "DIMENSIONS √Ä RENFORCER EN PRIORIT√â:\n";
        weakDimensions.slice(0, 3).forEach(dim => {
            recommendations += `- ${dim.name.replace(/^\d+\.\s*/, '')} (${dim.percentage}%)\n`;
        });
        recommendations += "\n";
    }
    
    recommendations += "CONTACT: ACIEX pour accompagnement personnalis√©\n";
    recommendations += `March√© cible: ${company.targetMarket}\nSecteur: ${company.sector}`;
    
    return recommendations;
}

// =================================
// FIN GOOGLE SHEETS FUNCTIONS
// =================================

// IA pour identifier les importateurs potentiels
class ImportersAI {
    constructor() {
        this.hfToken = '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'; // Utilisez votre token
        this.apiUrl = 'https://api-inference.huggingface.co/models/microsoft/DialoGPT-large';
        this.isProcessing = false;
    }

    // G√©n√©rer automatiquement la liste d'importateurs
    async generateImportersList(company, targetCountries) {
        if (this.isProcessing) return null;
        
        this.isProcessing = true;
        console.log('üîç Recherche d\'importateurs pour:', company.sector, 'dans:', targetCountries);

        try {
            // Construire le prompt automatiquement
            const prompt = this.buildImportersPrompt(company.sector, targetCountries);
            console.log('üìù Prompt g√©n√©r√©:', prompt);

            // Appeler l'IA
            const response = await this.callAIForImporters(prompt);
            
            // Parser la r√©ponse pour extraire les entreprises
            const importersList = this.parseImportersResponse(response, company.sector, targetCountries);
            
            return importersList;
            
        } catch (error) {
            console.error('‚ùå Erreur IA Importateurs:', error);
            return this.getFallbackImporters(company.sector, targetCountries);
        } finally {
            this.isProcessing = false;
        }
    }

    // Construire le prompt automatiquement
    buildImportersPrompt(sector, targetCountries) {
        const sectorMapping = {
            'Agro-alimentaire': 'produits alimentaires, cacao, caf√©, fruits tropicaux, huiles v√©g√©tales',
            'Technologie': '√©quipements informatiques, logiciels, solutions digitales',
            'Textile': 'v√™tements, tissus, coton, produits textiles',
            'Pharmaceutique': 'm√©dicaments, produits pharmaceutiques, dispositifs m√©dicaux',
            'Artisanat': 'objets d\'art, artisanat traditionnel, bijoux, d√©coration',
            'Autre': 'produits manufactur√©s'
        };

        const products = sectorMapping[sector] || `produits du secteur ${sector}`;
        const countries = targetCountries.slice(0, 3).join(', '); // Limiter √† 3 pays pour √©viter un prompt trop long

        return `Liste des principales entreprises importatrices de ${products} dans les pays suivants: ${countries}. 
        
Format de r√©ponse souhait√©:
PAYS: [Nom du pays]
- Entreprise: [Nom] | Contact: [Email/T√©l√©phone] | Secteur: [Domaine] | Taille: [PME/Grande entreprise]
- Entreprise: [Nom] | Contact: [Email/T√©l√©phone] | Secteur: [Domaine] | Taille: [PME/Grande entreprise]

Donne 3-5 entreprises par pays avec leurs vrais contacts si possible.`;
    }

    // Appeler l'API IA
    async callAIForImporters(prompt) {
        const response = await fetch(this.apiUrl, {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${this.hfToken}`,
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                inputs: prompt,
                parameters: {
                    max_length: 500,
                    temperature: 0.7,
                    do_sample: true,
                    top_p: 0.9
                },
                options: {
                    wait_for_model: true
                }
            })
        });

        if (!response.ok) {
            throw new Error(`API Error: ${response.status}`);
        }

        const result = await response.json();
        return this.extractAIResponse(result);
    }

    // Extraire la r√©ponse de l'IA
    extractAIResponse(apiResult) {
        if (Array.isArray(apiResult) && apiResult[0]?.generated_text) {
            return apiResult[0].generated_text;
        }
        return apiResult?.generated_text || "Aucune r√©ponse g√©n√©r√©e";
    }

    // Parser la r√©ponse pour extraire les entreprises
    parseImportersResponse(response, sector, targetCountries) {
        console.log('üìä Parsing r√©ponse IA:', response);

        const importers = {
            sector: sector,
            countries: targetCountries,
            companies: [],
            generatedAt: new Date().toLocaleDateString('fr-FR'),
            disclaimer: "Les informations ci-dessous sont g√©n√©r√©es par IA et doivent √™tre v√©rifi√©es. ACIEX peut vous aider √† valider ces contacts."
        };

        try {
            // Parsing simple de la r√©ponse
            const lines = response.split('\n').filter(line => line.trim());
            let currentCountry = '';
            
            lines.forEach(line => {
                // D√©tecter les pays
                if (line.includes('PAYS:') || line.includes('pays:')) {
                    currentCountry = line.replace(/PAYS:\s*/i, '').trim();
                }
                // D√©tecter les entreprises
                else if (line.includes('Entreprise:') || line.includes('-')) {
                    const company = this.parseCompanyLine(line, currentCountry);
                    if (company) {
                        importers.companies.push(company);
                    }
                }
            });

            // Si pas de r√©sultats pars√©s, g√©n√©rer des exemples
            if (importers.companies.length === 0) {
                importers.companies = this.generateExampleImporters(sector, targetCountries.slice(0, 2));
            }

        } catch (error) {
            console.error('‚ùå Erreur parsing:', error);
            importers.companies = this.generateExampleImporters(sector, targetCountries.slice(0, 2));
        }

        return importers;
    }

    // Parser une ligne d'entreprise
    parseCompanyLine(line, country) {
        try {
            // Format attendu: - Entreprise: [Nom] | Contact: [Email/T√©l√©phone] | Secteur: [Domaine] | Taille: [PME/Grande entreprise]
            const cleanLine = line.replace(/^-\s*/, '').trim();
            const parts = cleanLine.split('|').map(p => p.trim());
            
            let name = '', contact = '', businessSector = '', size = '';
            
            parts.forEach(part => {
                if (part.startsWith('Entreprise:')) {
                    name = part.replace('Entreprise:', '').trim();
                } else if (part.startsWith('Contact:')) {
                    contact = part.replace('Contact:', '').trim();
                } else if (part.startsWith('Secteur:')) {
                    businessSector = part.replace('Secteur:', '').trim();
                } else if (part.startsWith('Taille:')) {
                    size = part.replace('Taille:', '').trim();
                }
            });

            if (name) {
                return {
                    name: name,
                    country: country || 'Non sp√©cifi√©',
                    contact: contact || 'Contact √† rechercher',
                    sector: businessSector || 'Import/Export',
                    size: size || 'Non sp√©cifi√©',
                    source: 'IA Generated'
                };
            }
        } catch (error) {
            console.error('‚ùå Erreur parsing ligne:', error);
        }
        return null;
    }

    // G√©n√©rer des exemples d'importateurs si l'IA √©choue
    generateExampleImporters(sector, countries) {
        const examples = {
            'Agro-alimentaire': [
                { name: 'Global Food Importers', sector: 'Distribution alimentaire', size: 'Grande entreprise' },
                { name: 'African Food Partners', sector: 'Import agro-alimentaire', size: 'PME' },
                { name: 'Continental Trading Co', sector: 'N√©goce international', size: 'Grande entreprise' }
            ],
            'Technologie': [
                { name: 'Tech Solutions Africa', sector: 'Distribution IT', size: 'PME' },
                { name: 'Digital Import Partners', sector: '√âquipements informatiques', size: 'Grande entreprise' },
                { name: 'Innovation Hub Ltd', sector: 'Solutions digitales', size: 'PME' }
            ],
            'Textile': [
                { name: 'Fashion Import Group', sector: 'Import textile', size: 'Grande entreprise' },
                { name: 'African Textiles Co', sector: 'Distribution mode', size: 'PME' },
                { name: 'Continental Fashion', sector: 'V√™tements import', size: 'Grande entreprise' }
            ]
        };

        const sectorExamples = examples[sector] || examples['Agro-alimentaire'];
        const companies = [];

        countries.forEach(country => {
            sectorExamples.forEach((example, index) => {
                companies.push({
                    name: `${example.name} ${country}`,
                    country: country,
                    contact: 'contact@rechercher-via-aciex.ci',
                    sector: example.sector,
                    size: example.size,
                    source: 'Exemple g√©n√©r√©'
                });
            });
        });

        return companies.slice(0, 8); // Limiter √† 8 entreprises
    }

    // Solution de fallback en cas d'erreur
    getFallbackImporters(sector, countries) {
        return {
            sector: sector,
            countries: countries,
            companies: this.generateExampleImporters(sector, countries.slice(0, 2)),
            generatedAt: new Date().toLocaleDateString('fr-FR'),
            disclaimer: "Service IA temporairement indisponible. Exemples d'importateurs fournis. Contactez ACIEX pour une recherche personnalis√©e."
        };
    }
}

// Instance globale
const importersAI = new ImportersAI();

// Fonctions de contr√¥le de l'assistant
function toggleAI() {
    const assistant = document.getElementById('aiAssistant');
    const fab = document.getElementById('aiFab');
    
    exportAI.isOpen = !exportAI.isOpen;
    
    if (exportAI.isOpen) {
        assistant.classList.add('open');
        fab.classList.add('hidden');
        
        // Mettre √† jour le contexte avec les donn√©es actuelles
        exportAI.updateContext(currentData);
        
        // Focus sur l'input
        setTimeout(() => {
            document.getElementById('aiInput').focus();
        }, 300);
    } else {
        assistant.classList.remove('open');
        fab.classList.remove('hidden');
    }
}

function sendMessage() {
    const input = document.getElementById('aiInput');
    const message = input.value.trim();
    
    if (!message) return;
    
    addMessageToChat('user', message);
    input.value = '';
    
    // Simulation typing
    showTyping();
    
    setTimeout(() => {
        hideTyping();
        const response = exportAI.analyzeQuery(message);
        addMessageToChat('assistant', response);
    }, 1500 + Math.random() * 1000);
}

function askAI(question) {
    document.getElementById('aiInput').value = question;
    sendMessage();
}

function addMessageToChat(sender, message) {
    const chat = document.getElementById('aiChat');
    const messageDiv = document.createElement('div');
    messageDiv.className = `ai-message ${sender}`;
    
    if (sender === 'assistant') {
        // Conversion markdown simple
        const formattedMessage = message
            .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
            .replace(/\n/g, '<br>');
        messageDiv.innerHTML = formattedMessage;
    } else {
        messageDiv.textContent = message;
    }
    
    chat.appendChild(messageDiv);
    chat.scrollTop = chat.scrollHeight;
}

function showTyping() {
    const chat = document.getElementById('aiChat');
    const typingDiv = document.createElement('div');
    typingDiv.id = 'typingIndicator';
    typingDiv.className = 'ai-typing';
    typingDiv.innerHTML = '<div class="ai-typing-dot"></div><div class="ai-typing-dot"></div><div class="ai-typing-dot"></div>';
    
    chat.appendChild(typingDiv);
    chat.scrollTop = chat.scrollHeight;
}

function hideTyping() {
    const typing = document.getElementById('typingIndicator');
    if (typing) typing.remove();
}

// R√©initialiser compl√®tement l'assistant IA
function resetAIAssistant() {
    // R√©initialiser l'instance IA
    exportAI.conversationHistory = [];
    exportAI.context = null;
    
    // Fermer l'assistant s'il est ouvert
    if (exportAI.isOpen) {
        toggleAI();
    }
    
    // Vider le chat et remettre le message d'accueil
    const chat = document.getElementById('aiChat');
    chat.innerHTML = `
        <div class="ai-message assistant">
            <strong>üëã Bonjour !</strong><br>
            Je suis votre assistant export personnalis√©. Je connais votre diagnostic et peux vous aider avec :
            <div class="ai-suggestions">
                <span class="ai-suggestion" onclick="askAI('Pourquoi mon score est-il faible ?')">Expliquer mon score</span>
                <span class="ai-suggestion" onclick="askAI('Que faire en priorit√© ?')">Actions prioritaires</span>
                <span class="ai-suggestion" onclick="askAI('Quel budget pr√©voir ?')">Budget n√©cessaire</span>
            </div>
        </div>
    `;
    
    // R√©initialiser l'input
    document.getElementById('aiInput').value = '';
    
    // R√©activer le bouton d'envoi
    document.getElementById('aiSendBtn').disabled = false;
    
    console.log('Assistant IA r√©initialis√©');
}
        // R√©initialisation du diagnostic (historique pr√©serv√©)
        function resetApplication() {
            const confirmation = confirm(
                "üîÑ NOUVEAU DIAGNOSTIC\n\n" +
                "Cette action va effacer :\n" +
                "‚Ä¢ Toutes les informations entreprise actuelles\n" +
                "‚Ä¢ Toutes les r√©ponses aux questions\n" +
                "‚Ä¢ Tous les r√©sultats calcul√©s\n" +
                "‚Ä¢ Le diagnostic d√©taill√© en cours\n\n" +
                "‚úÖ VOTRE HISTORIQUE SERA PR√âSERV√â\n\n" +
                "Voulez-vous commencer un nouveau diagnostic ?"
            );
            
            if (confirmation) {
                console.log('üîÑ D√©marrage nouveau diagnostic...');
                
                // Sauvegarder l'historique avant r√©initialisation
                const savedHistory = localStorage.getItem('exportToolHistory');
                
                // Supprimer seulement les donn√©es du diagnostic actuel
                localStorage.removeItem('exportToolData');
                
                // R√©initialiser les variables globales
                currentData = {
                    company: {},
                    scores: {},
                    results: null
                };
                
                // Vider le formulaire entreprise
                const companyForm = document.getElementById('companyForm');
                if (companyForm) {
                    companyForm.reset();
                }
                
                // R√©initialiser les s√©lections de pays
                document.querySelectorAll('.multi-select-dropdown input[type="checkbox"]').forEach(checkbox => {
                    checkbox.checked = false;
                });
                
                // R√©initialiser l'affichage des pays s√©lectionn√©s
                const currentMarketsDisplay = document.getElementById('currentMarketsDisplay');
                if (currentMarketsDisplay) {
                    currentMarketsDisplay.innerHTML = '<span style="color: #999;">S√©lectionnez vos march√©s actuels</span>';
                }
                
                // R√©initialiser le select du march√© cible
                const targetMarketSelect = document.getElementById('targetMarket');
                if (targetMarketSelect) {
                    targetMarketSelect.value = '';
                }
                
                // Remettre √† z√©ro tous les boutons de score des questions
                document.querySelectorAll('.score-btn').forEach(btn => {
                    btn.classList.remove('selected');
                });
                
                // R√©initialiser la barre de progression
                const progressFill = document.getElementById('progressFill');
                const progressText = document.getElementById('progressText');
                if (progressFill) progressFill.style.width = '0%';
                if (progressText) progressText.textContent = '0/50 questions compl√©t√©es';
                
                // Vider les r√©sultats
                const resultsContainer = document.getElementById('resultsContainer');
                if (resultsContainer) {
                    resultsContainer.innerHTML = `
                        <div class="alert alert-warning">
                            <strong>Aucun r√©sultat disponible.</strong><br>
                            Veuillez d'abord compl√©ter l'√©valuation dans l'onglet "√âvaluation".
                        </div>
                    `;
                }
                
                // Vider le diagnostic d√©taill√©
                const detailedContainer = document.getElementById('detailedContainer');
                if (detailedContainer) {
                    detailedContainer.innerHTML = `
                        <div class="alert alert-warning">
                            <strong>Aucun diagnostic d√©taill√© disponible.</strong><br>
                            Veuillez d'abord compl√©ter l'√©valuation et calculer les r√©sultats.
                        </div>
                    `;
                }
                
                // PR√âSERVER L'HISTORIQUE - le recharger tel quel
                if (savedHistory) {
                    localStorage.setItem('exportToolHistory', savedHistory);
                    console.log('üìö Historique pr√©serv√©');
                } else {
                    console.log('üìö Aucun historique √† pr√©server');
                }
                
                // Recharger l'affichage de l'historique
                loadHistory();
                
                // Retourner √† la premi√®re section (Informations Entreprise)
                showSection('company');
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.classList.remove('active', 'loading');
                });
                
                // Activer l'onglet "Informations Entreprise"
                const companyTab = document.querySelector('[onclick="showSection(\'company\')"]');
                if (companyTab) {
                    companyTab.classList.add('active');
                }
                
                // R√©initialiser les onglets sp√©ciaux
                const resultsTab = document.getElementById('resultsTab');
                const detailedTab = document.getElementById('detailedTab');
                if (resultsTab) {
                    resultsTab.classList.remove('loading');
                    resultsTab.innerHTML = 'üìä R√©sultats & Analyse';
                }
                if (detailedTab) {
                    detailedTab.classList.remove('loading');
                    detailedTab.innerHTML = 'üîç Diagnostic D√©taill√©';
                }
                
                // Cacher le conteneur de chargement s'il est affich√©
                const loadingContainer = document.getElementById('loadingContainer');
                if (loadingContainer) {
                    loadingContainer.classList.remove('active');
                }
                              
                // Focus sur le premier champ du formulaire
                setTimeout(() => {
                    const firstInput = document.getElementById('companyName');
                    if (firstInput) {
                        firstInput.focus();
                    }
                }, 100);
                
                // Message de confirmation
                showAlert('‚úÖ Nouveau diagnostic d√©marr√© !<br>üìö Votre historique a √©t√© pr√©serv√©.', 'success');
                
                // Scroll vers le haut
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
                
                console.log('üéâ Nouveau diagnostic pr√™t !');
            }
        }

        // Initialisation au chargement de la page
        document.addEventListener('DOMContentLoaded', function() {
            // Attacher l'event listener au formulaire d'authentification
            const authForm = document.getElementById('authForm');
            if (authForm) {
                authForm.addEventListener('submit', authenticate);
                console.log('üìã Event listener authentification attach√©');
            }
            
            // V√©rifier si d√©j√† authentifi√©
            if (sessionStorage.getItem('authenticated') === 'true') {
                document.getElementById('authContainer').style.display = 'none';
            }
            
            // Initialisation normale
            initializeMultiSelects();
            loadFromStorage();
            
            // Initialiser Google Sheets API
            setTimeout(() => {
                initGoogleAPI();
            }, 2000); // Attendre 2 secondes que tout soit charg√©
            
            console.log('Outil de Diagnostic Export loaded successfully!');
        });
// Authentification
function authenticate(event) {
    event.preventDefault();
    console.log('üîë Tentative d\'authentification...');
    
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    const errorDiv = document.getElementById('authError');
    const loadingDiv = document.getElementById('authLoading');
    
    console.log(`Username: "${username}", Password length: ${password.length}`);
    
    // V√©rification des identifiants (insensible √† la casse pour username)
    if (username.toLowerCase() === 'aciex' && password === 'EXPORTATIONS@2025') {
        console.log('‚úÖ Identifiants corrects !');
        
        // Cacher le formulaire et afficher le chargement
        document.querySelector('.auth-form').style.display = 'none';
        loadingDiv.classList.add('show');
        
        // Animation de la barre de chargement
        let progress = 0;
        const progressBar = document.getElementById('authProgressBar');
        const percentageDisplay = document.getElementById('authPercentage');
        
        const interval = setInterval(() => {
            progress += 2;
            progressBar.style.width = progress + '%';
            percentageDisplay.textContent = progress + '%';
            
            if (progress >= 100) {
                clearInterval(interval);
                setTimeout(() => {
                    document.getElementById('authContainer').style.display = 'none';
                    sessionStorage.setItem('authenticated', 'true');
                    console.log('üéâ Acc√®s accord√© !');
                }, 200);
            }
        }, 100);
        
    } else {
        console.log('‚ùå Identifiants incorrects');
        errorDiv.textContent = '‚ùå Nom d\'utilisateur ou mot de passe incorrect';
        errorDiv.style.display = 'block';
        
        // Effacer les champs
        document.getElementById('username').value = '';
        document.getElementById('password').value = '';
    }
}
        
// Initialisation au chargement de la page
document.addEventListener('DOMContentLoaded', function() {
    // Attacher l'event listener au formulaire d'authentification
    const authForm = document.getElementById('authForm');
    if (authForm) {
        authForm.addEventListener('submit', authenticate);
        console.log('üìã Event listener authentification attach√©');
    }
    
    // V√©rifier si d√©j√† authentifi√©
    if (sessionStorage.getItem('authenticated') === 'true') {
        document.getElementById('authContainer').style.display = 'none';
    }
    
    // Initialisation normale
    initializeMultiSelects();
    loadFromStorage();
    
    // Initialiser Google Sheets API
    setTimeout(() => {
        initGoogleAPI();
    }, 2000); // Attendre 2 secondes que tout soit charg√©
    
    console.log('Outil de Diagnostic Export loaded successfully!');
});

// Fonctions pour l'aide
function showHelpMenu() {
    document.getElementById('helpModal').style.display = 'block';
}

function closeHelpMenu() {
    document.getElementById('helpModal').style.display = 'none';
}

function openHelpSection(section) {
    // Fermer le menu principal
    closeHelpMenu();
    
    // Afficher le contenu directement
    let content = '';
    let title = '';
    
    switch(section) {
        case 'prise-en-main':
            title = 'üöÄ Prise en main';
            content = `
                <h2>üîê Acc√®s √† l'outil</h2>
                <div style="background: #e3f2fd; border-left: 5px solid #1a73e8; padding: 20px; margin: 20px 0; border-radius: 8px;">
                    <strong>Identifiants requis :</strong><br>
                    ‚Ä¢ Nom d'utilisateur : <code>aciex</code><br>
                    ‚Ä¢ Mot de passe : <code>EXPORTATIONS@2025</code>
                </div>
                
                <h2>üìã Processus d'√©valuation en 3 √©tapes</h2>
                
                <h3>√âtape 1 : üè¢ Informations Entreprise</h3>
                <h4>Champs obligatoires :</h4>
                <ul>
                    <li><strong>Nom de l'entreprise</strong> : D√©nomination sociale compl√®te</li>
                    <li><strong>Secteur d'activit√©</strong> : 21 secteurs disponibles</li>
                    <li><strong>Dossier suivi par</strong> : Agent ACIEX r√©f√©rent</li>
                    <li><strong>March√©s actuels</strong> : S√©lection multiple</li>
                    <li><strong>March√© cible</strong> : Un seul pays pour l'analyse</li>
                </ul>
                
                <h3>√âtape 2 : üìã √âvaluation (50 Questions)</h3>
                <p><strong>10 dimensions strat√©giques</strong> avec 5 questions chacune</p>
                <h4>Notation de 1 √† 4 :</h4>
                <ul>
                    <li>1 = "Pas du tout"</li>
                    <li>2 = "Peu"</li>
                    <li>3 = "Moyennement"</li>
                    <li>4 = "Enti√®rement"</li>
                </ul>
                
                <h3>√âtape 3 : üìä Calcul des r√©sultats</h3>
                <p>Le syst√®me calcule automatiquement :</p>
                <ul>
                    <li>Score global pond√©r√©</li>
                    <li>Ajustement sectoriel</li>
                    <li>Niveau de pr√©paration</li>
                    <li>Analyse d√©taill√©e</li>
                </ul>
            `;
            break;
            
        case 'lecture-resultats':
            title = 'üìä Lecture des r√©sultats';
            content = `
                <h2>üìà Onglet "R√©sultats & Analyse"</h2>
                
                <h3>üéØ Score global affich√©</h3>
                <p><strong>Score brut</strong> : Moyenne pond√©r√©e de vos r√©ponses aux 50 questions</p>
                <p><strong>Score ajust√©</strong> : Score corrig√© selon les avantages sectoriels de la C√¥te d'Ivoire</p>
                
                <h3>üìä √âchelle d'√©valuation</h3>
                <div style="background: #e8f5e8; border-left: 5px solid #34a853; padding: 15px; margin: 10px 0; border-radius: 8px;">
                    <strong>80-100% : EXCELLENT</strong><br>
                    Pr√™t pour export imm√©diat (0-3 mois)
                </div>
                <div style="background: #e3f2fd; border-left: 5px solid #1a73e8; padding: 15px; margin: 10px 0; border-radius: 8px;">
                    <strong>65-79% : BON POTENTIEL</strong><br>
                    Ajustements n√©cessaires (3-6 mois)
                </div>
                <div style="background: #fff3e0; border-left: 5px solid #ff9900; padding: 15px; margin: 10px 0; border-radius: 8px;">
                    <strong>45-64% : POTENTIEL MOYEN</strong><br>
                    D√©veloppement requis (6-12 mois)
                </div>
                <div style="background: #ffebee; border-left: 5px solid #ea4335; padding: 15px; margin: 10px 0; border-radius: 8px;">
                    <strong>0-44% : D√âVELOPPEMENT N√âCESSAIRE</strong><br>
                    Consolidation urgente (12-24 mois)
                </div>
                
                <h2>üîç Onglet "Diagnostic D√©taill√©"</h2>
                <p>Analyse approfondie comprenant :</p>
                <ul>
                    <li><strong>Diagnostic sp√©cifique entreprise</strong> - Niveau de pr√©paration avec d√©lais</li>
                    <li><strong>Plan strat√©gique d√©taill√©</strong> - Feuille de route et budget</li>
                    <li><strong>Analyse du march√© cible</strong> - Profil √©conomique et strat√©gie</li>
                    <li><strong>Services ACIEX recommand√©s</strong> - Accompagnement personnalis√©</li>
                </ul>
            `;
            break;
            
        case 'enregistrement':
            title = 'üíæ Enregistrement & Export';
            content = `
                <h2>üíæ Sauvegarde automatique</h2>
                <div style="background: #e8f5e8; border-left: 5px solid #34a853; padding: 20px; margin: 20px 0; border-radius: 8px;">
                    <strong>‚úÖ Aucune action requise !</strong><br>
                    ‚Ä¢ Vos donn√©es sont automatiquement sauvegard√©es dans votre navigateur<br>
                    ‚Ä¢ En cas de fermeture accidentelle, vos informations sont pr√©serv√©es<br>
                    ‚Ä¢ L'historique des 10 derni√®res √©valuations est conserv√©
                </div>
                
                <h2>üìÑ Export PDF</h2>
                <p><strong>üì• Rapport Complet PDF</strong> - Analyse compl√®te avec toutes les sections</p>
                <p><strong>üìã R√©sum√© Ex√©cutif PDF</strong> - Synth√®se pour pr√©sentation direction</p>
                
                <h2>üìä Export Google Sheets</h2>
                <p><strong>Pr√©requis :</strong> Fonctionnalit√© disponible si configur√©e par l'administrateur ACIEX</p>
                <p><strong>Donn√©es export√©es :</strong></p>
                <ul>
                    <li>Informations entreprise compl√®tes</li>
                    <li>R√©ponses d√©taill√©es aux 50 questions</li>
                    <li>Scores par dimension</li>
                    <li>Recommandations textuelles</li>
                    <li>M√©tadonn√©es d'export</li>
                </ul>
                
                <h2>üìö Gestion de l'historique</h2>
                <p><strong>Le bouton "üîÑ Nouveau diagnostic" :</strong></p>
                <ul>
                    <li>Efface toutes les donn√©es actuelles</li>
                    <li>Pr√©serve votre historique complet</li>
                    <li>Remet l'outil √† z√©ro pour une nouvelle √©valuation</li>
                </ul>
            `;
            break;
            
        case 'faq':
            title = '‚ùì FAQ';
            content = `
                <h2>‚ùì Questions fr√©quentes</h2>
                
                <h3>üåü Questions g√©n√©rales</h3>
                <p><strong>‚è±Ô∏è Combien de temps pour compl√©ter ?</strong><br>
                Comptez 15-20 minutes pour remplir soigneusement toutes les informations.</p>
                
                <p><strong>üíæ Puis-je interrompre l'√©valuation ?</strong><br>
                Oui ! Vos r√©ponses sont automatiquement sauvegard√©es.</p>
                
                <p><strong>üîí Mes donn√©es sont-elles s√©curis√©es ?</strong><br>
                Les donn√©es sont stock√©es localement dans votre navigateur.</p>
                
                <h3>üìä Questions sur le scoring</h3>
                <p><strong>üßÆ Comment est calcul√© le score global ?</strong><br>
                Moyenne pond√©r√©e des 10 dimensions avec ajustement sectoriel.</p>
                
                <p><strong>üìà Pourquoi un score ajust√© ?</strong><br>
                Refl√®te les avantages/difficult√©s de votre secteur depuis la C√¥te d'Ivoire.</p>
                
                <p><strong>üéØ Que signifie un score de 70% ?</strong><br>
                "BON POTENTIEL" n√©cessitant 3-6 mois de pr√©paration.</p>
                
                <h3>üíª Questions techniques</h3>
                <p><strong>üìä Export Google Sheets ne fonctionne pas ?</strong><br>
                V√©rifiez les bloqueurs de popup. Utilisez l'export PDF en alternative.</p>
                
                <p><strong>‚úèÔ∏è Puis-je modifier mes r√©ponses ?</strong><br>
                Oui, retournez dans "√âvaluation" et recalculez les r√©sultats.</p>
                
                <p><strong>üîÑ Comment r√©initialiser ?</strong><br>
                Bouton "üîÑ Nouveau diagnostic" (pr√©serve l'historique).</p>
                
                <h3>üìû Support</h3>
                <div style="background: #e8f5e8; border-left: 5px solid #34a853; padding: 20px; margin: 20px 0; border-radius: 8px;">
                    <strong>üìû Support technique :</strong> Contactez votre agent ACIEX pour toute assistance<br>
                    <strong>üîÑ Mise √† jour :</strong> Cette aide correspond √† la version 3.1 de l'outil
                </div>
            `;
            break;
    }
    
    // Cr√©er une nouvelle fen√™tre avec le contenu
    const helpWindow = window.open('', '_blank', 'width=1000,height=700,scrollbars=yes,resizable=yes');
    helpWindow.document.write(`
        <!DOCTYPE html>
        <html lang="fr">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>${title} - Aide ACIEX</title>
            <style>
                body { font-family: 'Segoe UI', sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; line-height: 1.6; }
                h2 { color: #1a73e8; border-left: 5px solid #1a73e8; padding-left: 15px; }
                h3 { color: #2e7d32; }
                code { background: #f5f5f5; padding: 2px 6px; border-radius: 4px; color: #d63384; }
            </style>
        </head>
        <body>
            <div style="background: linear-gradient(135deg, #1a73e8, #4285f4); color: white; padding: 20px; margin: -20px -20px 20px -20px; text-align: center;">
                <h1>${title}</h1>
                <p>Guide d'utilisation - Outil Diagnostic Export ACIEX v3.1</p>
            </div>
            ${content}
        </body>
        </html>
    `);
    helpWindow.document.close();
}

// Fermer le modal en cliquant √† l'ext√©rieur
window.onclick = function(event) {
    const modal = document.getElementById('helpModal');
    if (event.target === modal) {
        closeHelpMenu();
    }
}

// Navigation secondaire pour les sections longues
        function createSecondaryNav(navItems) {
            let navHtml = '<div class="secondary-nav">';
            navItems.forEach((item, index) => {
                const activeClass = index === 0 ? 'active' : '';
                navHtml += `<button class="secondary-nav-btn ${activeClass}" onclick="scrollToSection('${item.id}')">${item.label}</button>`;
            });
            navHtml += '</div>';
            return navHtml;
        }

        function scrollToSection(sectionId) {
            document.querySelectorAll('.secondary-nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            const element = document.getElementById(sectionId);
            if (element) {
                element.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start' 
                });
            }
        }

        const resultsNavItems = [
            { id: 'scores-globaux', label: 'üéØ Scores Globaux' },
            { id: 'par-dimension', label: 'üìä Par Dimension' },
            { id: 'actions-prioritaires', label: '‚ö° Actions Prioritaires' },
            { id: 'plan-strategique', label: 'üìã Plan Strat√©gique' },
            { id: 'export-resultats', label: 'üìÑ Export' }
        ];

        const detailedNavItems = [
            { id: 'profil-entreprise', label: 'üè¢ Profil Entreprise' },
            { id: 'defaillances-critiques', label: 'üö® D√©faillances' },
            { id: 'plan-action', label: 'üìã Plan d\'Action' },
            { id: 'marche-cible', label: 'üåç March√© Cible' },
            { id: 'services-aciex', label: 'üéØ Services ACIEX' }
        ];

    </script>
    </script>
</body>
</html>